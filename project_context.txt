PROJECT DUMP GENERATED ON 12/20/2025 18:17:58
ROOT: C:\workspace\Meus Projetos\Centro Automotivo APP\App Centro Automotivo
EXCLUDED: node_modules, .git, dist, build, .next, coverage, package-lock.json, yarn.lock, pnpm-lock.yaml, *.log, *.png, *.jpg, *.jpeg, *.gif, *.ico, *.svg, *.webp, *.pdf, .DS_Store, .env


================================================================================
FILE PATH: CHANGELOG_FINANCEIRO.md
================================================================================
# Summary of Changes

## 1. Operational Flow (Ordem de Serviço)
- **Fast OS Creation**: implemented search by Vehicle Plate.
  - If found: automatic population of Client and Vehicle data.
  - If not found: rapid modal-based registration for Person/Client and Vehicle.
- **Items Management**:
  - Added "Gerenciar Itens" in OS List.
  - Modal to add parts/services to an OS.
  - Automatic calculation of Totals (Parts + Labor).
  - **Finish Service**: Button to finalize OS, locks status to 'FINALIZADA'.

## 2. Financial Management
- **Fechamento Financeiro**:
  - New page to calculate Real Costs of a finalized OS.
  - Input real cost per item and associate with a Supplier.
  - Updates OS status to 'PAGA_CLIENTE' after closing.
- **Conciliação de Pagamentos**:
  - `PagamentoPecaPage` refactored to list pending payments to suppliers.
  - "Baixar" button to mark payments as complete.
  - Filter by Supplier and Status (Pending/Paid).

## 3. Dashboard (Home)
- **KPIs Implemented**:
  - Total Clients.
  - Services in Progress (OS Open/In Progress).
  - Ready for Finance (OS Finalized).
  - Pending Supplier Payments.
- **Quick Actions**: Navigation shortcuts added.

## 4. Backend Updates
- **New Entities**: `Fornecedor`, `FechamentoFinanceiro`, `PagamentoPeca`.
- **New Routes/Controllers**: 
  - `GET /veiculo/placa/:placa`
  - `GET /itens-os/os/:id_os`
  - CRUDs for new entities.

# Database Migration Instructions

Since new tables and fields were added to the Prisma Schema, you must run the migration to update your database structure.

1. Stop the running server (if applicable).
2. Open a terminal in the `server` directory.
3. Run the following command:
   ```bash
   npx prisma migrate dev --name init_v3_financeiro
   ```
4. Restart the server:
   ```bash
   npm run dev
   ```

# Mobile Responsiveness
The new pages use responsive Tailwind classes (`grid-cols-1 md:grid-cols-2`). Tables are wrapped in `overflow-x-auto` to prevent breaking layouts on small screens.



================================================================================
FILE PATH: docker-compose.yml
================================================================================
services:
  # 1. Serviço do Banco de Dados PostgreSQL
  centroautomotivo_db:
    image: postgres:16
    restart: always
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: automotivo_db
    ports:
      - "5434:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d automotivo_db"]
      interval: 5s
      timeout: 5s
      retries: 5
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - app-network

  # 2. Serviço da API (Backend Node/Express)
  api:
    build:
      context: ./server
      dockerfile: Dockerfile
    image: automotivo-api
    command: sh -c "npx prisma generate && npx prisma migrate deploy && npm run dev"
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: postgresql://user:password@centroautomotivo_db:5432/automotivo_db
      PORT: 3000
      NODE_ENV: development
    depends_on:
      centroautomotivo_db:
        condition: service_healthy
    volumes:
      - ./server:/app/server
      - /app/server/node_modules
    networks:
      - app-network

  # 3. Serviço do Frontend (React + Vite)
  client:
    build:
      context: ./client
      dockerfile: Dockerfile
    image: automotivo-client
    ports:
      - "5173:5173"
    environment:
      VITE_API_URL: http://localhost:3000
    volumes:
      - ./client:/app/client
      - /app/client/node_modules
    depends_on:
      - api
    networks:
      - app-network

volumes:
  postgres_data:

networks:
  app-network:
    driver: bridge


================================================================================
FILE PATH: package.json
================================================================================
{
  "name": "centro-automotivo-app",
  "version": "1.0.0",
  "description": "Root scripts for managing Docker and overarching project tasks",
  "scripts": {
    "docker:reset": "docker compose down && docker compose up -d",
    "docker:up": "docker compose up -d",
    "docker:down": "docker compose down",
    "db:migrate": "docker compose exec api npx prisma migrate dev",
    "db:studio": "docker compose exec api npx prisma studio"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}



================================================================================
FILE PATH: README.md
================================================================================
# Centro-Automotivo-Basico




================================================================================
FILE PATH: client\.dockerignore
================================================================================
node_modules
npm-debug.log
dist
build
.git
.gitignore
README.md


================================================================================
FILE PATH: client\Dockerfile
================================================================================
# Usa uma imagem leve do Node
FROM node:20-alpine

# Define o diretório de trabalho
WORKDIR /app/client

# Copia os arquivos de dependências
COPY package*.json ./

# Instala as dependências
RUN npm install

# Copia o restante do código
COPY . .

# Expõe a porta padrão do Vite
EXPOSE 5173

# Inicia o servidor de desenvolvimento com host 0.0.0.0 para acesso externo
CMD ["npm", "run", "dev", "--", "--host"]



================================================================================
FILE PATH: client\eslint.config.js
================================================================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])



================================================================================
FILE PATH: client\index.html
================================================================================
<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Centro Automotivo APP</title>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>


================================================================================
FILE PATH: client\package.json
================================================================================
{
  "name": "client",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
    
  },
  "dependencies": {
    "@tailwindcss/vite": "^4.1.17",
    "axios": "^1.13.2",
    "lucide-react": "^0.561.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.10.1",
    "tailwindcss": "^4.1.17"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}



================================================================================
FILE PATH: client\README.md
================================================================================
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```



================================================================================
FILE PATH: client\tsconfig.app.json
================================================================================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}



================================================================================
FILE PATH: client\tsconfig.json
================================================================================
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}



================================================================================
FILE PATH: client\tsconfig.node.json
================================================================================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}



================================================================================
FILE PATH: client\vite.config.ts
================================================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'


// https://vite.dev/config/
export default defineConfig({
  plugins: [react(), tailwindcss()],
})



================================================================================
FILE PATH: client\src\App.css
================================================================================
@import "tailwindcss";

#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}

.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}

.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}


================================================================================
FILE PATH: client\src\App.tsx
================================================================================
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { MainLayout } from './components/layouts/MainLayout';
import { HomePage } from './pages/HomePage';
import { NotFoundPage } from './pages/NotFoundPage';
import { ClientePage } from './pages/ClientePage'; 

// Importe suas páginas antigas aqui enquanto não refatora todas
import { VeiculoPage } from './pages/VeiculoPage';
import { OrdemDeServicoPage } from './pages/OrdemDeServicoPage';
import { PecasEstoquePage } from './pages/PecasEstoquePage';
import { FuncionarioPage } from './pages/FuncionarioPage';
import { PessoaPage } from './pages/PessoaPage';
import { TipoPage } from './pages/TipoPage';
import { FechamentoFinanceiroPage } from './pages/FechamentoFinanceiroPage';
import { FornecedorPage } from './pages/FornecedorPage';
import { PagamentoPecaPage } from './pages/PagamentoPecaPage';
import { SearchClientePage } from './pages/SearchClientePage';
import { SearchVeiculoPage } from './pages/SearchVeiculoPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        {/* Rota Principal com Layout (Sidebar + Conteúdo) */}
        <Route element={<MainLayout />}>
          <Route path="/" element={<HomePage />} />
          
          {/* Páginas Modernizadas */}
          <Route path="/cliente" element={<ClientePage />} />

          {/* Páginas Legadas (Ainda funcionam dentro do layout novo!) */}
          <Route path="/veiculo" element={<VeiculoPage />} />
          <Route path="/ordem-de-servico" element={<OrdemDeServicoPage />} />
          <Route path="/pecas-estoque" element={<PecasEstoquePage />} />
          <Route path="/funcionario" element={<FuncionarioPage />} />
          <Route path="/pessoa" element={<PessoaPage />} />
          <Route path="/tipo" element={<TipoPage />} />
          <Route path="/fechamento-financeiro" element={<FechamentoFinanceiroPage />} />
          <Route path="/fornecedor" element={<FornecedorPage />} />
          <Route path="/pagamento-peca" element={<PagamentoPecaPage />} />
          
          {/* Search Pages */}
          <Route path="/search-cliente" element={<SearchClientePage />} />
          <Route path="/search-veiculo" element={<SearchVeiculoPage />} />
          
          {/* Rota 404 para qualquer coisa não definida */}
          <Route path="*" element={<NotFoundPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;


================================================================================
FILE PATH: client\src\index.css
================================================================================
@import "tailwindcss";

@theme {
  /* Tipografia */
  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;

  /* Brand / Primary */
  --color-primary-50: #eff6ff;
  --color-primary-100: #dbeafe;
  --color-primary-200: #bfdbfe;
  --color-primary-300: #93c5fd;
  --color-primary-400: #60a5fa;
  --color-primary-500: #3b82f6;
  --color-primary-600: #2563eb;
  --color-primary-700: #1d4ed8;
  --color-primary-800: #1e40af;
  --color-primary-900: #1e3a8a;

  /* Neutros / Grayscale */
  --color-neutral-25: #fcfcfd;
  --color-neutral-50: #f9fafb;
  --color-neutral-100: #f3f4f6;
  --color-neutral-200: #e5e7eb;
  --color-neutral-300: #d1d5db;
  --color-neutral-400: #9ca3af;
  --color-neutral-500: #6b7280;
  --color-neutral-600: #4b5563;
  --color-neutral-700: #374151;
  --color-neutral-800: #1f2937;
  --color-neutral-900: #111827;

  /* Accent / Secondary */
  --color-accent-50: #f5f3ff;
  --color-accent-600: #7c3aed;
  --color-accent-700: #6d28d9;

  /* Semânticas */
  --color-success: #059669;
  --color-success-50: #ecfdf5;
  --color-warning: #d97706;
  --color-warning-50: #fffbeb;
  --color-error: #dc2626;
  --color-error-50: #fef2f2;
  --color-info: #2563eb;

  /* UI Tokens */
  --color-background: var(--color-neutral-50);
  --color-surface: #ffffff;
  --color-border: var(--color-neutral-200);
  --color-text-main: var(--color-neutral-900);
  --color-text-muted: var(--color-neutral-500);
  --color-sidebar: var(--color-neutral-900);
}

:root {
  font-family: var(--font-sans);
  line-height: 1.5;
  font-weight: 400;
  color: #334155;
  /* Slate 700 */
  background-color: var(--color-background);
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin: 0;
  display: flex;
  min-width: 320px;
  min-height: 100vh;
}

/* Scrollbar moderna */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}


================================================================================
FILE PATH: client\src\main.tsx
================================================================================
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)



================================================================================
FILE PATH: client\src\components\Sidebar.tsx
================================================================================
import { 
  Users, 
  Car, 
  Wrench, 
  Package, 
  LayoutDashboard,
  UserCog,
  DollarSign
} from 'lucide-react';
import { Link, useLocation } from 'react-router-dom';

const menuItems = [
  { path: '/', label: 'Dashboard', icon: LayoutDashboard },
  { path: '/cliente', label: 'Clientes', icon: Users },
  { path: '/veiculo', label: 'Veículos', icon: Car },
  { path: '/ordem-de-servico', label: 'Ordens de Serviço', icon: Wrench },
  { path: '/pecas-estoque', label: 'Estoque', icon: Package },
  { path: '/fechamento-financeiro', label: 'Financeiro', icon: DollarSign },
  { path: '/fornecedor', label: 'Fornecedores', icon: Package },
  { path: '/funcionario', label: 'Funcionários', icon: UserCog },
];

export const Sidebar = () => {
  const location = useLocation();

  return (
    <aside className="w-64 bg-sidebar text-neutral-400 flex flex-col h-screen fixed left-0 top-0 overflow-y-auto border-r border-neutral-800">
      <div className="p-6 border-b border-neutral-800">
        <h1 className="text-2xl font-bold text-white tracking-tight">
          Auto<span className="text-primary-500">Center</span>
        </h1>
      </div>
      
      <nav className="flex-1 py-6 px-3 space-y-1">
        {menuItems.map((item) => {
          const isActive = location.pathname === item.path;
          return (
            <Link
              key={item.path}
              to={item.path}
              className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 font-medium ${
                isActive 
                  ? 'bg-primary-600 text-white shadow-lg shadow-primary-900/50' 
                  : 'hover:bg-neutral-800 hover:text-white'
              }`}
            >
              <item.icon size={20} className={isActive ? 'text-white' : 'text-neutral-500 group-hover:text-white'} />
              {item.label}
            </Link>
          );
        })}
      </nav>

      <div className="p-4 border-t border-neutral-800">
        <div className="bg-neutral-800/50 rounded-lg p-3">
          <p className="text-xs text-center text-neutral-500">
            &copy; 2024 Centro Automotivo
          </p>
        </div>
      </div>
    </aside>
  );
};


================================================================================
FILE PATH: client\src\components\forms\ClienteForm.tsx
================================================================================
import { useState, useEffect, useRef } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';
import { formatNameTitleCase } from '../../utils/normalize';
import { CheckCircle, AlertCircle, CarFront } from 'lucide-react';

interface ClienteFormProps {
    clientId?: number;
    initialData?: any;
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
    onRegisterVehicle?: (client: any) => void;
}

export const ClienteForm = ({ clientId, initialData, onSuccess, onCancel, onRegisterVehicle }: ClienteFormProps) => {
    const [tipoPessoa, setTipoPessoa] = useState<'PF' | 'PJ'>('PF');
    const [loading, setLoading] = useState(false);
    const [formStatus, setFormStatus] = useState<{ type: 'success' | 'error' | null, message: string }>({ type: null, message: '' });
    const [createdClient, setCreatedClient] = useState<any>(null);

    const firstInputRef = useRef<HTMLInputElement>(null);

    // Form States
    const [nome, setNome] = useState('');
    const [cpf, setCpf] = useState('');
    const [razaoSocial, setRazaoSocial] = useState('');
    const [cnpj, setCnpj] = useState('');
    const [ie, setIe] = useState('');
    const [telefone, setTelefone] = useState('');
    const [email, setEmail] = useState('');
    
    // Address
    const [logradouro, setLogradouro] = useState('');
    const [numero, setNumero] = useState('');
    const [bairro, setBairro] = useState('');
    const [cidade, setCidade] = useState('São Paulo');
    const [estado, setEstado] = useState('SP');

    // Optional Fields
    const [genero, setGenero] = useState('');
    const [dtNascimento, setDtNascimento] = useState('');
    const [obs, setObs] = useState('');
    
    // PJ Optional
    const [nomeFantasia, setNomeFantasia] = useState('');

    // Contacts
    const [telefone2, setTelefone2] = useState('');
    const [telefone3, setTelefone3] = useState('');
    
    // Address Optional
    const [complLogradouro, setComplLogradouro] = useState('');

    useEffect(() => {
        if (firstInputRef.current) {
            firstInputRef.current.focus();
        }
    }, [tipoPessoa]);

    useEffect(() => {
        if (initialData) {
            // Address & Contact (Always present on Cliente)
            setTelefone(initialData.telefone_1 || '');
            setTelefone2(initialData.telefone_2 || '');
            setTelefone3(initialData.telefone_3 || '');
            setEmail(initialData.email || '');
            setLogradouro(initialData.logradouro || '');
            setNumero(initialData.nr_logradouro || '');
            setComplLogradouro(initialData.compl_logradouro || '');
            setBairro(initialData.bairro || '');
            setCidade(initialData.cidade || '');
            setEstado(initialData.estado || '');

            // Person Type Specific
            if (initialData.pessoa_fisica) {
                setTipoPessoa('PF');
                const pf = initialData.pessoa_fisica;
                setNome(pf.pessoa?.nome || '');
                setCpf(pf.cpf || '');
                setGenero(pf.pessoa?.genero || '');
                 if (pf.pessoa?.dt_nascimento) {
                    setDtNascimento(new Date(pf.pessoa.dt_nascimento).toISOString().split('T')[0]);
                }
            } else if (initialData.pessoa_juridica) {
                setTipoPessoa('PJ');
                const pj = initialData.pessoa_juridica;
                setRazaoSocial(pj.razao_social || '');
                setNomeFantasia(pj.nome_fantasia || '');
                setCnpj(pj.cnpj || '');
                setIe(pj.inscricao_estadual || '');
            }
        }
    }, [initialData]);

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        setFormStatus({ type: null, message: '' });

        // EDIT MODE
        if (clientId && initialData) {
             try {
                const clientePayload = {
                    telefone_1: telefone,
                    telefone_2: telefone2,
                    telefone_3: telefone3,
                    email,
                    logradouro,
                    nr_logradouro: numero,
                    compl_logradouro: complLogradouro,
                    bairro,
                    cidade,
                    estado
                };

                const response = await api.put(`/cliente/${clientId}`, clientePayload);
                setFormStatus({ type: 'success', message: 'Dados do cliente atualizados com sucesso!' });
                setTimeout(() => onSuccess(response.data), 1500);
             } catch (error: any) {
                 console.error(error);
                 setFormStatus({ type: 'error', message: 'Erro ao atualizar cliente: ' + (error.response?.data?.error || error.message) });
             } finally {
                 setLoading(false);
             }
             return;
        }

        // CREATE MODE
        try {
            // 1. Create Base Pessoa (normalize name to Title Case)
            const pessoaPayload = { 
                nome: formatNameTitleCase(tipoPessoa === 'PF' ? nome : razaoSocial),
                genero: tipoPessoa === 'PF' ? genero : null,
                dt_nascimento: dtNascimento ? new Date(dtNascimento) : null,
                obs
            };
            const pessoaRes = await api.post('/pessoa', pessoaPayload);
            const idPessoa = pessoaRes.data.id_pessoa;

            if (!idPessoa) throw new Error('Falha ao criar Pessoa base.');

            let fkId = null;
            let fkField = '';

            // 2. Create Specific Person Type (normalize CPF/CNPJ)
            if (tipoPessoa === 'PF') {
                const pfPayload = { 
                    id_pessoa: idPessoa, 
                    cpf: cpf ? cpf.replace(/\D/g, '') : null // Remove non-digits
                };
                const pfRes = await api.post('/pessoa-fisica', pfPayload);
                fkId = pfRes.data.id_pessoa_fisica;
                fkField = 'id_pessoa_fisica';
            } else {
                const pjPayload = { 
                    id_pessoa: idPessoa, 
                    razao_social: formatNameTitleCase(razaoSocial),
                    nome_fantasia: nomeFantasia ? formatNameTitleCase(nomeFantasia) : null,
                    cnpj: cnpj ? cnpj.replace(/\D/g, '') : null, // Remove non-digits
                    inscricao_estadual: ie 
                };
                const pjRes = await api.post('/pessoa-juridica', pjPayload);
                fkId = pjRes.data.id_pessoa_juridica;
                fkField = 'id_pessoa_juridica';
            }

            if (!fkId) {
                console.error(`Erro: FK ID não retornado para ${fkField}`);
                throw new Error(`Falha ao criar registro de Pessoa ${tipoPessoa}.`);
            }

            // 3. Create Cliente
            const clientePayload = {
                [fkField]: fkId,
                tipo_pessoa: 1, // 1 implies generic type/active
                telefone_1: telefone,
                telefone_2: telefone2,
                telefone_3: telefone3,
                email,
                logradouro,
                nr_logradouro: numero,
                compl_logradouro: complLogradouro,
                bairro,
                cidade,
                estado
            };

            const clienteRes = await api.post('/cliente', clientePayload);
            if (!clienteRes.data || !clienteRes.data.id_cliente) {
                throw new Error('Cliente criado mas ID não retornado.');
            }
            
            setCreatedClient(clienteRes.data);
            setFormStatus({ type: 'success', message: 'Cliente cadastrado com sucesso!' });
            
            // If the user doesn't want to register a vehicle, we auto-success in 3 seconds or they can click.
            if (!onRegisterVehicle) {
                setTimeout(() => onSuccess(clienteRes.data), 2000);
            }
            
        } catch (error: any) {
            console.error('Erro no cadastro:', error);
            setFormStatus({ type: 'error', message: 'Erro ao cadastrar cliente: ' + (error.response?.data?.error || error.message) });
        } finally {
            setLoading(false);
        }
    };

    if (formStatus.type === 'success' && createdClient && onRegisterVehicle) {
        return (
            <div className="py-8 px-4 text-center space-y-6">
                <div className="flex flex-col items-center gap-4">
                    <div className="w-16 h-16 bg-success-100 text-success-600 rounded-full flex items-center justify-center">
                        <CheckCircle size={40} />
                    </div>
                    <div>
                        <h3 className="text-xl font-black text-neutral-900">Cliente Cadastrado!</h3>
                        <p className="text-neutral-500">Deseja cadastrar um veículo para este cliente agora?</p>
                    </div>
                </div>

                <div className="flex flex-col gap-3 pt-4">
                    <button 
                        onClick={() => onRegisterVehicle(createdClient)}
                        className="w-full py-4 bg-primary-600 text-white font-black rounded-2xl hover:bg-primary-700 transition-all shadow-xl shadow-primary-500/20 flex items-center justify-center gap-3"
                    >
                        <CarFront size={20} /> CADASTRAR VEÍCULO
                    </button>
                    <button 
                        onClick={() => onSuccess(createdClient)}
                        className="w-full py-4 text-neutral-500 font-bold hover:bg-neutral-100 rounded-2xl transition-all"
                    >
                        Apenas concluir
                    </button>
                </div>
            </div>
        );
    }

    return (
        <form onSubmit={handleSubmit} className="space-y-4 text-neutral-900">
            {formStatus.type && (
                <div className={`p-4 rounded-xl flex items-center gap-3 animate-in fade-in slide-in-from-top-2 duration-300 ${formStatus.type === 'success' ? 'bg-success-50 text-success-700 border border-success-100' : 'bg-red-50 text-red-700 border border-red-100'}`}>
                    {formStatus.type === 'success' ? <CheckCircle size={20} /> : <AlertCircle size={20} />}
                    <p className="text-sm font-bold">{formStatus.message}</p>
                </div>
            )}

            <div className="flex bg-neutral-100 p-1 rounded-lg mb-4 w-fit">
                <button
                    type="button"
                    onClick={() => !clientId && setTipoPessoa('PF')}
                    disabled={!!clientId}
                    className={`px-4 py-2 rounded-md text-sm font-bold transition-all ${tipoPessoa === 'PF' ? 'bg-surface shadow text-primary-600' : 'text-neutral-500'} ${clientId ? 'opacity-50 cursor-not-allowed' : ''}`}
                >
                    Pessoa Física
                </button>
                <button
                    type="button"
                    onClick={() => !clientId && setTipoPessoa('PJ')}
                    disabled={!!clientId}
                    className={`px-4 py-2 rounded-md text-sm font-bold transition-all ${tipoPessoa === 'PJ' ? 'bg-surface shadow text-accent-600' : 'text-neutral-500'} ${clientId ? 'opacity-50 cursor-not-allowed' : ''}`}
                >
                    Pessoa Jurídica
                </button>
            </div>

            {/* 1. Base Pessoa Data */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                {tipoPessoa === 'PF' ? (
                    <>
                        <div className="col-span-2">
                            <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Nome Completo {clientId && '(Leitura)'}</label>
                            <input ref={firstInputRef} value={nome} onChange={e => setNome(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 disabled:bg-neutral-100" required disabled={!!clientId} />
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">CPF {clientId && '(Leitura)'}</label>
                            <input value={cpf} onChange={e => setCpf(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 disabled:bg-neutral-100" disabled={!!clientId} />
                        </div>
                        <div>
                             <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Gênero</label>
                             <select value={genero} onChange={e => setGenero(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 disabled:bg-neutral-100" disabled={!!clientId}>
                                <option value="">Selecione...</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                                <option value="Outro">Outro</option>
                             </select>
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Data Nascimento</label>
                            <input type="date" value={dtNascimento} onChange={e => setDtNascimento(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 disabled:bg-neutral-100" disabled={!!clientId} />
                        </div>
                    </>
                ) : (
                    <>
                         <div className="col-span-2">
                            <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Razão Social {clientId && '(Leitura)'}</label>
                            <input ref={firstInputRef} value={razaoSocial} onChange={e => setRazaoSocial(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-accent-500/20 outline-none border-neutral-300 disabled:bg-neutral-100" required disabled={!!clientId} />
                        </div>
                        <div className="col-span-2">
                            <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Nome Fantasia</label>
                            <input value={nomeFantasia} onChange={e => setNomeFantasia(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-accent-500/20 outline-none border-neutral-300 disabled:bg-neutral-100" disabled={!!clientId} />
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">CNPJ {clientId && '(Leitura)'}</label>
                            <input value={cnpj} onChange={e => setCnpj(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-accent-500/20 outline-none border-neutral-300 disabled:bg-neutral-100" required disabled={!!clientId} />
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Inscr. Estadual</label>
                            <input value={ie} onChange={e => setIe(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-accent-500/20 outline-none border-neutral-300 disabled:bg-neutral-100" disabled={!!clientId} />
                        </div>
                    </>
                )}
                
                <div className="col-span-2">
                    <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Observações (Pessoa)</label>
                    <input value={obs} onChange={e => setObs(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-neutral-100 outline-none border-neutral-300" />
                </div>
            </div>

            {/* 2. Contact Data */}
            <div className="border-t border-neutral-200 pt-2 mt-2">
                <h4 className="text-sm font-bold text-neutral-500 mb-3 uppercase">Contatos</h4>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Telefone Principal *</label>
                        <input value={telefone} onChange={e => setTelefone(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300" required />
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Telefone 2</label>
                        <input value={telefone2} onChange={e => setTelefone2(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300" />
                    </div>
                     <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Telefone 3</label>
                        <input value={telefone3} onChange={e => setTelefone3(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300" />
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Email</label>
                        <input type="email" value={email} onChange={e => setEmail(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300" />
                    </div>
                </div>
            </div>

            {/* 3. Address Data */}
            <div className="border-t border-neutral-200 pt-2 mt-2">
                <h4 className="text-sm font-bold text-neutral-500 mb-3 uppercase">Endereço</h4>
                <div className="grid grid-cols-4 gap-4">
                     <div className="col-span-3">
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Logradouro</label>
                        <input value={logradouro} onChange={e => setLogradouro(e.target.value)} className="w-full border p-2 rounded border-neutral-300" />
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Número</label>
                        <input value={numero} onChange={e => setNumero(e.target.value)} className="w-full border p-2 rounded border-neutral-300" />
                    </div>
                     <div className="col-span-2">
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Complemento</label>
                        <input value={complLogradouro} onChange={e => setComplLogradouro(e.target.value)} className="w-full border p-2 rounded border-neutral-300" />
                    </div>
                    <div className="col-span-2">
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Bairro</label>
                        <input value={bairro} onChange={e => setBairro(e.target.value)} className="w-full border p-2 rounded border-neutral-300" />
                    </div>
                    <div className="col-span-3">
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Cidade</label>
                        <input value={cidade} onChange={e => setCidade(e.target.value)} className="w-full border p-2 rounded border-neutral-300" />
                    </div>
                    <div className="col-span-1">
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">UF</label>
                        <input value={estado} onChange={e => setEstado(e.target.value)} maxLength={2} className="w-full border p-2 rounded border-neutral-300 uppercase" />
                    </div>
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-neutral-600 font-bold hover:bg-neutral-100 rounded-lg transition-colors">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-primary-600 text-white font-black rounded-lg hover:bg-primary-700 disabled:opacity-50 transition-colors shadow-lg shadow-primary-500/30"
                >
                    {loading ? 'Salvando...' : (clientId ? 'Salvar Alterações' : 'Salvar Cliente')}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\FechamentoFinanceiroForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface FechamentoFinanceiroFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const FechamentoFinanceiroForm = ({ onSuccess, onCancel }: FechamentoFinanceiroFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: id_os, custo_total_pecas_real
    const [idOs, setIdOs] = useState('');
    const [custoTotalPecasReal, setCustoTotalPecasReal] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                id_os: Number(idOs),
                custo_total_pecas_real: Number(custoTotalPecasReal)
            };

            const response = await api.post('/fechamento-financeiro', payload);
            alert('Fechamento financeiro realizado com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao realizar fechamento financeiro.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="bg-green-50 p-3 rounded text-sm text-green-800 border border-green-100">
                <strong>Fechamento Financeiro:</strong> Consolida os custos reais da OS para cálculo de lucro.
            </div>

            <div className="grid grid-cols-1 gap-4">
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">ID Ordem de Serviço *</label>
                    <input 
                        type="number"
                        value={idOs} 
                        onChange={e => setIdOs(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                        placeholder="ID da OS a ser fechada"
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Custo Total Peças Real (R$) *</label>
                    <input 
                        type="number"
                        step="0.01"
                        value={custoTotalPecasReal} 
                        onChange={e => setCustoTotalPecasReal(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                        placeholder="Soma dos custos reais pagos aos fornecedores"
                    />
                    <p className="text-xs text-gray-500 mt-1">
                        Este valor deve refletir o custo real total de todas as peças utilizadas na OS.
                    </p>
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 disabled:opacity-50"
                >
                    {loading ? 'Fechando...' : 'Fechar Financeiro'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\FornecedorForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface FornecedorFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const FornecedorForm = ({ onSuccess, onCancel }: FornecedorFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: nome, documento?, contato?
    const [nome, setNome] = useState('');
    const [documento, setDocumento] = useState('');
    const [contato, setContato] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                nome,
                documento: documento || null,
                contato: contato || null
            };

            const response = await api.post('/fornecedor', payload);
            alert('Fornecedor cadastrado com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao cadastrar fornecedor.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Nome do Fornecedor *</label>
                    <input 
                        value={nome} 
                        onChange={e => setNome(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Documento (CPF/CNPJ)</label>
                    <input 
                        value={documento} 
                        onChange={e => setDocumento(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        placeholder="Somente números"
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Contato</label>
                    <input 
                        value={contato} 
                        onChange={e => setContato(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        placeholder="Telefone, email, etc."
                    />
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50"
                >
                    {loading ? 'Salvando...' : 'Salvar Fornecedor'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\FuncionarioForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';
import { Briefcase, DollarSign, Calendar, FileText, Info, User, CheckCircle } from 'lucide-react';

interface FuncionarioFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const FuncionarioForm = ({ onSuccess, onCancel }: FuncionarioFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // User Identity (Pessoa)
    const [nome, setNome] = useState('');
    const [genero, setGenero] = useState('');
    
    // Physical Person (Pessoa Fisica)
    const [cpf, setCpf] = useState('');
    
    // Contract Details (Funcionario)
    const [ativo, setAtivo] = useState('S');
    const [cargo, setCargo] = useState('');
    const [salario, setSalario] = useState('');
    const [comissao, setComissao] = useState('');
    const [dtAdmissao, setDtAdmissao] = useState(new Date().toISOString().split('T')[0]);
    // Other
    const [obs, setObs] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            // 1. Criar Pessoa Base
            const pessoaResponse = await api.post('/pessoa', {
                nome,
                genero: genero || null,
            });
            const idPessoa = pessoaResponse.data.id_pessoa;

            // 2. Criar Pessoa Física
            const pfResponse = await api.post('/pessoa-fisica', {
                id_pessoa: idPessoa,
                cpf: cpf.replace(/\D/g, '') || null
            });
            const idPessoaFisica = pfResponse.data.id_pessoa_fisica;

            // 3. Criar Funcionário
            const payload = {
                id_pessoa_fisica: idPessoaFisica,
                ativo,
                cargo,
                salario: salario ? Number(salario) : null,
                comissao: comissao ? Number(comissao) : null,
                dt_admissao: new Date(dtAdmissao).toISOString(),
                obs: obs || null
            };

            const response = await api.post('/funcionario', payload);
            alert('Funcionário cadastrado com sucesso!');
            onSuccess(response.data);
        } catch (error: any) {
            console.error(error);
            const msg = error.response?.data?.error || 'Erro ao cadastrar funcionário.';
            alert(msg);
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="space-y-6 text-neutral-900 bg-white p-2">
             <div className="bg-primary-50 p-4 rounded-2xl flex items-start gap-4 border border-primary-100 mb-2">
                <div className="bg-primary-500 p-2 rounded-xl text-white shadow-lg shadow-primary-500/30">
                    <Info size={20} />
                </div>
                <div>
                    <h4 className="text-sm font-black text-primary-900 uppercase tracking-tight">Cadastro Unificado</h4>
                    <p className="text-xs text-primary-700 font-medium tracking-tight">Este formulário cria automaticamente os registros de Pessoa, Pessoa Física e Funcionário.</p>
                </div>
            </div>

            <form onSubmit={handleSubmit} className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {/* DADOS PESSOAIS */}
                    <div className="col-span-2">
                        <h3 className="text-sm font-black text-neutral-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <User size={16} /> Dados Pessoais
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="col-span-2">
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">Nome Completo *</label>
                                <input 
                                    value={nome} 
                                    onChange={e => setNome(e.target.value)} 
                                    className="w-full bg-neutral-50 border border-neutral-200 p-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-800 transition-all" 
                                    required 
                                    placeholder="Nome completo do funcionário"
                                />
                            </div>
                            <div>
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">CPF</label>
                                <input 
                                    value={cpf} 
                                    onChange={e => setCpf(e.target.value)} 
                                    className="w-full bg-neutral-50 border border-neutral-200 p-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-800 transition-all" 
                                    placeholder="000.000.000-00"
                                />
                            </div>
                            <div>
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">Gênero</label>
                                <select 
                                    value={genero} 
                                    onChange={e => setGenero(e.target.value)} 
                                    className="w-full bg-neutral-50 border border-neutral-200 p-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-800 transition-all"
                                >
                                    <option value="">Selecione...</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Feminino">Feminino</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    {/* DADOS CONTRATUAIS */}
                    <div className="col-span-2 border-t border-neutral-100 pt-6">
                        <h3 className="text-sm font-black text-neutral-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <Briefcase size={16} /> Dados do Contrato
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="col-span-1">
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">Cargo *</label>
                                <input 
                                    value={cargo} 
                                    onChange={e => setCargo(e.target.value)} 
                                    className="w-full bg-neutral-50 border border-neutral-200 p-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-800 transition-all" 
                                    required 
                                    placeholder="Ex: Mecânico, Vendedor"
                                />
                            </div>
                            <div>
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">Status</label>
                                <select 
                                    value={ativo} 
                                    onChange={e => setAtivo(e.target.value)} 
                                    className="w-full bg-neutral-50 border border-neutral-200 p-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-black text-primary-600 transition-all"
                                >
                                    <option value="S">ATIVO</option>
                                    <option value="N">INATIVO</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">Salário (R$)</label>
                                <div className="relative">
                                    <DollarSign size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400" />
                                    <input 
                                        type="number" 
                                        step="0.01" 
                                        value={salario} 
                                        onChange={e => setSalario(e.target.value)} 
                                        className="w-full bg-neutral-50 border border-neutral-200 pl-10 pr-3 py-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-800 transition-all" 
                                        placeholder="0,00"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">Comissão (%)</label>
                                <div className="relative">
                                    <span className="absolute left-3 top-1/2 -translate-y-1/2 font-bold text-neutral-400 text-xs">%</span>
                                    <input 
                                        type="number" 
                                        value={comissao} 
                                        onChange={e => setComissao(e.target.value)} 
                                        className="w-full bg-neutral-50 border border-neutral-200 pl-10 pr-3 py-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-800 transition-all" 
                                        placeholder="0"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1">Data de Admissão *</label>
                                <div className="relative">
                                    <Calendar size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400" />
                                    <input 
                                        type="date" 
                                        value={dtAdmissao} 
                                        onChange={e => setDtAdmissao(e.target.value)} 
                                        className="w-full bg-neutral-50 border border-neutral-200 pl-10 pr-3 py-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-800 transition-all" 
                                        required 
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="col-span-2 border-t border-neutral-100 pt-6">
                        <label className="text-[10px] font-black text-neutral-500 uppercase mb-1 ml-1 flex items-center gap-1">
                            <FileText size={14} /> Observações Internas
                        </label>
                        <textarea 
                            value={obs} 
                            onChange={e => setObs(e.target.value)} 
                            className="w-full bg-neutral-50 border border-neutral-200 p-3 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-medium text-neutral-800 transition-all min-h-[100px] resize-none" 
                            placeholder="Informações adicionais sobre o colaborador..." 
                        />
                    </div>
                </div>

                <div className="flex gap-4 pt-4 border-t border-neutral-100">
                    <button 
                        type="button" 
                        onClick={onCancel} 
                        className="flex-1 py-4 text-neutral-500 font-black text-xs uppercase hover:bg-neutral-100 rounded-2xl transition-all tracking-widest"
                    >
                        Cancelar
                    </button>
                    <button 
                        type="submit" 
                        disabled={loading}
                        className="flex-2 px-12 py-4 bg-neutral-900 text-white font-black text-xs uppercase rounded-2xl hover:bg-primary-600 disabled:opacity-50 transition-all tracking-widest shadow-xl shadow-neutral-900/10 flex items-center justify-center gap-2 active:scale-95"
                    >
                        {loading ? 'Processando...' : (
                            <>
                                Finalizar Cadastro <CheckCircle size={18} />
                            </>
                        )}
                    </button>
                </div>
            </form>
        </div>
    );
};



================================================================================
FILE PATH: client\src\components\forms\ItensOsForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface ItensOsFormProps {
    osId: number;
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const ItensOsForm = ({ osId, onSuccess, onCancel }: ItensOsFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: id_os, id_pecas_estoque?, descricao, quantidade, valor_venda, valor_total
    const [idPecasEstoque, setIdPecasEstoque] = useState('');
    const [descricao, setDescricao] = useState('');
    const [quantidade, setQuantidade] = useState('1');
    const [valorVenda, setValorVenda] = useState('');
    const [valorTotal, setValorTotal] = useState('');

    // Auto-calculate valor_total when quantidade or valor_venda changes
    const handleQuantidadeChange = (value: string) => {
        setQuantidade(value);
        if (valorVenda) {
            const total = Number(value) * Number(valorVenda);
            setValorTotal(total.toFixed(2));
        }
    };

    const handleValorVendaChange = (value: string) => {
        setValorVenda(value);
        if (quantidade) {
            const total = Number(quantidade) * Number(value);
            setValorTotal(total.toFixed(2));
        }
    };

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                id_os: osId,
                id_pecas_estoque: idPecasEstoque ? Number(idPecasEstoque) : null,
                descricao,
                quantidade: Number(quantidade),
                valor_venda: Number(valorVenda),
                valor_total: Number(valorTotal)
            };

            const response = await api.post('/itens-os', payload);
            alert('Item adicionado à OS com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao adicionar item à OS.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="bg-blue-50 p-3 rounded text-sm text-blue-800 border border-blue-100">
                <strong>OS #{osId}</strong> - Adicionando item/peça/serviço
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">ID Peça Estoque (Opcional)</label>
                    <input 
                        type="number"
                        value={idPecasEstoque} 
                        onChange={e => setIdPecasEstoque(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        placeholder="Deixe vazio para serviço"
                    />
                </div>

                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Descrição *</label>
                    <input 
                        value={descricao} 
                        onChange={e => setDescricao(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                        placeholder="Ex: Troca de óleo, Filtro de ar..."
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Quantidade *</label>
                    <input 
                        type="number"
                        min="1"
                        value={quantidade} 
                        onChange={e => handleQuantidadeChange(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Valor Unitário (R$) *</label>
                    <input 
                        type="number"
                        step="0.01"
                        value={valorVenda} 
                        onChange={e => handleValorVendaChange(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                    />
                </div>

                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Valor Total (R$)</label>
                    <input 
                        type="number"
                        step="0.01"
                        value={valorTotal} 
                        onChange={e => setValorTotal(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300 bg-gray-50 font-bold text-lg" 
                        required 
                        readOnly
                    />
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 disabled:opacity-50"
                >
                    {loading ? 'Adicionando...' : 'Adicionar Item'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\PagamentoPecaForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface PagamentoPecaFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const PagamentoPecaForm = ({ onSuccess, onCancel }: PagamentoPecaFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: id_item_os, id_fornecedor, custo_real, data_compra, data_pagamento_fornecedor?, pago_ao_fornecedor
    const [idItemOs, setIdItemOs] = useState('');
    const [idFornecedor, setIdFornecedor] = useState('');
    const [custoReal, setCustoReal] = useState('');
    const [dataCompra, setDataCompra] = useState('');
    const [dataPagamentoFornecedor, setDataPagamentoFornecedor] = useState('');
    const [pagoAoFornecedor, setPagoAoFornecedor] = useState(false);

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                id_item_os: Number(idItemOs),
                id_fornecedor: Number(idFornecedor),
                custo_real: Number(custoReal),
                data_compra: new Date(dataCompra).toISOString(),
                data_pagamento_fornecedor: dataPagamentoFornecedor ? new Date(dataPagamentoFornecedor).toISOString() : null,
                pago_ao_fornecedor: pagoAoFornecedor
            };

            const response = await api.post('/pagamento-peca', payload);
            alert('Pagamento de peça registrado com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao registrar pagamento de peça.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="bg-orange-50 p-3 rounded text-sm text-orange-800 border border-orange-100">
                <strong>Rastreio de Custo Real:</strong> Registre o custo efetivo pago ao fornecedor.
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">ID Item OS *</label>
                    <input 
                        type="number"
                        value={idItemOs} 
                        onChange={e => setIdItemOs(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                        placeholder="ID do item da OS"
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">ID Fornecedor *</label>
                    <input 
                        type="number"
                        value={idFornecedor} 
                        onChange={e => setIdFornecedor(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                        placeholder="ID do fornecedor"
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Custo Real (R$) *</label>
                    <input 
                        type="number"
                        step="0.01"
                        value={custoReal} 
                        onChange={e => setCustoReal(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Data da Compra *</label>
                    <input 
                        type="date"
                        value={dataCompra} 
                        onChange={e => setDataCompra(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Data Pagamento Fornecedor</label>
                    <input 
                        type="date"
                        value={dataPagamentoFornecedor} 
                        onChange={e => setDataPagamentoFornecedor(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                    />
                </div>

                <div className="flex items-center">
                    <label className="flex items-center gap-2 cursor-pointer">
                        <input 
                            type="checkbox"
                            checked={pagoAoFornecedor} 
                            onChange={e => setPagoAoFornecedor(e.target.checked)} 
                            className="w-5 h-5 text-green-600"
                        />
                        <span className="text-sm font-bold text-gray-700">Pago ao Fornecedor</span>
                    </label>
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700 disabled:opacity-50"
                >
                    {loading ? 'Salvando...' : 'Registrar Pagamento'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\PecasEstoqueForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface PecasEstoqueFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const PecasEstoqueForm = ({ onSuccess, onCancel }: PecasEstoqueFormProps) => {
    const [loading, setLoading] = useState(false);

    // Form States
    const [nome, setNome] = useState('');
    const [descricao, setDescricao] = useState('');
    const [fabricante, setFabricante] = useState('');
    const [unidadeMedida, setUnidadeMedida] = useState('');
    const [valorCusto, setValorCusto] = useState('');
    const [valorVenda, setValorVenda] = useState('');
    const [estoqueAtual, setEstoqueAtual] = useState('');
    const [custoUnitarioPadrao, setCustoUnitarioPadrao] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                nome,
                descricao,
                fabricante,
                unidade_medida: unidadeMedida,
                valor_custo: Number(valorCusto),
                valor_venda: Number(valorVenda),
                estoque_atual: Number(estoqueAtual),
                custo_unitario_padrao: custoUnitarioPadrao ? Number(custoUnitarioPadrao) : 0
            };

            const response = await api.post('/pecas-estoque', payload);
            alert('Peça cadastrada com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao cadastrar peça.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Nome da Peça *</label>
                    <input value={nome} onChange={e => setNome(e.target.value)} className="w-full border p-2 rounded border-gray-300" required />
                </div>
                 <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Descrição Detalhada *</label>
                    <input value={descricao} onChange={e => setDescricao(e.target.value)} className="w-full border p-2 rounded border-gray-300" required />
                </div>
                
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Fabricante</label>
                    <input value={fabricante} onChange={e => setFabricante(e.target.value)} className="w-full border p-2 rounded border-gray-300" />
                </div>
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Unidade Medida</label>
                    <input value={unidadeMedida} onChange={e => setUnidadeMedida(e.target.value)} className="w-full border p-2 rounded border-gray-300" placeholder="Ex: UN, KG, LT" />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Valor Custo (R$) *</label>
                    <input type="number" step="0.01" value={valorCusto} onChange={e => setValorCusto(e.target.value)} className="w-full border p-2 rounded border-gray-300" required />
                </div>
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Valor Venda (R$) *</label>
                    <input type="number" step="0.01" value={valorVenda} onChange={e => setValorVenda(e.target.value)} className="w-full border p-2 rounded border-gray-300" required />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Estoque Atual *</label>
                    <input type="number" value={estoqueAtual} onChange={e => setEstoqueAtual(e.target.value)} className="w-full border p-2 rounded border-gray-300" required />
                </div>
                 <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Custo Padrão (Ref.)</label>
                    <input type="number" step="0.01" value={custoUnitarioPadrao} onChange={e => setCustoUnitarioPadrao(e.target.value)} className="w-full border p-2 rounded border-gray-300" />
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50"
                >
                    {loading ? 'Salvando...' : 'Salvar Peça'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\PessoaFisicaForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface PessoaFisicaFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const PessoaFisicaForm = ({ onSuccess, onCancel }: PessoaFisicaFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: id_pessoa, cpf?
    const [idPessoa, setIdPessoa] = useState('');
    const [cpf, setCpf] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                id_pessoa: Number(idPessoa),
                cpf: cpf || null
            };

            const response = await api.post('/pessoa-fisica', payload);
            alert('Pessoa Física cadastrada com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao cadastrar. Verifique se o ID da Pessoa existe.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="bg-blue-50 p-3 rounded text-sm text-blue-800 border border-blue-100">
                <strong>Pré-requisito:</strong> A Pessoa base deve estar cadastrada primeiro.
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">ID Pessoa *</label>
                    <input 
                        type="number"
                        value={idPessoa} 
                        onChange={e => setIdPessoa(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                        placeholder="Ex: 10"
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">CPF</label>
                    <input 
                        value={cpf} 
                        onChange={e => setCpf(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        maxLength={11}
                        placeholder="Somente números"
                    />
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50"
                >
                    {loading ? 'Salvando...' : 'Salvar Pessoa Física'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\PessoaForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface PessoaFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const PessoaForm = ({ onSuccess, onCancel }: PessoaFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: nome, genero?, dt_nascimento?, obs?
    const [nome, setNome] = useState('');
    const [genero, setGenero] = useState('');
    const [dtNascimento, setDtNascimento] = useState('');
    const [obs, setObs] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                nome,
                genero: genero || null,
                dt_nascimento: dtNascimento ? new Date(dtNascimento) : null,
                obs: obs || null
            };

            const response = await api.post('/pessoa', payload);
            alert('Pessoa cadastrada com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao cadastrar pessoa.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Nome Completo *</label>
                    <input 
                        value={nome} 
                        onChange={e => setNome(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Gênero</label>
                    <select value={genero} onChange={e => setGenero(e.target.value)} className="w-full border p-2 rounded border-gray-300">
                        <option value="">Selecione...</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Feminino">Feminino</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Data Nascimento</label>
                    <input 
                        type="date" 
                        value={dtNascimento} 
                        onChange={e => setDtNascimento(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                    />
                </div>

                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Observações</label>
                    <textarea 
                        value={obs} 
                        onChange={e => setObs(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        rows={3}
                    />
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50"
                >
                    {loading ? 'Salvando...' : 'Salvar Pessoa'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\PessoaJuridicaForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface PessoaJuridicaFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const PessoaJuridicaForm = ({ onSuccess, onCancel }: PessoaJuridicaFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: id_pessoa, razao_social, nome_fantasia?, cnpj?, inscricao_estadual?
    const [idPessoa, setIdPessoa] = useState('');
    const [razaoSocial, setRazaoSocial] = useState('');
    const [nomeFantasia, setNomeFantasia] = useState('');
    const [cnpj, setCnpj] = useState('');
    const [inscricaoEstadual, setInscricaoEstadual] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                id_pessoa: Number(idPessoa),
                razao_social: razaoSocial,
                nome_fantasia: nomeFantasia || null,
                cnpj: cnpj || null,
                inscricao_estadual: inscricaoEstadual || null
            };

            const response = await api.post('/pessoa-juridica', payload);
            alert('Pessoa Jurídica cadastrada com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao cadastrar. Verifique se o ID da Pessoa existe.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div className="bg-purple-50 p-3 rounded text-sm text-purple-800 border border-purple-100">
                <strong>Pré-requisito:</strong> A Pessoa base deve estar cadastrada primeiro.
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">ID Pessoa *</label>
                    <input 
                        type="number"
                        value={idPessoa} 
                        onChange={e => setIdPessoa(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                        placeholder="Ex: 10"
                    />
                </div>

                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Razão Social *</label>
                    <input 
                        value={razaoSocial} 
                        onChange={e => setRazaoSocial(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        required 
                    />
                </div>

                <div className="col-span-2">
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Nome Fantasia</label>
                    <input 
                        value={nomeFantasia} 
                        onChange={e => setNomeFantasia(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">CNPJ</label>
                    <input 
                        value={cnpj} 
                        onChange={e => setCnpj(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                        maxLength={14}
                        placeholder="Somente números"
                    />
                </div>

                <div>
                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Inscrição Estadual</label>
                    <input 
                        value={inscricaoEstadual} 
                        onChange={e => setInscricaoEstadual(e.target.value)} 
                        className="w-full border p-2 rounded border-gray-300" 
                    />
                </div>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 disabled:opacity-50"
                >
                    {loading ? 'Salvando...' : 'Salvar Pessoa Jurídica'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\TipoForm.tsx
================================================================================
import { useState } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';

interface TipoFormProps {
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
}

export const TipoForm = ({ onSuccess, onCancel }: TipoFormProps) => {
    const [loading, setLoading] = useState(false);
    
    // Schema: funcao?
    const [funcao, setFuncao] = useState('');

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setLoading(true);
        try {
            const payload = {
                funcao: funcao || null
            };

            const response = await api.post('/tipo', payload);
            alert('Tipo cadastrado com sucesso!');
            onSuccess(response.data);
        } catch (error) {
            console.error(error);
            alert('Erro ao cadastrar tipo.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div>
                <label className="block text-xs font-bold text-gray-700 uppercase mb-1">Função / Tipo</label>
                <input 
                    value={funcao} 
                    onChange={e => setFuncao(e.target.value)} 
                    className="w-full border p-2 rounded border-gray-300" 
                    placeholder="Ex: Cliente, Fornecedor, Parceiro..."
                />
                <p className="text-xs text-gray-500 mt-1">Define a função/categoria da pessoa ou empresa.</p>
            </div>

            <div className="flex gap-2 pt-4">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-gray-600 font-bold hover:bg-gray-100 rounded-lg">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading}
                    className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50"
                >
                    {loading ? 'Salvando...' : 'Salvar Tipo'}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\forms\VeiculoForm.tsx
================================================================================
import { useState, useEffect, useRef } from 'react';
import type { FormEvent } from 'react';
import { api } from '../../services/api';
import { normalizePlate } from '../../utils/normalize';
import { Car, Search, User, Check, X, CheckCircle, AlertCircle } from 'lucide-react';

interface VeiculoFormProps {
    clientId?: number | null;
    vehicleId?: number;
    initialData?: any;
    onSuccess: (newItem: any) => void;
    onCancel: () => void;
    onCreateClient?: () => void;
}

interface ClientResult {
    id_cliente: number;
    email: string;
    telefone_1: string;
    pessoa_fisica?: {
        pessoa: { nome: string };
        cpf: string;
    };
    pessoa_juridica?: {
        razao_social: string;
        nome_fantasia: string;
        cnpj: string;
    };
}

export const VeiculoForm = ({ clientId, vehicleId, initialData, onSuccess, onCancel, onCreateClient }: VeiculoFormProps) => {
    const [loading, setLoading] = useState(false);
    const [formStatus, setFormStatus] = useState<{ type: 'success' | 'error' | null, message: string }>({ type: null, message: '' });
    
    // Client Search State
    const [clientSearchTerm, setClientSearchTerm] = useState('');
    const [clientResults, setClientResults] = useState<ClientResult[]>([]);
    const [selectedOwner, setSelectedOwner] = useState<{id: number, name: string} | null>(null);
    const [isSearchingClient, setIsSearchingClient] = useState(false);

    const firstInputRef = useRef<HTMLInputElement>(null);

    // Form States
    const [placa, setPlaca] = useState('');
    const [marca, setMarca] = useState('');
    const [modelo, setModelo] = useState('');
    const [cor, setCor] = useState('');
    const [anoModelo, setAnoModelo] = useState('');
    const [combustivel, setCombustivel] = useState('Flex');
    const [chassi, setChassi] = useState('');

    useEffect(() => {
        if (firstInputRef.current) {
            firstInputRef.current.focus();
        }
    }, [clientId, vehicleId]);

    useEffect(() => {
        if (initialData) {
            setPlaca(initialData.placa || '');
            setMarca(initialData.marca || '');
            setModelo(initialData.modelo || '');
            setCor(initialData.cor || '');
            setAnoModelo(initialData.ano_modelo || '');
            setCombustivel(initialData.combustivel || 'Flex');
            setChassi(initialData.chassi || '');
        }
    }, [initialData]);

    const [clientActiveIndex, setClientActiveIndex] = useState(-1);
    
    const handleKeyDown = (e: React.KeyboardEvent) => {
        if (e.key === 'Escape') {
            setClientResults([]);
            setClientActiveIndex(-1);
            return;
        }

        if (clientResults.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            const next = clientActiveIndex + 1 >= clientResults.length ? 0 : clientActiveIndex + 1;
            setClientActiveIndex(next);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            const prev = clientActiveIndex - 1 < 0 ? clientResults.length - 1 : clientActiveIndex - 1;
            setClientActiveIndex(prev);
        } else if (e.key === 'Enter' && clientActiveIndex !== -1) {
            e.preventDefault();
            selectClient(clientResults[clientActiveIndex]);
        }
    };

    const handleSearchClient = async (term: string) => {
        setClientSearchTerm(term);
        setClientActiveIndex(-1);
        if (term.length < 3) {
            setClientResults([]);
            return;
        }

        setIsSearchingClient(true);
        try {
            const response = await api.get(`/cliente/search?name=${term}`);
            setClientResults(response.data);
        } catch (error) {
            console.error('Erro ao buscar clientes', error);
        } finally {
            setIsSearchingClient(false);
        }
    };

    const selectClient = (client: ClientResult) => {
        const name = client.pessoa_fisica?.pessoa?.nome || 
                     client.pessoa_juridica?.nome_fantasia || 
                     client.pessoa_juridica?.razao_social || 
                     'Cliente Sem Nome';
        
        setSelectedOwner({ id: client.id_cliente, name });
        setClientResults([]);
        setClientSearchTerm('');
        setClientActiveIndex(-1);
    };

    const handleSubmit = async (e: FormEvent) => {
        e.preventDefault();
        setFormStatus({ type: null, message: '' });
        
        const finalClientId = clientId || selectedOwner?.id;

        // For creation, clientId is required.
        if (!vehicleId && !finalClientId) {
            setFormStatus({ type: 'error', message: 'É necessário selecionar um proprietário.' });
            return;
        }

        setLoading(true);
        try {
            const payload = {
                id_cliente: finalClientId, 
                placa: normalizePlate(placa),
                marca,
                modelo,
                cor,
                ano_modelo: anoModelo,
                combustivel,
                chassi
            };

            if (vehicleId) {
                const response = await api.put(`/veiculo/${vehicleId}`, payload);
                setFormStatus({ type: 'success', message: 'Veículo atualizado com sucesso!' });
                setTimeout(() => onSuccess(response.data), 1500);
            } else {
                const response = await api.post('/veiculo', payload);
                setFormStatus({ type: 'success', message: 'Veículo cadastrado com sucesso!' });
                setTimeout(() => onSuccess(response.data), 1500);
            }
        } catch (error: any) {
            console.error(error);
            setFormStatus({ type: 'error', message: 'Erro ao salvar veículo: ' + (error.response?.data?.error || error.message) });
        } finally {
            setLoading(false);
        }
    };

    // Helper to determine if we need to show client selection
    const needsClientSelection = !vehicleId && !clientId;

    return (
        <form onSubmit={handleSubmit} className="space-y-6 text-neutral-900">
            {formStatus.type && (
                <div className={`p-4 rounded-xl flex items-center gap-3 animate-in fade-in slide-in-from-top-2 duration-300 ${formStatus.type === 'success' ? 'bg-success-50 text-success-700 border border-success-100' : 'bg-red-50 text-red-700 border border-red-100'}`}>
                    {formStatus.type === 'success' ? <CheckCircle size={20} /> : <AlertCircle size={20} />}
                    <p className="text-sm font-bold">{formStatus.message}</p>
                </div>
            )}
            
            {/* 1. Client Selection Section (Only for new vehicles where ID isn't pre-injected) */}
            {needsClientSelection && (
                <div className="space-y-3 p-4 bg-neutral-50 rounded-xl border border-neutral-200">
                    <div className="flex items-center gap-2 mb-2">
                        <User className="text-primary-600" size={20} />
                        <h3 className="font-bold text-neutral-800">Proprietário do Veículo</h3>
                    </div>

                    {!selectedOwner ? (
                        <div className="relative">
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400" size={18} />
                            <input
                                ref={firstInputRef}
                                type="text"
                                placeholder="Buscar cliente por nome..."
                                className="w-full pl-10 pr-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-200 outline-none font-bold"
                                value={clientSearchTerm}
                                onChange={(e) => handleSearchClient(e.target.value)}
                                onKeyDown={handleKeyDown}
                            />
                            
                            {/* Results Dropdown */}
                            {clientResults.length > 0 && (
                                <div className="absolute z-10 w-full mt-1 bg-white border border-neutral-200 rounded-lg shadow-lg max-h-48 overflow-y-auto">
                                    {clientResults.map((client, idx) => {
                                         const name = client.pessoa_fisica?.pessoa?.nome || client.pessoa_juridica?.nome_fantasia || client.pessoa_juridica?.razao_social;
                                         const contact = client.telefone_1 || client.email || 'Sem Contato';
                                         return (
                                            <button
                                                key={client.id_cliente}
                                                type="button"
                                                onClick={() => selectClient(client)}
                                                className={`w-full text-left p-3 hover:bg-primary-50 transition-colors border-b border-neutral-100 last:border-0 ${idx === clientActiveIndex ? 'bg-primary-100' : ''}`}
                                            >
                                                <div className="font-bold text-sm text-neutral-800">{name}</div>
                                                <div className="text-xs text-neutral-500">{contact}</div>
                                            </button>
                                         );
                                    })}
                                </div>
                            )}
                            {clientSearchTerm.length > 2 && clientResults.length === 0 && !isSearchingClient && (
                                <div className="mt-2 text-center">
                                    <p className="text-xs text-neutral-500 mb-2">Nenhum cliente encontrado.</p>
                                    {onCreateClient && (
                                        <button 
                                            type="button" 
                                            onClick={onCreateClient}
                                            className="text-sm text-primary-600 font-bold hover:underline"
                                        >
                                            + Cadastrar Novo Cliente
                                        </button>
                                    )}
                                </div>
                            )}
                        </div>
                    ) : (
                        <div className="flex items-center justify-between bg-primary-50 p-3 rounded-lg border border-primary-100">
                            <div className="flex items-center gap-3">
                                <div className="bg-primary-600 text-white p-2 rounded-full">
                                    <Check size={16} />
                                </div>
                                <div>
                                    <p className="text-xs text-primary-600 font-bold uppercase">Cliente Selecionado</p>
                                    <p className="font-bold text-primary-900">{selectedOwner.name}</p>
                                </div>
                            </div>
                            <button 
                                type="button"
                                onClick={() => setSelectedOwner(null)}
                                className="p-2 text-primary-600 hover:bg-primary-100 rounded-lg transition-colors"
                                title="Alterar Cliente"
                            >
                                <X size={18} />
                            </button>
                        </div>
                    )}
                </div>
            )}

            {/* 2. Vehicle Info Section */}
            <div className="space-y-4">
                <div className="bg-primary-50 p-4 rounded-lg flex items-center gap-3">
                    <Car className="text-primary-600" size={24} />
                    <div>
                        <h3 className="font-bold text-primary-900">Dados do Veículo</h3>
                        <p className="text-xs text-primary-700">Preencha as informações do veículo.</p>
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Placa *</label>
                        <input 
                            ref={needsClientSelection ? null : firstInputRef}
                            value={placa} 
                            onChange={e => setPlaca(e.target.value.toUpperCase())} 
                            maxLength={7}
                            className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 font-mono tracking-wider font-bold placeholder:text-neutral-300"
                            placeholder="ABC1234"
                            required 
                        />
                    </div>
                    <div>
                         <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Marca *</label>
                         <input value={marca} onChange={e => setMarca(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 font-bold" required />
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Modelo *</label>
                        <input value={modelo} onChange={e => setModelo(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 font-bold" required />
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Cor *</label>
                        <input value={cor} onChange={e => setCor(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 font-bold" required />
                    </div>
                     <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Ano Modelo (YYYY)</label>
                        <input type="number" value={anoModelo} onChange={e => setAnoModelo(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 font-bold" />
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Combustível</label>
                         <select value={combustivel} onChange={e => setCombustivel(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 font-bold">
                            <option value="Flex">Flex</option>
                            <option value="Gasolina">Gasolina</option>
                            <option value="Etanol">Etanol</option>
                            <option value="Diesel">Diesel</option>
                            <option value="GNV">GNV</option>
                            <option value="Elétrico">Elétrico</option>
                         </select>
                    </div>
                    <div className="col-span-2">
                        <label className="block text-xs font-bold text-neutral-600 uppercase mb-1">Chassi</label>
                        <input value={chassi} onChange={e => setChassi(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-primary-100 outline-none border-neutral-300 font-mono font-bold" />
                    </div>
                </div>
            </div>

            <div className="flex gap-2 pt-4 border-t border-neutral-100">
                <button type="button" onClick={onCancel} className="flex-1 py-3 text-neutral-600 font-bold hover:bg-neutral-100 rounded-lg transition-colors">
                    Cancelar
                </button>
                <button 
                    type="submit" 
                    disabled={loading || (!clientId && !selectedOwner && !vehicleId)}
                    className="flex-1 py-3 bg-primary-600 text-white font-black rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg shadow-primary-500/30"
                >
                    {loading ? 'Salvando...' : (vehicleId ? 'Salvar Alterações' : 'Salvar Veículo')}
                </button>
            </div>
        </form>
    );
};



================================================================================
FILE PATH: client\src\components\layouts\MainLayout.tsx
================================================================================
import { Outlet } from 'react-router-dom';
import { Sidebar } from '../Sidebar';

export function MainLayout() {
  return (
    <div className="flex bg-background min-h-screen">
      <Sidebar />
      <main className="flex-1 ml-64 p-8 overflow-y-auto">
        <div className="max-w-7xl mx-auto">
          {/* Breadcrumbs ou Header Global poderiam entrar aqui */}
          <Outlet />
        </div>
      </main>
    </div>
  );
}


================================================================================
FILE PATH: client\src\components\ui\Modal.tsx
================================================================================
import React, { useEffect } from 'react';
import { X } from 'lucide-react';

interface ModalProps {
    title: React.ReactNode;
    children: React.ReactNode;
    onClose: () => void;
}

export const Modal = ({ title, children, onClose }: ModalProps) => {
    // Close on Escape key
    useEffect(() => {
        const handleEsc = (e: KeyboardEvent) => {
            if (e.key === 'Escape') onClose();
        };
        window.addEventListener('keydown', handleEsc);
        return () => window.removeEventListener('keydown', handleEsc);
    }, [onClose]);

    return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200">
            <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col animate-in zoom-in-95 duration-200">
                {/* Header */}
                <div className="flex items-center justify-between p-4 border-b border-neutral-100">
                    <h2 className="text-xl font-bold text-neutral-900">{title}</h2>
                    <button 
                        onClick={onClose}
                        className="p-2 text-neutral-400 hover:text-error hover:bg-error-50 rounded-lg transition-colors"
                    >
                        <X size={20} />
                    </button>
                </div>

                {/* Content */}
                <div className="p-6 overflow-y-auto custom-scrollbar">
                    {children}
                </div>
            </div>
        </div>
    );
};



================================================================================
FILE PATH: client\src\components\ui\StatusBanner.tsx
================================================================================
import { CheckCircle, AlertCircle, X } from 'lucide-react';

interface StatusBannerProps {
    msg: {
        type: 'success' | 'error' | null;
        text: string;
    };
    onClose: () => void;
}

export const StatusBanner = ({ msg, onClose }: StatusBannerProps) => {
    if (!msg.text) return null;
    const isSuccess = msg.type === 'success';
    
    return (
        <div className={`mb-6 p-4 rounded-xl flex items-center justify-between gap-3 animate-in fade-in slide-in-from-top-2 duration-300 font-bold border ${
            isSuccess ? 'bg-success/10 text-success border-success/20' : 'bg-error/10 text-error border-error/20'
        }`}>
            <div className="flex items-center gap-3">
                {isSuccess ? <CheckCircle size={20} className="shrink-0" /> : <AlertCircle size={20} className="shrink-0" />}
                <span className="uppercase text-xs tracking-wider">{msg.text}</span>
            </div>
            <button 
                type="button"
                onClick={onClose} 
                className="opacity-40 hover:opacity-100 transition-opacity p-1"
            >
                <X size={16} />
            </button>
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\ClientePage.tsx
================================================================================
import { useState, useEffect, useRef, Fragment } from 'react';
import { api } from '../services/api';
// import type { ICliente } from '../types/backend'; // Extending locally to include relations
import { Search, Plus, Trash2, Edit, MapPin, Phone, Mail, User, Car } from 'lucide-react';
import { ClienteForm } from '../components/forms/ClienteForm';
import { VeiculoForm } from '../components/forms/VeiculoForm';
import { Modal } from '../components/ui/Modal';
import { StatusBanner } from '../components/ui/StatusBanner';

// Extended Interface for View (assuming backend returns relations)
interface IClienteView {
  id_cliente: number;
  telefone_1: string;
  telefone_2?: string;
  email?: string;
  logradouro: string;
  nr_logradouro: string;
  compl_logradouro?: string;
  bairro: string;
  cidade: string;
  estado: string;
  id_pessoa_juridica?: number | null;
  pessoa_fisica?: {
      id_pessoa_fisica: number;
      cpf?: string;
      pessoa: {
          nome: string;
      };
  };
  pessoa_juridica?: {
      id_pessoa_juridica: number;
      razao_social: string;
      nome_fantasia?: string;
      cnpj?: string;
  };
  veiculos?: Array<{
    id_veiculo: number;
    placa: string;
    marca: string;
    modelo: string;
    cor: string;
  }>;
}

export const ClientePage = () => {
  const [clientes, setClientes] = useState<IClienteView[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [showModal, setShowModal] = useState(false);

  const [editingClient, setEditingClient] = useState<IClienteView | undefined>(undefined);
  const [expandedRows, setExpandedRows] = useState<Set<number>>(new Set());
  const [showVehicleModal, setShowVehicleModal] = useState(false);
  const [selectedClientIdForVehicle, setSelectedClientIdForVehicle] = useState<number | null>(null);

  useEffect(() => {
    loadClientes();
  }, []);

  const [statusMsg, setStatusMsg] = useState<{ type: 'success' | 'error' | null, text: string }>({ type: null, text: '' });

  const loadClientes = async () => {
    try {
      setLoading(true);
      const response = await api.get('/cliente');
      setClientes(response.data);
    } catch (error) {
      console.error(error);
      setStatusMsg({ type: 'error', text: 'Erro ao carregar clientes.' });
    } finally {
      setLoading(false);
    }
  };

  const getNome = (c: IClienteView) => {
    if (c.pessoa_fisica) return c.pessoa_fisica.pessoa.nome;
    if (c.pessoa_juridica) return c.pessoa_juridica.razao_social; // or nome_fantasia
    return 'Nome Indisponível';
  };

  const handleDelete = async (id: number) => {
      if (!confirm('Tem certeza que deseja excluir este cliente?')) return;
      try {
          await api.delete(`/cliente/${id}`);
          setStatusMsg({ type: 'success', text: 'Cliente removido com sucesso!' });
          setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
          loadClientes();
      } catch (error) {
          setStatusMsg({ type: 'error', text: 'Erro ao excluir cliente.' });
      }
  };

  const openCreateModal = () => {
      setEditingClient(undefined);
      setShowModal(true);
  };

  const openEditModal = (client: IClienteView) => {
      setEditingClient(client);
      setShowModal(true);
  };

  const toggleRow = (id: number) => {
    const newExpanded = new Set(expandedRows);
    if (newExpanded.has(id)) newExpanded.delete(id);
    else newExpanded.add(id);
    setExpandedRows(newExpanded);
  };

  const handleRegisterVehicle = (clientId: number) => {
    setSelectedClientIdForVehicle(clientId);
    setShowModal(false);
    setShowVehicleModal(true);
  };

  const filteredClientes = clientes.filter(c => {
    const search = searchTerm.toLowerCase();
    const nome = getNome(c).toLowerCase();
    const email = c.email?.toLowerCase() || '';
    const cidade = c.cidade.toLowerCase();
    const id = c.id_cliente.toString();
    
    return nome.includes(search) || 
           email.includes(search) || 
           cidade.includes(search) || 
           id.includes(search);
  });

  const [activeIndex, setActiveIndex] = useState(-1);
  const searchInputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    if (searchInputRef.current) searchInputRef.current.focus();
  }, []);

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (filteredClientes.length === 0) return;

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      setActiveIndex(prev => (prev + 1 >= filteredClientes.length ? 0 : prev + 1));
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      setActiveIndex(prev => (prev - 1 < 0 ? filteredClientes.length - 1 : prev - 1));
    } else if (e.key === 'Enter') {
      if (activeIndex !== -1) {
        e.preventDefault();
        toggleRow(filteredClientes[activeIndex].id_cliente);
      }
    } else if (e.key === 'Escape') {
      setSearchTerm('');
      setActiveIndex(-1);
    }
  };

  useEffect(() => {
    setActiveIndex(-1);
  }, [searchTerm]);

  return (
    <div className="space-y-6">

      
      {/* Header da Página */}
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
          <h1 className="text-2xl font-bold text-neutral-900">Clientes</h1>
          <p className="text-neutral-500">Gerencie sua base de clientes e contatos.</p>
        </div>
        <button 
            onClick={openCreateModal}
            className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2.5 rounded-lg font-medium transition-all shadow-sm"
        >
          <Plus size={20} />
          Novo Cliente
        </button>
      </div>

      {/* Barra de Filtros */}
      <div className="bg-surface p-4 rounded-xl shadow-sm border border-neutral-200 flex gap-4">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400" size={20} />
          <input 
            ref={searchInputRef}
            type="text"
            placeholder="Buscar por nome, email ou cidade..."
            className="w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all text-neutral-900"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            onKeyDown={handleKeyDown}
          />
        </div>
      </div>

      {/* Tabela Moderna */}
      <div className="bg-surface rounded-xl shadow-sm border border-neutral-200 overflow-hidden">
        {loading ? (
          <div className="p-8 text-center text-neutral-500">Carregando dados...</div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full text-left border-collapse">
              <thead>
                <tr className="bg-neutral-50 border-b border-neutral-200 text-xs uppercase tracking-wider text-neutral-500 font-semibold">
                  <th className="p-4">Cliente</th>
                  <th className="p-4">Contato</th>
                  <th className="p-4">Localização</th>
                  <th className="p-4">Tipo</th>
                  <th className="p-4 text-right">Ações</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-neutral-100">
                {filteredClientes.map((c, idx) => (
                  <Fragment key={c.id_cliente}>
                    <tr className={`transition-colors hover:bg-neutral-25 cursor-pointer ${idx === activeIndex ? 'bg-primary-50 ring-2 ring-primary-500 ring-inset' : ''}`}>
                      <td className="p-4 cursor-pointer" onClick={() => toggleRow(c.id_cliente)}>
                        <div className="flex items-center gap-3">
                          <div className={`p-2 rounded-full transition-colors ${expandedRows.has(c.id_cliente) ? 'bg-primary-600 text-white' : 'bg-primary-50 text-primary-600'}`}>
                             <User size={16} />
                          </div>
                          <div>
                              <span className="font-bold text-neutral-900 block">{getNome(c)}</span>
                              <span className="text-xs text-neutral-500 font-bold">{c.telefone_1}</span>
                          </div>
                        </div>
                      </td>
                      <td className="p-4">
                        <div className="flex flex-col gap-1">
                          {c.email && (
                              <div className="flex items-center gap-2 text-sm text-neutral-600">
                                  <Mail size={12} /> {c.email}
                              </div>
                          )}
                          <div className="flex items-center gap-2 text-sm text-neutral-600">
                             <Phone size={12} /> {c.telefone_1}
                          </div>
                        </div>
                      </td>
                      <td className="p-4">
                        <div className="flex items-center gap-2 text-sm text-neutral-600">
                          <MapPin size={14} className="text-neutral-400" />
                          {c.cidade}, {c.estado}
                        </div>
                        <span className="text-xs text-neutral-400 ml-6">{c.bairro}</span>
                      </td>
                      <td className="p-4">
                        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                          ${c.id_pessoa_juridica ? 'bg-accent-50 text-accent-600' : 'bg-primary-50 text-primary-600'}`}>
                          {c.id_pessoa_juridica ? 'Jurídica' : 'Física'}
                        </span>
                      </td>
                      <td className="p-4 text-right">
                        <div className="flex items-center justify-end gap-2">
                          <button 
                              onClick={() => handleRegisterVehicle(c.id_cliente)}
                              className="p-2 text-neutral-400 hover:text-success-600 hover:bg-success-50 rounded-lg transition-colors"
                              title="Adicionar Veículo"
                          >
                            <Plus size={18} />
                          </button>
                          <button 
                              onClick={() => openEditModal(c)}
                              className="p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors"
                          >
                            <Edit size={18} />
                          </button>
                          <button 
                              onClick={() => handleDelete(c.id_cliente)}
                              className="p-2 text-neutral-400 hover:text-error hover:bg-red-50 rounded-lg transition-colors"
                          >
                            <Trash2 size={18} />
                          </button>
                        </div>
                      </td>
                    </tr>
                    {expandedRows.has(c.id_cliente) && (
                      <tr className="bg-neutral-50/50 animate-in fade-in slide-in-from-top-1 duration-200">
                        <td colSpan={5} className="p-4 pt-0">
                          <div className="ml-12 border-l-2 border-primary-200 pl-6 py-2 space-y-3">
                            <div className="flex items-center justify-between">
                              <h4 className="text-[10px] font-black uppercase text-neutral-400 tracking-widest">Veículos do Cliente ({c.veiculos?.length || 0})</h4>
                              <button 
                                onClick={() => handleRegisterVehicle(c.id_cliente)}
                                className="text-[10px] font-black text-primary-600 hover:underline uppercase"
                              >
                                + Adicionar Veículo
                              </button>
                            </div>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                              {c.veiculos?.length ? c.veiculos.map(v => (
                                <div key={v.id_veiculo} className="bg-white p-3 rounded-xl border border-neutral-200 shadow-sm flex items-center justify-between group hover:border-primary-300 transition-all">
                                  <div>
                                    <p className="text-xs font-black text-neutral-800 tracking-widest uppercase">{v.placa}</p>
                                    <p className="text-[10px] text-neutral-500 font-bold uppercase">{v.marca} {v.modelo} • {v.cor}</p>
                                  </div>
                                  <Car size={16} className="text-neutral-200 group-hover:text-primary-500 transition-colors" />
                                </div>
                              )) : (
                                <p className="text-xs text-neutral-400 italic">Nenhum veículo cadastrado.</p>
                              )}
                            </div>
                          </div>
                        </td>
                      </tr>
                    )}
                  </Fragment>
                ))}
                {filteredClientes.length === 0 && (
                  <tr>
                    <td colSpan={5} className="p-8 text-center text-neutral-400">
                      Nenhum cliente encontrado.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {showModal && (
        <Modal title={editingClient ? "Editar Cliente" : "Novo Cliente"} onClose={() => setShowModal(false)}>
            <ClienteForm 
                clientId={editingClient?.id_cliente}
                initialData={editingClient}
                onSuccess={() => {
                    setShowModal(false);
                    loadClientes();
                }}
                onRegisterVehicle={(data) => {
                    handleRegisterVehicle(data.id_cliente);
                }}
                onCancel={() => setShowModal(false)}
            />
        </Modal>
      )}

      {showVehicleModal && selectedClientIdForVehicle && (
        <Modal title="Cadastrar Veículo para Cliente" onClose={() => setShowVehicleModal(false)}>
          <VeiculoForm 
            clientId={selectedClientIdForVehicle}
            onSuccess={() => {
              setShowVehicleModal(false);
              loadClientes();
            }}
            onCancel={() => setShowVehicleModal(false)}
          />
        </Modal>
      )}
      <div className="fixed bottom-8 right-8 z-100 min-w-[320px]">
        <StatusBanner msg={statusMsg} onClose={() => setStatusMsg({type: null, text: ''})} />
      </div>
    </div>
  );
};


================================================================================
FILE PATH: client\src\pages\FechamentoFinanceiroPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import { FechamentoFinanceiroForm } from '../components/forms/FechamentoFinanceiroForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, TrendingUp, DollarSign } from 'lucide-react';

interface IFechamentoFinanceiro {
    id_fechamento_financeiro: number;
    id_os: number;
    custo_total_pecas_real: number;
    data_fechamento_financeiro: string;
}

export const FechamentoFinanceiroPage = () => {
    const [fechamentos, setFechamentos] = useState<IFechamentoFinanceiro[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [foundFechamento, setFoundFechamento] = useState<IFechamentoFinanceiro | null>(null);

    useEffect(() => {
        loadFechamentos();
    }, []);

    const loadFechamentos = async () => {
        try {
            const response = await api.get('/fechamento-financeiro');
            setFechamentos(response.data);
        } catch (error) {
            alert('Erro ao carregar fechamentos');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/fechamento-financeiro/${searchId}`);
            setFoundFechamento(response.data);
        } catch (error) {
            alert('Fechamento não encontrado');
            setFoundFechamento(null);
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/fechamento-financeiro/${searchId}`);
            alert('Fechamento deletado!');
            loadFechamentos();
            setFoundFechamento(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar fechamento');
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-neutral-900">Fechamento Financeiro</h1>
                    <p className="text-neutral-500">Consolidação de custos reais para cálculo de lucro.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-success text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all hover:opacity-90"
                >
                    <Plus size={20} />
                    Novo Fechamento
                </button>
            </div>

            {/* STATS */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div className="bg-linear-to-br from-success to-success-700 p-6 rounded-xl text-white shadow-lg">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-success-50 text-sm font-medium opacity-80">Total Fechamentos</p>
                            <p className="text-3xl font-bold mt-1">{fechamentos.length}</p>
                        </div>
                        <TrendingUp size={40} className="opacity-50" />
                    </div>
                </div>

                <div className="bg-linear-to-br from-primary-500 to-primary-700 p-6 rounded-xl text-white shadow-lg">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-primary-50 text-sm font-medium opacity-80">Custo Total Peças</p>
                            <p className="text-3xl font-bold mt-1">
                                R$ {fechamentos.reduce((acc, f) => acc + Number(f.custo_total_pecas_real), 0).toFixed(2)}
                            </p>
                        </div>
                        <DollarSign size={40} className="opacity-50" />
                    </div>
                </div>

                <div className="bg-linear-to-br from-accent-600 to-accent-700 p-6 rounded-xl text-white shadow-lg">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-accent-50 text-sm font-medium opacity-80">Média por OS</p>
                            <p className="text-3xl font-bold mt-1">
                                R$ {fechamentos.length > 0 ? (fechamentos.reduce((acc, f) => acc + Number(f.custo_total_pecas_real), 0) / fechamentos.length).toFixed(2) : '0.00'}
                            </p>
                        </div>
                        <TrendingUp size={40} className="opacity-50" />
                    </div>
                </div>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID Fechamento</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID OS</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Custo Total Peças</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Data Fechamento</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {fechamentos.map((fech) => (
                            <tr key={fech.id_fechamento_financeiro} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{fech.id_fechamento_financeiro}</td>
                                <td className="p-4 text-slate-600 font-bold">OS #{fech.id_os}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-2">
                                        <DollarSign size={16} className="text-green-600" />
                                        <span className="font-bold text-green-700">R$ {Number(fech.custo_total_pecas_real).toFixed(2)}</span>
                                    </div>
                                </td>
                                <td className="p-4 text-xs text-slate-500">
                                    {new Date(fech.data_fechamento_financeiro).toLocaleDateString('pt-BR')} às {new Date(fech.data_fechamento_financeiro).toLocaleTimeString('pt-BR')}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Consultar/Excluir Fechamento (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID do Fechamento..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {foundFechamento && (
                    <div className="bg-green-50 p-4 rounded border border-green-200 animate-in fade-in">
                        <h3 className="font-bold mb-2 text-green-800">Fechamento Encontrado</h3>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <p className="text-xs text-gray-600">ID OS</p>
                                <p className="font-bold text-lg">#{foundFechamento.id_os}</p>
                            </div>
                            <div>
                                <p className="text-xs text-gray-600">Custo Total Peças</p>
                                <p className="font-bold text-lg text-green-700">R$ {Number(foundFechamento.custo_total_pecas_real).toFixed(2)}</p>
                            </div>
                        </div>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Novo Fechamento Financeiro" onClose={() => setShowModal(false)}>
                    <FechamentoFinanceiroForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadFechamentos();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\FornecedorPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { IFornecedor } from '../types/backend';
import { FornecedorForm } from '../components/forms/FornecedorForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, Truck } from 'lucide-react';

export const FornecedorPage = () => {
    const [fornecedores, setFornecedores] = useState<IFornecedor[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IFornecedor | null>(null);

    useEffect(() => {
        loadFornecedores();
    }, []);

    const loadFornecedores = async () => {
        try {
            const response = await api.get('/fornecedor');
            setFornecedores(response.data);
        } catch (error) {
            alert('Erro ao carregar fornecedores');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/fornecedor/${searchId}`);
            setEditData(response.data);
        } catch (error) {
            alert('Fornecedor não encontrado');
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/fornecedor/${editData.id_fornecedor}`, editData);
            alert('Fornecedor atualizado!');
            loadFornecedores();
        } catch (error) {
            alert('Erro ao atualizar fornecedor');
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/fornecedor/${searchId}`);
            alert('Fornecedor deletado!');
            loadFornecedores();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar fornecedor');
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-slate-800">Fornecedores</h1>
                    <p className="text-slate-500">Cadastro de fornecedores de peças e serviços.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Novo Fornecedor
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Nome</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Documento</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Contato</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Cadastro</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {fornecedores.map((f) => (
                            <tr key={f.id_fornecedor} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{f.id_fornecedor}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-orange-50 p-2 rounded-lg text-orange-600">
                                            <Truck size={18} />
                                        </div>
                                        <span className="font-medium text-slate-900">{f.nome}</span>
                                    </div>
                                </td>
                                <td className="p-4 font-mono text-slate-700">{f.documento || '-'}</td>
                                <td className="p-4 text-slate-600">{f.contato || '-'}</td>
                                <td className="p-4 text-xs text-slate-500">
                                    {new Date(f.dt_cadastro).toLocaleDateString('pt-BR')}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção de Fornecedor (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID do Fornecedor..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando: {editData.nome}</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="col-span-2">
                                <label className="text-xs font-bold block mb-1">Nome</label>
                                <input 
                                    value={editData.nome} 
                                    onChange={(e) => setEditData({...editData, nome: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold block mb-1">Documento</label>
                                <input 
                                    value={editData.documento || ''} 
                                    onChange={(e) => setEditData({...editData, documento: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold block mb-1">Contato</label>
                                <input 
                                    value={editData.contato || ''} 
                                    onChange={(e) => setEditData({...editData, contato: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                        </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Novo Fornecedor" onClose={() => setShowModal(false)}>
                    <FornecedorForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadFornecedores();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\FuncionarioPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { IFuncionario } from '../types/backend';
import { FuncionarioForm } from '../components/forms/FuncionarioForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, Package, Briefcase, BadgeCheck, XCircle } from 'lucide-react';
import { StatusBanner } from '../components/ui/StatusBanner';

export const FuncionarioPage = () => {
    const [funcionarios, setFuncionarios] = useState<IFuncionario[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IFuncionario | null>(null);

    const [statusMsg, setStatusMsg] = useState<{ type: 'success' | 'error' | null, text: string }>({ type: null, text: '' });

    useEffect(() => {
        loadFuncionarios();
    }, []);

    const loadFuncionarios = async () => {
        try {
            const response = await api.get('/funcionario');
            setFuncionarios(response.data);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao carregar colaboradores.' });
        }
    };

    const handleSearch = async () => {
        if (!searchId) return;
        try {
            const response = await api.get(`/funcionario/${searchId}`);
            setEditData(response.data);
            setStatusMsg({ type: 'success', text: 'Colaborador localizado!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 2000);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Colaborador não encontrado.' });
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/funcionario/${editData.id_funcionario}`, {
                 cargo: editData.cargo,
                 ativo: editData.ativo,
                 salario: Number(editData.salario),
                 comissao: Number(editData.comissao),
                 obs: editData.obs
            });
            setStatusMsg({ type: 'success', text: 'Colaborador atualizado com sucesso!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
            loadFuncionarios();
            setEditData(null);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao atualizar colaborador.' });
        }
    };

    const handleDelete = async (id: number) => {
        if (!confirm('Tem certeza que deseja excluir este funcionário?')) return;
        try {
            await api.delete(`/funcionario/${id}`);
            setStatusMsg({ type: 'success', text: 'Colaborador removido com sucesso!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
            loadFuncionarios();
            if (editData?.id_funcionario === id) setEditData(null);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao remover colaborador. Verifique se há vínculos.' });
        }
    };

    return (
        <div className="space-y-6 animate-in fade-in duration-500">
            <StatusBanner msg={statusMsg} onClose={() => setStatusMsg({type: null, text: ''})} />

            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h1 className="text-2xl font-black text-neutral-900 tracking-tight">Equipe e Funcionários</h1>
                    <p className="text-neutral-500">Gestão de colaboradores e acesso ao sistema.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="group bg-neutral-900 text-white px-6 py-3.5 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-primary-600 transition-all shadow-xl shadow-black/10 flex items-center gap-2 active:scale-95"
                >
                    <Plus size={20} className="group-hover:rotate-90 transition-transform" />
                    Novo Funcionário
                </button>
            </div>

            {/* QUICK SEARCH */}
            <div className="flex flex-col md:flex-row gap-4 items-center bg-white p-4 rounded-2xl border border-neutral-100 shadow-sm">
                <div className="relative flex-1 group">
                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400 group-focus-within:text-primary-500 transition-colors" size={20} />
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Buscar funcionário por ID..." 
                        className="w-full pl-12 pr-4 py-3 bg-neutral-50 border border-neutral-100 rounded-xl focus:ring-4 focus:ring-primary-500/10 outline-none font-bold"
                    />
                </div>
                <button 
                    onClick={handleSearch}
                    className="bg-neutral-100 text-neutral-600 px-8 py-3 rounded-xl font-black text-xs uppercase hover:bg-neutral-200 transition-all"
                >
                    Localizar
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-3xl shadow-sm border border-neutral-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead>
                        <tr className="bg-neutral-50 text-[10px] font-black text-neutral-400 uppercase tracking-widest">
                            <th className="p-6">Funcionário</th>
                            <th className="p-6">Cargo</th>
                            <th className="p-6">Admissão</th>
                            <th className="p-6">Status</th>
                            <th className="p-6 text-right">Ações</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-neutral-50">
                        {funcionarios.length === 0 ? (
                            <tr>
                                <td colSpan={5} className="p-20 text-center">
                                    <div className="flex flex-col items-center gap-4">
                                        <div className="bg-neutral-50 p-6 rounded-full text-neutral-200">
                                            <Briefcase size={40} />
                                        </div>
                                        <p className="font-bold text-neutral-400">Nenhum funcionário cadastrado.</p>
                                    </div>
                                </td>
                            </tr>
                        ) : (
                            funcionarios.map((f: any) => (
                                <tr key={f.id_funcionario} className="hover:bg-neutral-50/50 transition-colors group">
                                    <td className="p-6">
                                        <div className="flex items-center gap-4">
                                            <div className="w-10 h-10 bg-primary-100 rounded-xl flex items-center justify-center text-primary-600 font-black">
                                                {f.pessoa_fisica?.pessoa?.nome?.charAt(0)}
                                            </div>
                                            <div>
                                                <p className="font-black text-neutral-900">{f.pessoa_fisica?.pessoa?.nome}</p>
                                                <p className="text-[10px] font-bold text-neutral-400 uppercase">#{String(f.id_funcionario).padStart(3, '0')}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td className="p-6">
                                        <p className="font-bold text-neutral-600">{f.cargo}</p>
                                    </td>
                                    <td className="p-6">
                                        <p className="text-sm font-medium text-neutral-500">
                                            {f.dt_admissao ? new Date(f.dt_admissao).toLocaleDateString() : '-'}
                                        </p>
                                    </td>
                                    <td className="p-6">
                                        {f.ativo === 'S' ? (
                                            <span className="inline-flex items-center gap-1.5 px-3 py-1.5 bg-success-50 text-success-700 rounded-lg text-[10px] font-black uppercase">
                                                <BadgeCheck size={14} /> Ativo
                                            </span>
                                        ) : (
                                            <span className="inline-flex items-center gap-1.5 px-3 py-1.5 bg-red-50 text-red-700 rounded-lg text-[10px] font-black uppercase">
                                                <XCircle size={14} /> Inativo
                                            </span>
                                        )}
                                    </td>
                                    <td className="p-6 text-right">
                                        <div className="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button 
                                                onClick={() => {
                                                    setSearchId(String(f.id_funcionario));
                                                    handleSearch();
                                                }}
                                                className="p-2 hover:bg-primary-50 text-primary-600 rounded-lg transition-colors"
                                            >
                                                <Edit size={18} />
                                            </button>
                                            <button 
                                                onClick={() => handleDelete(f.id_funcionario)}
                                                className="p-2 hover:bg-red-50 text-red-600 rounded-lg transition-colors"
                                            >
                                                <Trash2 size={18} />
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))
                        )}
                    </tbody>
                </table>
            </div>

            {/* EDIT MODAL/DRAWER */}
            {editData && (
                <div className="bg-neutral-900 p-8 rounded-3xl text-white shadow-2xl animate-in slide-in-from-bottom-10 duration-500">
                    <div className="flex justify-between items-start mb-6">
                        <div>
                            <h3 className="text-xl font-black flex items-center gap-3">
                                <Edit className="text-primary-400" /> Editando Colaborador
                            </h3>
                            <p className="text-neutral-400 text-sm">#{editData.id_funcionario} • {editData.pessoa_fisica?.pessoa?.nome}</p>
                        </div>
                        <button onClick={() => setEditData(null)} className="text-neutral-500 hover:text-white"><Plus size={24} className="rotate-45" /></button>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div>
                            <label className="text-[10px] font-black text-neutral-500 uppercase block mb-2">Cargo</label>
                            <input 
                                value={editData.cargo} 
                                onChange={(e) => setEditData({...editData, cargo: e.target.value})} 
                                className="w-full bg-neutral-800 border-none p-4 rounded-2xl focus:ring-2 focus:ring-primary-500 outline-none font-bold" 
                            />
                        </div>
                        <div>
                            <label className="text-[10px] font-black text-neutral-500 uppercase block mb-2">Salário Atual</label>
                            <input 
                                type="number"
                                value={editData.salario as any} 
                                onChange={(e) => setEditData({...editData, salario: e.target.value as any})} 
                                className="w-full bg-neutral-800 border-none p-4 rounded-2xl focus:ring-2 focus:ring-primary-500 outline-none font-bold" 
                            />
                        </div>
                        <div>
                            <label className="text-[10px] font-black text-neutral-500 uppercase block mb-2">Status</label>
                            <select 
                                value={editData.ativo}
                                onChange={(e) => setEditData({...editData, ativo: e.target.value})}
                                className="w-full bg-neutral-800 border-none p-4 rounded-2xl focus:ring-2 focus:ring-primary-500 outline-none font-bold text-primary-400"
                            >
                                <option value="S">ATIVO</option>
                                <option value="N">INATIVO</option>
                            </select>
                        </div>
                    </div>
                    
                    <button 
                        onClick={handleUpdate} 
                        className="w-full bg-primary-500 text-white py-5 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-primary-600 transition-all flex items-center justify-center gap-2 active:scale-95 shadow-xl shadow-primary-500/20"
                    >
                        Salvar Alterações <BadgeCheck size={20} />
                    </button>
                </div>
            )}

            {showModal && (
                <Modal title="Novo Colaborador" onClose={() => setShowModal(false)}>
                    <FuncionarioForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadFuncionarios();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\HomePage.tsx
================================================================================
import { useEffect, useState } from 'react';
import { Users, Wrench, DollarSign, CheckCircle } from 'lucide-react';
import { api } from '../services/api';
import { useNavigate } from 'react-router-dom';

const StatCard = ({ title, value, icon: Icon, color, onClick }: any) => (
  <div 
    onClick={onClick}
    className={`bg-white p-6 rounded-xl shadow-sm border border-neutral-100 flex items-center gap-4 cursor-pointer hover:shadow-md transition `}
  >
    <div className={`p-4 rounded-full ${color.replace('-500', '-50')} ${color.replace('bg-', 'text-')}`}>
      <Icon size={24} />
    </div>
    <div>
      <p className="text-sm text-neutral-500 font-medium">{title}</p>
      <h3 className="text-2xl font-bold text-neutral-900">{value}</h3>
    </div>
  </div>
);

export function HomePage() {
  const navigate = useNavigate();
  const [recentOss, setRecentOss] = useState<any[]>([]);
  const [stats, setStats] = useState({
    clientes: 0,
    osAndamento: 0,
    osFinalizada: 0,
    pagamentosPendentes: 0
  });

  useEffect(() => {
    fetchStats();
  }, []);

  const fetchStats = async () => {
    try {
      const [osRes, cliRes, pagRes] = await Promise.all([
        api.get('/ordem-de-servico'),
        api.get('/cliente'),
        api.get('/pagamento-peca')
      ]);

      const oss = osRes.data;
      const clientes = cliRes.data;
      const pagamentos = pagRes.data;

      const osAndamento = oss.filter((o: any) => o.status === 'ABERTA' || o.status === 'EM_ANDAMENTO').length;
      const osPronta = oss.filter((o: any) => o.status === 'PRONTO PARA FINANCEIRO').length;
      const osFinalizada = oss.filter((o: any) => o.status === 'FINALIZADA').length;
      const pagamentosPendentes = pagamentos.filter((p: any) => p.pago_ao_fornecedor === false).length;

      setStats({
        clientes: clientes.length,
        osAndamento,
        osFinalizada: osFinalizada + osPronta, // Somar prontas para o total de concluídas ou manter separado? O usuário quer ver as prontas.
        pagamentosPendentes
      });

      // Pegar as 5 mais recentes
      setRecentOss(oss.sort((a: any, b: any) => b.id_os - a.id_os).slice(0, 5));

    } catch (error) {
      console.error('Erro ao carregar estatísticas', error);
    }
  };

  const getStatusStyle = (status: string) => {
    switch (status) {
      case 'FINALIZADA': return 'bg-success-50 text-success-600 ring-success-200';
      case 'PAGA_CLIENTE': return 'bg-neutral-100 text-neutral-600 ring-neutral-200';
      case 'PRONTO PARA FINANCEIRO': return 'bg-warning-50 text-warning-600 ring-warning-200';
      case 'ABERTA': return 'bg-primary-50 text-primary-600 ring-primary-200';
      case 'EM_ANDAMENTO': return 'bg-info-50 text-info-600 ring-info-200';
      default: return 'bg-neutral-50 text-neutral-500 ring-neutral-200';
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold text-neutral-900">Visão Geral</h1>
        <span className="text-sm text-neutral-500">{new Date().toLocaleDateString()}</span>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <StatCard 
            title="Total Clientes" 
            value={stats.clientes} 
            icon={Users} 
            color="bg-primary-500" 
            onClick={() => navigate('/cliente')}
        />
        <StatCard 
            title="Serviços em Aberto" 
            value={stats.osAndamento} 
            icon={Wrench} 
            color="bg-warning-500" 
            onClick={() => navigate('/ordem-de-servico')}
        />
        <StatCard 
            title="Concluídos (Mês)" 
            value={stats.osFinalizada} 
            icon={CheckCircle} 
            color="bg-success-500" 
            onClick={() => navigate('/ordem-de-servico')}
        />
        <StatCard 
            title="Pagamentos Pendentes" 
            value={stats.pagamentosPendentes} 
            icon={DollarSign} 
            color="bg-error-500" 
            onClick={() => navigate('/fechamento-financeiro')}
        />
      </div>

      {/* Recent Activity & Quick Actions */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-neutral-100 min-h-[400px]">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-lg font-bold text-neutral-900">Serviços Recentes</h2>
            <button 
              onClick={() => navigate('/ordem-de-servico')}
              className="text-sm font-bold text-primary-600 hover:underline"
            >
              Ver Todas
            </button>
          </div>
          
          <div className="overflow-x-auto">
            <table className="w-full text-left">
              <thead className="bg-neutral-50 border-b border-neutral-100">
                <tr>
                  <th className="p-4 text-[10px] font-black uppercase text-neutral-500 tracking-widest">OS / Data</th>
                  <th className="p-4 text-[10px] font-black uppercase text-neutral-500 tracking-widest">Veículo</th>
                  <th className="p-4 text-[10px] font-black uppercase text-neutral-500 tracking-widest">Cliente</th>
                  <th className="p-4 text-[10px] font-black uppercase text-neutral-500 tracking-widest text-center">Status</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-neutral-50">
                {recentOss
                  .filter(os => os.status === 'ABERTA' || os.status === 'PRONTO PARA FINANCEIRO')
                  .length === 0 ? (
                  <tr>
                    <td colSpan={4} className="p-10 text-center text-neutral-400 italic">Nenhuma OS em andamento encontrada.</td>
                  </tr>
                ) : (
                  recentOss
                    .filter(os => os.status === 'ABERTA' || os.status === 'PRONTO PARA FINANCEIRO')
                    .slice(0, 5)
                    .map((os: any) => (
                    <tr 
                      key={os.id_os} 
                      onClick={() => navigate(`/ordem-de-servico?id=${os.id_os}`)}
                      className="hover:bg-neutral-50 cursor-pointer transition-colors group"
                    >
                      <td className="p-4">
                        <p className="font-bold text-neutral-900">#OS-{String(os.id_os).padStart(4, '0')}</p>
                        <p className="text-[10px] text-neutral-400 font-medium">{new Date(os.dt_abertura).toLocaleDateString()}</p>
                      </td>
                      <td className="p-4">
                        <p className="font-black text-neutral-700 tracking-tight text-sm uppercase">{os.veiculo?.placa}</p>
                        <p className="text-[10px] text-neutral-400 font-bold uppercase">{os.veiculo?.modelo}</p>
                      </td>
                      <td className="p-4">
                        <p className="text-sm font-bold text-neutral-600 truncate max-w-[150px]">
                          {os.cliente?.pessoa_fisica?.pessoa?.nome || os.cliente?.pessoa_juridica?.razao_social}
                        </p>
                        <p className="text-[10px] text-neutral-400 font-medium">{os.cliente?.telefone_1}</p>
                      </td>
                      <td className="p-4 text-center">
                        <span className={`px-2 py-0.5 rounded-full text-[9px] font-black uppercase ring-1 ${getStatusStyle(os.status)}`}>
                          {os.status}
                        </span>
                      </td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
        </div>

        <div className="bg-white p-6 rounded-xl shadow-sm border border-neutral-100">
          <h2 className="text-lg font-bold text-neutral-900 mb-6">Atalhos Rápidos</h2>
          <div className="grid grid-cols-1 gap-3">
            <button 
                onClick={() => navigate('/ordem-de-servico')}
                className="w-full text-left p-4 bg-neutral-50 hover:bg-primary-50 hover:border-primary-200 border border-transparent rounded-xl transition-all group"
            >
              <div className="flex items-center gap-4">
                <div className="p-2 bg-white rounded-lg shadow-sm group-hover:bg-primary-500 group-hover:text-white transition-all text-primary-600">
                  <Wrench size={20} />
                </div>
                <div>
                  <p className="text-sm font-bold text-neutral-800">Nova OS</p>
                  <p className="text-[10px] text-neutral-500">Abrir novo atendimento</p>
                </div>
              </div>
            </button>
            
            <button 
                onClick={() => navigate('/cliente')}
                className="w-full text-left p-4 bg-neutral-50 hover:bg-primary-50 hover:border-primary-200 border border-transparent rounded-xl transition-all group"
            >
              <div className="flex items-center gap-4">
                <div className="p-2 bg-white rounded-lg shadow-sm group-hover:bg-primary-500 group-hover:text-white transition-all text-primary-600">
                  <Users size={20} />
                </div>
                <div>
                  <p className="text-sm font-bold text-neutral-800">Novo Cliente</p>
                  <p className="text-[10px] text-neutral-500">Cadastrar no sistema</p>
                </div>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}


================================================================================
FILE PATH: client\src\pages\ItensOsPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { IItensOs } from '../types/backend';
import { ItensOsForm } from '../components/forms/ItensOsForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, Package } from 'lucide-react';

export const ItensOsPage = () => {
    const [itens, setItens] = useState<IItensOs[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IItensOs | null>(null);
    const [selectedOsId, setSelectedOsId] = useState<number | null>(null);

    useEffect(() => {
        loadItens();
    }, []);

    const loadItens = async () => {
        try {
            const response = await api.get('/itens-os');
            setItens(response.data);
        } catch (error) {
            alert('Erro ao carregar itens');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/itens-os/${searchId}`);
            setEditData(response.data);
        } catch (error) {
            alert('Item não encontrado');
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/itens-os/${editData.id_iten}`, editData);
            alert('Item atualizado!');
            loadItens();
        } catch (error) {
            alert('Erro ao atualizar item');
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/itens-os/${searchId}`);
            alert('Item deletado!');
            loadItens();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar item');
        }
    };

    const openCreateModal = () => {
        const osId = prompt('Digite o ID da OS para adicionar item:');
        if (osId) {
            setSelectedOsId(Number(osId));
            setShowModal(true);
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-slate-800">Itens de Ordem de Serviço</h1>
                    <p className="text-slate-500">Peças e serviços aplicados nas OS.</p>
                </div>
                <button 
                    onClick={openCreateModal}
                    className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Novo Item
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">OS</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Descrição</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Qtd</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Valor Unit.</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Total</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {itens.map((item) => (
                            <tr key={item.id_iten} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{item.id_iten}</td>
                                <td className="p-4 text-slate-600">OS #{item.id_os}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-green-50 p-2 rounded-lg text-green-600">
                                            <Package size={18} />
                                        </div>
                                        <div>
                                            <div className="font-medium text-slate-900">{item.descricao}</div>
                                            {item.id_pecas_estoque && <div className="text-xs text-slate-500">Peça ID: {item.id_pecas_estoque}</div>}
                                        </div>
                                    </div>
                                </td>
                                <td className="p-4 text-slate-700 font-bold">{item.quantidade}</td>
                                <td className="p-4 text-slate-700">R$ {Number(item.valor_venda).toFixed(2)}</td>
                                <td className="p-4 text-green-700 font-bold">R$ {Number(item.valor_total).toFixed(2)}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção de Item (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID do Item..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando: {editData.descricao}</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="col-span-2">
                                <label className="text-xs font-bold block mb-1">Descrição</label>
                                <input 
                                    value={editData.descricao} 
                                    onChange={(e) => setEditData({...editData, descricao: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold block mb-1">Quantidade</label>
                                <input 
                                    type="number"
                                    value={editData.quantidade} 
                                    onChange={(e) => setEditData({...editData, quantidade: Number(e.target.value)})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                        </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && selectedOsId && (
                <Modal title="Novo Item na OS" onClose={() => setShowModal(false)}>
                    <ItensOsForm 
                        osId={selectedOsId}
                        onSuccess={() => {
                            setShowModal(false);
                            loadItens();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\NotFoundPage.tsx
================================================================================
import { Link } from 'react-router-dom';
import { Home } from 'lucide-react';

export function NotFoundPage() {
  return (
    <div className="min-h-[80vh] flex flex-col items-center justify-center text-center p-4">
      <h1 className="text-9xl font-black text-slate-200">404</h1>
      <h2 className="text-2xl font-bold text-slate-800 mt-4">Página não encontrada</h2>
      <p className="text-slate-500 mt-2 max-w-md">
        Ops! A rota que você tentou acessar não existe ou foi movida.
      </p>
      <Link 
        to="/" 
        className="mt-8 flex items-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium"
      >
        <Home size={20} />
        Voltar para o Início
      </Link>
    </div>
  );
}


================================================================================
FILE PATH: client\src\pages\OrdemDeServicoPage.tsx
================================================================================
import { useState, useEffect, useCallback, useRef } from 'react';
import { useLocation } from 'react-router-dom';
import type { FormEvent } from 'react';
import { api } from '../services/api';
import type { IOrdemDeServico } from '../types/backend';
import { 
    Search, Plus, PenTool, Car, User, Check, 
    FileText, TrendingUp, AlertCircle, Package, ArrowRight, Wrench, CheckCircle, BadgeCheck, Trash2
} from 'lucide-react';

import { StatusBanner } from '../components/ui/StatusBanner';
import { ClienteForm } from '../components/forms/ClienteForm';
import { VeiculoForm } from '../components/forms/VeiculoForm';
import { Modal } from '../components/ui/Modal';

export const OrdemDeServicoPage = () => {
    const [oss, setOss] = useState<IOrdemDeServico[]>([]);
    const [formData, setFormData] = useState({
        id_cliente: '',
        id_veiculo: '',
        id_funcionario: '1',
        km_entrada: '',
        status: 'ABERTA',
        parcelas: '1',
        defeito_relatado: '',
        diagnostico: '',
        valor_total_cliente: '',
        valor_mao_de_obra: '',
        dt_abertura: new Date().toISOString().slice(0, 16),
        dt_entrega: '',
    });

    const [creationStep, setCreationStep] = useState(1); // 1: Seleção, 2: Dados OS, 3: Itens
    const [currentCreatedOsId, setCurrentCreatedOsId] = useState<number | null>(null);

    const [placaSearch, setPlacaSearch] = useState('');
    const [clienteSearch, setClienteSearch] = useState('');
    const [foundVeiculo, setFoundVeiculo] = useState<any | null>(null);
    const [foundCliente, setFoundCliente] = useState<any | null>(null);
    
    // Dynamic Search Lists
    const [vehicleResults, setVehicleResults] = useState<any[]>([]);
    const [clienteResults, setClienteResults] = useState<any[]>([]);

    const [showRegisterModal, setShowRegisterModal] = useState<'NONE' | 'PESSOA' | 'VEICULO'>('NONE');
    const [createdClientId, setCreatedClientId] = useState<number | null>(null);

    const [manageModalOpen, setManageModalOpen] = useState(false);
    const [selectedOsForItems, setSelectedOsForItems] = useState<IOrdemDeServico | null>(null);
    const [osItems, setOsItems] = useState<any[]>([]);
    const [availableParts, setAvailableParts] = useState<any[]>([]);
    
    // Pieces Search State
    const [partSearch, setPartSearch] = useState('');
    const [partResults, setPartResults] = useState<any[]>([]);
    
    const [newItem, setNewItem] = useState({ id_pecas_estoque: '', quantidade: '1', valor_venda: '', descricao: '' });
    const [loading, setLoading] = useState(false);
    const [employees, setEmployees] = useState<any[]>([]);
    const [statusMsg, setStatusMsg] = useState<{ type: 'success' | 'error' | null, text: string }>({ type: null, text: '' });
    const [activeIndex, setActiveIndex] = useState<number>(-1);

    const placaInputRef = useRef<HTMLInputElement>(null);
    const clienteInputRef = useRef<HTMLInputElement>(null);
    const partInputRef = useRef<HTMLInputElement>(null);

    const [vehicleActiveIndex, setVehicleActiveIndex] = useState(-1);
    const [clienteActiveIndex, setClienteActiveIndex] = useState(-1);
    const [partActiveIndex, setPartActiveIndex] = useState(-1);
    const [editingItemId, setEditingItemId] = useState<number | null>(null);

    const handleKeyDown = (e: React.KeyboardEvent, type: 'vehicle' | 'cliente' | 'part') => {
        if (e.key === 'Escape') {
            setVehicleResults([]);
            setClienteResults([]);
            setPartResults([]);
            setVehicleActiveIndex(-1);
            setClienteActiveIndex(-1);
            setPartActiveIndex(-1);
            return;
        }

        let currentResults: any[] = [];
        let currentActive = -1;
        let currentSetter: (i: number) => void = () => {};
        let currentSelect: (item: any) => void = () => {};

        if (type === 'vehicle') {
            currentResults = vehicleResults;
            currentActive = vehicleActiveIndex;
            currentSetter = setVehicleActiveIndex;
            currentSelect = selectVehicle;
        } else if (type === 'cliente') {
            currentResults = clienteResults;
            currentActive = clienteActiveIndex;
            currentSetter = setClienteActiveIndex;
            currentSelect = selectCliente;
        } else if (type === 'part') {
            currentResults = partResults;
            currentActive = partActiveIndex;
            currentSetter = setPartActiveIndex;
            currentSelect = selectPart;
        }

        if (currentResults.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            const next = currentActive + 1 >= currentResults.length ? 0 : currentActive + 1;
            currentSetter(next);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            const prev = currentActive - 1 < 0 ? currentResults.length - 1 : currentActive - 1;
            currentSetter(prev);
        } else if (e.key === 'Enter' && currentActive !== -1) {
            e.preventDefault();
            currentSelect(currentResults[currentActive]);
            currentSetter(-1);
        }
    };

    // Global keyboard listener for Page navigation
    useEffect(() => {
        const handleGlobalKeyDown = (e: KeyboardEvent) => {
            if (manageModalOpen) {
                if (e.key === 'Escape') setManageModalOpen(false);
                return;
            }

            if (creationStep === 1) {
                const list = oss.filter(os => os.status === 'ABERTA' || os.status === 'PRONTO PARA FINANCEIRO')
                                .sort((a, b) => b.id_os - a.id_os);
                
                if (e.key === 'ArrowDown') {
                    setActiveIndex(prev => (prev + 1 >= list.length ? 0 : prev + 1));
                } else if (e.key === 'ArrowUp') {
                    setActiveIndex(prev => (prev - 1 < 0 ? list.length - 1 : prev - 1));
                } else if (e.key === 'Enter' && activeIndex !== -1) {
                    handleManageItems(list[activeIndex]);
                }
            }

            if (e.key === 'Escape') {
                if (creationStep > 1) {
                    setCreationStep(1);
                } else {
                    setShowRegisterModal('NONE');
                    setPlacaSearch('');
                    setClienteSearch('');
                    setVehicleResults([]);
                    setClienteResults([]);
                    setActiveIndex(-1);
                }
            }
        };

        window.addEventListener('keydown', handleGlobalKeyDown);
        return () => window.removeEventListener('keydown', handleGlobalKeyDown);
    }, [manageModalOpen, creationStep, activeIndex, oss]);

    const loadOss = useCallback(async () => {
        try {
            const response = await api.get('/ordem-de-servico');
            setOss(response.data);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao carregar Ordens de Serviço.' });
        }
    }, []);

    const loadParts = async () => {
        try {
            const response = await api.get('/pecas-estoque');
            setAvailableParts(response.data);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao carregar peças disponíveis.' });
        }
    };

    const loadEmployees = async () => {
        try {
            const response = await api.get('/funcionario');
            setEmployees(response.data);
            if (response.data.length > 0 && !formData.id_funcionario) {
                setFormData(prev => ({ ...prev, id_funcionario: String(response.data[0].id_funcionario) }));
            }
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao carregar funcionários.' });
        }
    };

    const location = useLocation();

    useEffect(() => {
        loadOss();
        loadParts();
        loadEmployees();

        // Verificar se há uma OS para abrir via URL (?id=...)
        const params = new URLSearchParams(location.search);
        const osId = params.get('id');
        if (osId) {
            handleOpenFromId(Number(osId));
        }
    }, [loadOss, location.search]);

    const handleOpenFromId = async (id: number) => {
        try {
            const response = await api.get(`/ordem-de-servico/${id}`);
            const os = response.data;
            setSelectedOsForItems(os);
            setManageModalOpen(true);
            loadOsItems(id);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao abrir OS selecionada.' });
        }
    };

    const handleManageItems = async (os: IOrdemDeServico) => {
        setSelectedOsForItems(os);
        setManageModalOpen(true);
        loadOsItems(os.id_os);
    };

    const loadOsItems = async (idOs: number) => {
        try {
            const response = await api.get(`/itens-os/os/${idOs}`);
            setOsItems(response.data);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao carregar itens da OS.' });
        }
    };

    const handleAddItem = async (e: FormEvent) => {
        e.preventDefault();
        if (!selectedOsForItems) return;

        try {
            const part = availableParts.find(p => p.id_pecas_estoque === Number(newItem.id_pecas_estoque));
            const description = part ? part.nome : (partSearch || 'Item Diverso');
            
            const qtd = Number(newItem.quantidade);
            const val = Number(newItem.valor_venda);

            if (editingItemId) {
                await api.put(`/itens-os/${editingItemId}`, {
                    descricao: description,
                    quantidade: qtd,
                    valor_venda: val,
                    valor_total: qtd * val
                });
                setStatusMsg({ type: 'success', text: 'Item atualizado!' });
            } else {
                await api.post('/itens-os', {
                    id_os: selectedOsForItems.id_os,
                    id_pecas_estoque: newItem.id_pecas_estoque ? Number(newItem.id_pecas_estoque) : null,
                    descricao: description,
                    quantidade: qtd,
                    valor_venda: val,
                    valor_total: qtd * val
                });
                setStatusMsg({ type: 'success', text: 'Item adicionado!' });
            }
            
            setNewItem({ id_pecas_estoque: '', quantidade: '1', valor_venda: '', descricao: '' });
            setPartSearch('');
            setEditingItemId(null);
            loadOsItems(selectedOsForItems.id_os);
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
        } catch (error: any) {
            setStatusMsg({ type: 'error', text: 'Erro ao processar item: ' + (error.response?.data?.error || error.message) });
        }
    };

    const handleDeleteItem = async (id: number, osId: number) => {
        if (!confirm('Excluir este item?')) return;
        try {
            await api.delete(`/itens-os/${id}`);
            loadOsItems(osId);
            setStatusMsg({ type: 'success', text: 'Item removido!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
        } catch (error: any) {
            setStatusMsg({ type: 'error', text: 'Erro ao remover item' });
        }
    };

    const handleEditItem = (item: any) => {
        setEditingItemId(item.id_iten);
        setNewItem({
            id_pecas_estoque: item.id_pecas_estoque ? String(item.id_pecas_estoque) : '',
            quantidade: String(item.quantidade),
            valor_venda: String(item.valor_venda),
            descricao: item.descricao
        });
        setPartSearch(item.descricao);
        // Focus on quantity to allow quick change
        setTimeout(() => {
            const qtdInput = document.querySelector('input[type="number"][placeholder="Qtde"]') as HTMLInputElement;
            if (qtdInput) qtdInput.focus();
        }, 100);
    };

    const handleFinishService = async () => {
        if (!selectedOsForItems) return;
        setLoading(true);
        const km = Number(selectedOsForItems.km_entrada);
        const totalItems = osItems.reduce((acc, item) => acc + Number(item.valor_total), 0);
        const totalLabor = Number(selectedOsForItems.valor_mao_de_obra || 0);
        const finalTotal = totalItems + totalLabor;

        if (isNaN(km)) {
            setStatusMsg({ type: 'error', text: 'KM de Entrada inválido.' });
            setLoading(false);
            return;
        }
        if (isNaN(totalLabor) || totalLabor < 0) {
            setStatusMsg({ type: 'error', text: 'Valor de Mão de Obra inválido.' });
            setLoading(false);
            return;
        }

        try {
            await api.put(`/ordem-de-servico/${selectedOsForItems.id_os}`, {
                km_entrada: Math.round(km),
                valor_pecas: totalItems,
                valor_mao_de_obra: totalLabor,
                valor_total_cliente: finalTotal,
                status: 'PRONTO PARA FINANCEIRO',
                dt_entrega: selectedOsForItems.dt_entrega ? new Date(selectedOsForItems.dt_entrega).toISOString() : new Date().toISOString(),
                obs_final: (selectedOsForItems as any).obs_final || ''
            });
            
            setStatusMsg({ type: 'success', text: 'Serviço Finalizado! Enviado para o Financeiro.' });
            setTimeout(() => {
                setManageModalOpen(false);
                setStatusMsg({ type: null, text: '' });
                loadOss();
            }, 2000);
        } catch (error: any) {
            const errorMsg = error.response?.data?.details || error.response?.data?.error || error.message;
            const finalMsg = error.response?.status === 400 
                ? 'Falha na validação dos dados ou banco desatualizado (campos obrigatórios ausentes?): ' + errorMsg
                : 'Erro ao finalizar serviço: ' + errorMsg;
            
            setStatusMsg({ type: 'error', text: finalMsg });
        } finally {
            setLoading(false);
        }
    };

    const handleUpdateOsInfo = async () => {
        if (!selectedOsForItems) return;
        setLoading(true);
        const km = Number(selectedOsForItems.km_entrada);
        const totalLabor = Number(selectedOsForItems.valor_mao_de_obra || 0);
        const totalItems = osItems.reduce((acc, item) => acc + Number(item.valor_total), 0);
        const finalTotal = totalItems + totalLabor;

        if (isNaN(km)) {
            setStatusMsg({ type: 'error', text: 'KM de Entrada inválido.' });
            setLoading(false);
            return;
        }
        if (isNaN(totalLabor) || totalLabor < 0) {
            setStatusMsg({ type: 'error', text: 'Valor de Mão de Obra inválido.' });
            setLoading(false);
            return;
        }

        try {
            await api.put(`/ordem-de-servico/${selectedOsForItems.id_os}`, {
                km_entrada: Math.round(km),
                valor_mao_de_obra: totalLabor,
                id_funcionario: Number(selectedOsForItems.id_funcionario),
                valor_pecas: totalItems,
                valor_total_cliente: finalTotal,
                defeito_relatado: selectedOsForItems.defeito_relatado,
                diagnostico: selectedOsForItems.diagnostico,
                obs_final: (selectedOsForItems as any).obs_final || ''
            });
            setStatusMsg({ type: 'success', text: 'Informações da OS atualizadas!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
            loadOss();
        } catch (error: any) {
            setStatusMsg({ type: 'error', text: 'Erro ao atualizar OS: ' + (error.response?.data?.error || error.message) });
        } finally {
            setLoading(false);
        }
    };

    const handleDeleteOs = async (id: number) => {
        if (!confirm('Tem certeza que deseja cancelar/excluir esta Ordem de Serviço?')) return;
        try {
            setLoading(true);
            await api.delete(`/ordem-de-servico/${id}`);
            setStatusMsg({ type: 'success', text: 'OS removida com sucesso!' });
            loadOss();
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
        } catch (error: any) {
            setStatusMsg({ type: 'error', text: 'Erro ao excluir OS: ' + (error.response?.data?.error || error.message) });
        } finally {
            setLoading(false);
        }
    };

    const handleSaveFinishCreation = async () => {
        if (!currentCreatedOsId) return;
        
        const totalItems = osItems.reduce((acc, item) => acc + Number(item.valor_total), 0);
        const totalLabor = Number(formData.valor_mao_de_obra || 0);
        const finalTotal = totalItems + totalLabor;

        if (isNaN(totalLabor) || totalLabor < 0) {
            setStatusMsg({ type: 'error', text: 'Valor de Mão de Obra inválido.' });
            return;
        }

        try {
            await api.put(`/ordem-de-servico/${currentCreatedOsId}`, {
                valor_pecas: totalItems,
                valor_mao_de_obra: totalLabor,
                valor_total_cliente: finalTotal
            });
            setStatusMsg({ type: 'success', text: 'Ordem de Serviço salva com sucesso!' });
            setTimeout(() => {
                resetForm();
                loadOss();
            }, 2000);
        } catch (error: any) {
            setStatusMsg({ type: 'error', text: 'Erro ao salvar OS: ' + (error.response?.data?.error || error.message) });
        }
    };

    const handleVehicleSearch = async (val: string) => {
        setPlacaSearch(val.toUpperCase());
        setVehicleActiveIndex(-1);
        if (val.length < 1) {
            setVehicleResults([]);
            return;
        }

        try {
            const response = await api.get(`/veiculo/search?q=${val}`);
            setVehicleResults(response.data);
        } catch (error) {
            console.error(error);
            setStatusMsg({ type: 'error', text: 'Erro ao buscar veículos.' });
        }
    };

    const handleClienteSearch = async (val: string) => {
        setClienteSearch(val);
        setClienteActiveIndex(-1);
        if (val.length < 2) {
            setClienteResults([]);
            return;
        }

        try {
            const response = await api.get(`/cliente/search?name=${val}`);
            setClienteResults(response.data);
        } catch (error) {
            console.error(error);
            setStatusMsg({ type: 'error', text: 'Erro ao buscar clientes.' });
        }
    };

    const handlePartSearch = async (val: string) => {
        setPartSearch(val);
        setPartActiveIndex(-1);
        if (val.length < 2) {
            setPartResults([]);
            return;
        }
        try {
            // Busca no estoque E no histórico de descrições digitadas
            const [stockRes, historyRes] = await Promise.all([
                api.get(`/pecas-estoque/search?q=${val}`),
                api.get(`/itens-os/search/desc?q=${val}`)
            ]);

            // Formatar histórico para o mesmo padrão de resultados
            const historyFormatted = historyRes.data.map((h: any) => ({
                id_pecas_estoque: null, // Não é item de estoque
                nome: h.descricao,
                valor_venda: h.valor_venda,
                fabricante: 'Histórico',
                isHistory: true
            }));

            // Priorizar itens de estoque, depois histórico
            const combined = [...stockRes.data, ...historyFormatted];
            
            // Remover duplicatas de nome
            const unique = combined.filter((v, i, a) => a.findIndex(t => t.nome === v.nome) === i);
            
            setPartResults(unique);
        } catch (error) {
            console.error(error);
            setStatusMsg({ type: 'error', text: 'Erro ao buscar peças/serviços.' });
        }
    };

    const selectPart = (p: any) => {
        setNewItem({
            ...newItem,
            id_pecas_estoque: String(p.id_pecas_estoque),
            valor_venda: String(p.valor_venda),
            descricao: p.nome
        });
        setPartSearch(p.nome);
        setPartResults([]);
    };

    const selectVehicle = (v: any) => {
        setFoundVeiculo(v);
        setFoundCliente(v.cliente);
        setPlacaSearch(v.placa);
        setVehicleResults([]);
        setFormData(prev => ({
            ...prev,
            id_cliente: String(v.cliente.id_cliente),
            id_veiculo: String(v.id_veiculo),
        }));
    };

    const selectCliente = (c: any) => {
        setFoundCliente(c);
        setFoundVeiculo(null);
        setClienteSearch('');
        setClienteResults([]);
        setPlacaSearch('');
        setFormData(prev => ({ ...prev, id_cliente: String(c.id_cliente), id_veiculo: '' }));
    };


    const handleCreateOSRecord = async () => {
        setLoading(true);
        const kmEntrada = Number(formData.km_entrada);
        const idCliente = Number(formData.id_cliente);
        const idVeiculo = Number(formData.id_veiculo);
        const idFuncionario = Number(formData.id_funcionario);
        const parcelas = Number(formData.parcelas);
        const valorTotalCliente = formData.valor_total_cliente ? Number(formData.valor_total_cliente) : null;
        const valorMaoDeObra = formData.valor_mao_de_obra ? Number(formData.valor_mao_de_obra) : null;

        if (isNaN(kmEntrada) || kmEntrada < 0) {
            setStatusMsg({ type: 'error', text: 'KM de Entrada inválido.' });
            setLoading(false);
            return;
        }
        if (isNaN(idCliente) || idCliente <= 0) {
            setStatusMsg({ type: 'error', text: 'Cliente inválido.' });
            setLoading(false);
            return;
        }
        if (isNaN(idVeiculo) || idVeiculo <= 0) {
            setStatusMsg({ type: 'error', text: 'Veículo inválido.' });
            setLoading(false);
            return;
        }
        if (isNaN(idFuncionario) || idFuncionario <= 0) {
            setStatusMsg({ type: 'error', text: 'Funcionário inválido.' });
            setLoading(false);
            return;
        }
        if (isNaN(parcelas) || parcelas <= 0) {
            setStatusMsg({ type: 'error', text: 'Número de parcelas inválido.' });
            setLoading(false);
            return;
        }
        if (valorTotalCliente !== null && (isNaN(valorTotalCliente) || valorTotalCliente < 0)) {
            setStatusMsg({ type: 'error', text: 'Valor total do cliente inválido.' });
            setLoading(false);
            return;
        }
        if (valorMaoDeObra !== null && (isNaN(valorMaoDeObra) || valorMaoDeObra < 0)) {
            setStatusMsg({ type: 'error', text: 'Valor de mão de obra inválido.' });
            setLoading(false);
            return;
        }

        try {
            const payload = {
                ...formData,
                id_cliente: idCliente,
                id_veiculo: idVeiculo,
                id_funcionario: idFuncionario,
                km_entrada: Math.round(kmEntrada),
                parcelas: parcelas,
                dt_abertura: new Date(formData.dt_abertura).toISOString(),
                dt_entrega: formData.dt_entrega ? new Date(formData.dt_entrega).toISOString() : null,
                valor_total_cliente: valorTotalCliente,
                valor_mao_de_obra: valorMaoDeObra,
            };
            const response = await api.post('/ordem-de-servico', payload);
            setCurrentCreatedOsId(response.data.id_os);
            setSelectedOsForItems(response.data);
            setOsItems([]); // Clear items for the new OS
            setCreationStep(3);
            loadOss();
            setStatusMsg({ type: 'success', text: 'Registro de OS criado! Adicione os itens agora.' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
        } catch (error: any) {
            setStatusMsg({ type: 'error', text: 'Erro ao criar OS: ' + (error.response?.data?.error || error.message) });
        } finally {
            setLoading(false);
        }
    };

    const handleAddItemToCurrent = async (e: FormEvent) => {
        e.preventDefault();
        if (!currentCreatedOsId) return;

        try {
            const part = availableParts.find(p => p.id_pecas_estoque === Number(newItem.id_pecas_estoque));
            const description = part ? part.nome : (partSearch || 'Item Diverso');
            const qtd = Number(newItem.quantidade);
            const val = Number(newItem.valor_venda);

            if (isNaN(qtd) || qtd <= 0) {
                setStatusMsg({ type: 'error', text: 'Quantidade inválida.' });
                return;
            }
            if (isNaN(val) || val < 0) {
                setStatusMsg({ type: 'error', text: 'Valor de venda inválido.' });
                return;
            }

            await api.post('/itens-os', {
                id_os: currentCreatedOsId,
                id_pecas_estoque: newItem.id_pecas_estoque ? Number(newItem.id_pecas_estoque) : null,
                descricao: description,
                quantidade: qtd,
                valor_venda: val,
                valor_total: qtd * val
            });
            
            setNewItem({ id_pecas_estoque: '', quantidade: '1', valor_venda: '', descricao: '' });
            setPartSearch('');
            loadOsItems(currentCreatedOsId);
        } catch (error: any) {
            setStatusMsg({ type: 'error', text: 'Erro ao adicionar item: ' + (error.response?.data?.error || error.message) });
        }
    };

    const resetForm = () => {
        setFormData({
            id_cliente: '', id_veiculo: '', id_funcionario: '1', km_entrada: '', status: 'ABERTA',
            parcelas: '1', defeito_relatado: '', diagnostico: '', valor_total_cliente: '', valor_mao_de_obra: '',
            dt_abertura: new Date().toISOString().slice(0, 16), dt_entrega: '',
        });
        setPlacaSearch('');
        setFoundCliente(null);
        setFoundVeiculo(null);
        setCreationStep(1);
        setCurrentCreatedOsId(null);
        setOsItems([]);
        setStatusMsg({ type: null, text: '' });
    };

    const getStatusStyle = (status: string) => {
        switch (status) {
            case 'FINALIZADA': return 'bg-success-50 text-success-600 border-success-200';
            case 'PAGA_CLIENTE': return 'bg-neutral-100 text-neutral-600 border-neutral-200';
            case 'PRONTO PARA FINANCEIRO': return 'bg-warning-50 text-warning-600 border-warning-200';
            default: return 'bg-primary-50 text-primary-600 border-primary-200';
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h1 className="text-2xl font-bold text-neutral-900 tracking-tight">Ordens de Serviço</h1>
                    <p className="text-neutral-500">Gestão de manutenções e serviços automotivos.</p>
                </div>
            </div>

            {/* PASSO 1: IDENTIFICAÇÃO */}
            <div className={`bg-surface p-6 rounded-2xl shadow-sm border transition-all ${creationStep === 1 ? 'border-primary-500 ring-4 ring-primary-500/10' : 'border-neutral-200'}`}>
                <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-3">
                        <div className={`p-2 rounded-lg ${creationStep >= 1 ? 'bg-primary-100 text-primary-600' : 'bg-neutral-100 text-neutral-400'}`}>
                            {creationStep > 1 ? <Check size={20} /> : <Search size={20} />}
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-neutral-900">Passo 1: Identificação</h2>
                            <p className="text-sm text-neutral-500">Localize o veículo e o proprietário.</p>
                        </div>
                    </div>
                </div>

                {creationStep === 1 ? (
                    <div className="space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">

      
      {/* Header da Página */}
                            <div className="space-y-2 relative">
                                <label className="text-xs font-bold text-neutral-500 uppercase flex items-center gap-2">
                                    <Car size={14} /> Placa do Veículo
                                </label>
                                <div className="relative group">
                                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400 group-focus-within:text-primary-500 transition-colors" size={20} />
                                    <input 
                                        ref={placaInputRef}
                                        autoFocus
                                        value={placaSearch}
                                        onChange={(e) => handleVehicleSearch(e.target.value)}
                                        onKeyDown={(e) => handleKeyDown(e, 'vehicle')}
                                        className="w-full pl-12 pr-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none text-lg font-mono font-bold uppercase tracking-widest text-neutral-900 transition-all"
                                        placeholder="ABC1234"
                                        maxLength={7}
                                    />
                                </div>
                                {placaSearch.length >= 1 && vehicleResults.length === 0 && (
                                    <div className="absolute z-30 w-full mt-2 bg-white border border-neutral-200 rounded-xl shadow-2xl p-4 text-center">
                                        <p className="text-sm text-neutral-500 mb-3">Placa não encontrada.</p>
                                        <button 
                                            onClick={() => setShowRegisterModal('VEICULO')}
                                            className="w-full py-2 bg-primary-100 text-primary-700 rounded-lg font-black text-xs uppercase hover:bg-primary-200 transition-all flex items-center justify-center gap-2"
                                        >
                                            <Plus size={16} /> Cadastrar Novo Veículo
                                        </button>
                                    </div>
                                )}
                                {vehicleResults.length > 0 && (
                                    <div className="absolute z-30 w-full mt-2 bg-white border border-neutral-200 rounded-xl shadow-2xl overflow-hidden max-h-60 overflow-y-auto">
                                        {vehicleResults.map((v, idx) => (
                                            <button 
                                                key={v.id_veiculo} 
                                                onClick={() => selectVehicle(v)} 
                                                className={`w-full p-4 text-left border-b border-neutral-50 hover:bg-primary-50 transition-colors flex items-center justify-between ${idx === vehicleActiveIndex ? 'bg-primary-100' : ''}`}
                                            >
                                                <div>
                                                    <p className="font-black text-neutral-800 tracking-widest">{v.placa}</p>
                                                    <p className="text-[10px] text-neutral-500 font-bold uppercase">{v.marca} {v.modelo}</p>
                                                </div>
                                                <div className="text-right">
                                                    <p className="text-[10px] font-bold text-neutral-400 uppercase">Dono</p>
                                                    <p className="text-sm font-bold text-primary-600 truncate max-w-[150px]">
                                                        {v.cliente?.pessoa_fisica?.pessoa?.nome || v.cliente?.pessoa_juridica?.razao_social}
                                                    </p>
                                                    <p className="text-[10px] text-neutral-400 font-medium">{v.cliente?.telefone_1}</p>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* Busca por Cliente */}
                            <div className="space-y-2 relative">
                                <label className="text-xs font-bold text-neutral-500 uppercase flex items-center gap-2">
                                    <User size={14} /> Proprietário
                                </label>
                                <div className="relative group">
                                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400 group-focus-within:text-primary-500 transition-colors" size={20} />
                                    <input 
                                        ref={clienteInputRef}
                                        value={clienteSearch}
                                        onChange={(e) => handleClienteSearch(e.target.value)}
                                        onKeyDown={(e) => handleKeyDown(e, 'cliente')}
                                        className="w-full pl-12 pr-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none text-neutral-900 transition-all font-bold"
                                        placeholder="Nome do cliente..."
                                    />
                                </div>
                                {clienteSearch.length >= 2 && clienteResults.length === 0 && (
                                    <div className="absolute z-30 w-full mt-2 bg-white border border-neutral-200 rounded-xl shadow-2xl p-4 text-center">
                                        <p className="text-sm text-neutral-500 mb-3">Cliente não encontrado.</p>
                                        <button 
                                            onClick={() => setShowRegisterModal('PESSOA')}
                                            className="w-full py-2 bg-primary-100 text-primary-700 rounded-lg font-black text-xs uppercase hover:bg-primary-200 transition-all flex items-center justify-center gap-2"
                                        >
                                            <Plus size={16} /> Cadastrar Novo Cliente
                                        </button>
                                    </div>
                                )}
                                {clienteResults.length > 0 && (
                                    <div className="absolute z-30 w-full mt-2 bg-white border border-neutral-200 rounded-xl shadow-2xl overflow-hidden max-h-60 overflow-y-auto">
                                        {clienteResults.map((c, idx) => (
                                            <button 
                                                key={c.id_cliente} 
                                                onClick={() => selectCliente(c)} 
                                                className={`w-full p-4 text-left border-b border-neutral-50 hover:bg-primary-50 transition-colors ${idx === clienteActiveIndex ? 'bg-primary-100' : ''}`}
                                            >
                                                <p className="font-bold text-neutral-900">{c.pessoa_fisica?.pessoa.nome || c.pessoa_juridica?.razao_social}</p>
                                                <p className="text-[10px] text-neutral-500">{c.email} • {c.telefone_1}</p>
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Lista de Veículos do Cliente Selecionado */}
                        {foundCliente && !foundVeiculo && (
                            <div className="p-6 bg-primary-50/30 rounded-2xl border border-dashed border-primary-200 animate-in zoom-in-95 duration-300">
                                <div className="flex items-center gap-2 mb-4">
                                    <Car size={18} className="text-primary-600" />
                                    <h3 className="text-sm font-black text-primary-900 uppercase">Selecione um Veículo de {foundCliente.pessoa_fisica?.pessoa.nome || foundCliente.pessoa_juridica?.razao_social}</h3>
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                    {(foundCliente.veiculos || []).map((v: any) => (
                                        <button 
                                            key={v.id_veiculo} 
                                            onClick={() => selectVehicle({ ...v, cliente: foundCliente })}
                                            className="p-4 bg-white border border-primary-100 rounded-xl hover:border-primary-500 hover:shadow-lg transition-all text-left flex items-center justify-between group"
                                        >
                                            <div>
                                                <p className="font-black text-primary-900 tracking-widest">{v.placa}</p>
                                                <p className="text-[10px] text-neutral-500 font-bold uppercase">{v.marca} {v.modelo}</p>
                                            </div>
                                            <ArrowRight size={16} className="text-primary-300 group-hover:text-primary-600 group-hover:translate-x-1 transition-all" />
                                        </button>
                                    ))}
                                    <button 
                                        onClick={() => setShowRegisterModal('VEICULO')}
                                        className="p-4 border border-dashed border-neutral-300 rounded-xl hover:border-primary-500 hover:text-primary-600 transition-all text-left flex items-center gap-3 text-neutral-500 font-bold text-sm"
                                    >
                                        <Plus size={20} /> Novo Veículo
                                    </button>
                                </div>
                            </div>
                        )}

                        {(foundCliente || foundVeiculo) && (
                            <div className="flex flex-col items-center gap-4 animate-in fade-in slide-in-from-top-4 duration-300 border-t border-neutral-100 pt-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
                                    <div className={`p-4 rounded-xl border flex items-center justify-between ${foundCliente ? 'bg-primary-50 border-primary-100 text-primary-700' : 'bg-neutral-50 border-neutral-200 opacity-50 border-dashed'}`}>
                                        <div className="flex items-center gap-3">
                                            <User size={20} />
                                            <div>
                                                <p className="text-[10px] font-black uppercase">Cliente Selecionado</p>
                                                <p className="font-bold">{foundCliente ? (foundCliente.pessoa_fisica?.pessoa.nome || foundCliente.pessoa_juridica?.razao_social) : 'Aguardando seleção...'}</p>
                                            </div>
                                        </div>
                                        {foundCliente && <button onClick={() => setFoundCliente(null)} className="text-neutral-400 hover:text-red-500"><Plus size={18} className="rotate-45" /></button>}
                                    </div>
                                    <div className={`p-4 rounded-xl border flex items-center justify-between ${foundVeiculo ? 'bg-primary-50 border-primary-100 text-primary-700' : 'bg-neutral-50 border-neutral-200 opacity-50 border-dashed'}`}>
                                        <div className="flex items-center gap-3">
                                            <Car size={20} />
                                            <div>
                                                <p className="text-[10px] font-black uppercase">Veículo Selecionado</p>
                                                <p className="font-bold tracking-widest uppercase">{foundVeiculo ? foundVeiculo.placa : 'Aguardando seleção...'}</p>
                                            </div>
                                        </div>
                                        {foundVeiculo && <button onClick={() => setFoundVeiculo(null)} className="text-neutral-400 hover:text-red-500"><Plus size={18} className="rotate-45" /></button>}
                                    </div>
                                </div>
                                {foundVeiculo && (
                                    <div className="w-full flex flex-col items-center gap-6">
                                        <div className="w-full p-6 bg-neutral-900 rounded-3xl text-white shadow-2xl relative overflow-hidden group">
                                            <div className="absolute top-0 right-0 p-8 opacity-5 group-hover:scale-110 transition-transform">
                                                <BadgeCheck size={120} />
                                            </div>
                                            <div className="relative z-10 space-y-4">
                                                <div className="flex items-center gap-3 text-primary-400 font-black uppercase text-xs tracking-widest">
                                                    <Check size={16} /> Conferência de Dados
                                                </div>
                                                <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                                    <div>
                                                        <p className="text-[10px] font-black text-neutral-500 uppercase tracking-widest">Proprietário / Cliente</p>
                                                        <p className="text-xl font-black">{foundCliente ? (foundCliente.pessoa_fisica?.pessoa.nome || foundCliente.pessoa_juridica?.razao_social) : '---'}</p>
                                                        <p className="text-xs text-neutral-400 font-medium">{foundCliente?.telefone_1}</p>
                                                    </div>
                                                    <div>
                                                        <p className="text-[10px] font-black text-neutral-500 uppercase tracking-widest">Veículo / Placa</p>
                                                        <p className="text-xl font-black tracking-widest uppercase">{foundVeiculo.placa}</p>
                                                        <p className="text-xs text-neutral-400 font-bold uppercase">{foundVeiculo.marca} {foundVeiculo.modelo} ({foundVeiculo.cor})</p>
                                                    </div>
                                                    <div className="flex items-center justify-end">
                                                        <button 
                                                            onClick={() => setCreationStep(2)}
                                                            className="bg-primary-600 text-white px-10 py-4 rounded-2xl font-black text-lg hover:bg-primary-700 transition-all shadow-xl shadow-primary-500/20 flex items-center gap-3 active:scale-95"
                                                        >
                                                            CONFIRMAR <ArrowRight size={22} />
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <p className="text-xs text-neutral-400 italic font-medium">Os dados acima estão corretos? Se sim, clique em CONFIRMAR para iniciar o diagnóstico.</p>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                ) : (
                    <div className="flex items-center justify-between bg-neutral-900 p-4 rounded-2xl text-white">
                        <div className="flex gap-12">
                            <div>
                                <p className="text-[10px] font-bold text-neutral-400 uppercase">Proprietário</p>
                                <p className="font-black">{foundCliente?.pessoa_fisica?.pessoa.nome || foundCliente?.pessoa_juridica?.razao_social}</p>
                            </div>
                            <div>
                                <p className="text-[10px] font-bold text-neutral-400 uppercase">Veículo</p>
                                <p className="font-black tracking-widest uppercase">{foundVeiculo?.placa}</p>
                            </div>
                        </div>
                        <button onClick={() => setCreationStep(1)} className="text-xs font-black text-primary-400 hover:text-primary-300">ALTERAR</button>
                    </div>
                )}
            </div>

            {/* PASSO 2: DADOS TÉCNICOS */}
            {creationStep >= 2 && (
                <div className={`bg-surface p-6 rounded-2xl shadow-sm border transition-all ${creationStep === 2 ? 'border-primary-500 ring-4 ring-primary-500/10' : 'border-neutral-200'} animate-in fade-in slide-in-from-top-4 duration-500`}>
                    <div className="flex items-center gap-3 mb-6">
                        <div className={`p-2 rounded-lg ${creationStep >= 2 ? 'bg-success-100 text-success-600' : 'bg-neutral-100 text-neutral-400'}`}>
                            {creationStep > 2 ? <Check size={20} /> : <FileText size={20} />}
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-neutral-900">Passo 2: Diagnóstico e Entrada</h2>
                            <p className="text-sm text-neutral-500">Registre o estado do veículo na chegada.</p>
                        </div>
                    </div>


                    {creationStep === 2 ? (
                        <div className="space-y-6">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-neutral-500 uppercase">KM de Entrada *</label>
                                    <input 
                                        type="number" 
                                        value={formData.km_entrada} 
                                        onChange={e => setFormData({...formData, km_entrada: e.target.value})} 
                                        className="w-full border p-4 rounded-xl outline-none focus:ring-2 focus:ring-primary-100 font-black text-lg" 
                                        placeholder="000.000" 
                                    />
                                </div>
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-neutral-500 uppercase">Data/Hora Entrada</label>
                                    <input 
                                        type="datetime-local" 
                                        value={formData.dt_abertura} 
                                        onChange={e => setFormData({...formData, dt_abertura: e.target.value})} 
                                        className="w-full border p-4 rounded-xl outline-none focus:ring-2 focus:ring-primary-100 font-bold" 
                                    />
                                </div>
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-neutral-500 uppercase">Previsão Entrega</label>
                                    <input 
                                        type="datetime-local" 
                                        value={formData.dt_entrega} 
                                        onChange={e => setFormData({...formData, dt_entrega: e.target.value})} 
                                        className="w-full border p-4 rounded-xl outline-none focus:ring-2 focus:ring-primary-100 font-bold" 
                                    />
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-neutral-500 uppercase flex items-center gap-1">
                                        <User size={14} /> Mecânico / Responsável
                                    </label>
                                    <select 
                                        name="id_funcionario" 
                                        value={formData.id_funcionario} 
                                        onChange={(e) => setFormData({...formData, id_funcionario: e.target.value})} 
                                        className="w-full border p-4 rounded-xl focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 outline-none font-bold text-neutral-700 bg-neutral-50" 
                                    >
                                        <option value="">Selecione um Mecânico</option>
                                        {employees.map(emp => (
                                            <option key={emp.id_funcionario} value={emp.id_funcionario}>
                                                {emp.pessoa_fisica?.pessoa?.nome || `Mecânico #${emp.id_funcionario}`}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                <div className="space-y-1 opacity-50 pointer-events-none">
                                    <label className="text-xs font-bold text-neutral-500 uppercase">Status Inicial</label>
                                    <input value="ABERTA" disabled className="w-full border p-4 rounded-xl bg-neutral-100 font-bold" />
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-neutral-500 uppercase flex items-center gap-1">
                                        <PenTool size={14} /> Defeito Relatado / Queixa
                                    </label>
                                    <textarea 
                                        value={formData.defeito_relatado} 
                                        onChange={e => setFormData({...formData, defeito_relatado: e.target.value})} 
                                        className="w-full border p-4 rounded-xl outline-none h-28 resize-none" 
                                        placeholder="O que o cliente relatou de problema?" 
                                    />
                                </div>
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-neutral-500 uppercase flex items-center gap-1">
                                        <Wrench size={14} /> Diagnóstico / Obs Internas
                                    </label>
                                    <textarea 
                                        value={formData.diagnostico} 
                                        onChange={e => setFormData({...formData, diagnostico: e.target.value})} 
                                        className="w-full border p-4 rounded-xl outline-none h-28 resize-none" 
                                        placeholder="Notas técnicas iniciais..." 
                                    />
                                </div>
                            </div>

                            {employees.length === 0 && (
                                <div className="p-4 bg-red-50 border border-red-100 rounded-xl flex items-center gap-3 text-red-600 mb-4 animate-pulse">
                                    <AlertCircle size={20} />
                                    <p className="text-xs font-bold uppercase">Nenhum mecânico cadastrado! Cadastre um funcionário para prosseguir.</p>
                                </div>
                            )}

                            <div className="flex justify-center pt-4 border-t border-neutral-100">
                                <button 
                                    onClick={handleCreateOSRecord} 
                                    disabled={!formData.km_entrada || !formData.id_funcionario || loading}
                                    className="bg-neutral-900 text-white px-20 py-4 rounded-2xl font-black text-xl hover:bg-black disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-2xl shadow-black/10 flex items-center gap-3 active:scale-95"
                                >
                                    {loading ? 'SALVANDO...' : 'OK'} <ArrowRight size={24} />
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-6 bg-neutral-900 p-6 rounded-2xl text-white">
                            <div>
                                <p className="text-[10px] font-bold text-neutral-400 uppercase">KM Entrada</p>
                                <p className="font-black text-lg">{formData.km_entrada}</p>
                            </div>
                            <div>
                                <p className="text-[10px] font-bold text-neutral-400 uppercase">Abertura</p>
                                <p className="font-bold">{new Date(formData.dt_abertura).toLocaleString()}</p>
                            </div>
                        </div>
                    )}
                </div>
            )}

            {/* PASSO 3: ITENS DA OS (INTEGRADO) */}
            {creationStep === 3 && (
                <div className="bg-surface p-6 rounded-2xl shadow-sm border border-success-500 ring-4 ring-success-500/10 animate-in fade-in slide-in-from-top-4 duration-500">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="bg-success-100 text-success-600 p-2 rounded-lg">
                            <Package size={20} />
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-neutral-900">Passo 3: Peças e Serviços</h2>
                            <p className="text-sm text-neutral-500">Insira os itens da nota fiscal/serviço.</p>
                        </div>
                    </div>


                    <div className="space-y-6">
                        {/* Formulário de Inserção Rápida */}
                        <div className="p-5 bg-neutral-50 border border-dashed border-neutral-300 rounded-2xl">
                            <form onSubmit={handleAddItemToCurrent} className="grid grid-cols-12 gap-4 items-end">
                                <div className="col-span-12 md:col-span-12 relative mb-2">
                                    <label className="text-xs font-bold text-neutral-500 uppercase block mb-1">Buscar Peça ou Digitar Serviço</label>
                                    <div className="relative group">
                                        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400 group-focus-within:text-success-500 transition-colors" size={20} />
                                        <input 
                                            ref={partInputRef}
                                            value={partSearch}
                                            onChange={(e) => handlePartSearch(e.target.value)}
                                            onKeyDown={(e) => handleKeyDown(e, 'part')}
                                            className="w-full pl-12 pr-4 py-4 bg-white border border-neutral-200 rounded-xl outline-none focus:ring-2 focus:ring-success-500/20 font-bold"
                                            placeholder="Ex: Jogo de Pastilhas Dianteiras..."
                                        />
                                    </div>
                                    {partResults.length > 0 && (
                                        <div className="absolute z-50 w-full mt-1 bg-white border border-neutral-200 rounded-2xl shadow-2xl max-h-56 overflow-y-auto">
                                            {partResults.map((p, idx) => (
                                                <button 
                                                    key={p.id_pecas_estoque} 
                                                    type="button" 
                                                    onClick={() => selectPart(p)} 
                                                    className={`w-full text-left p-4 hover:bg-success-50 border-b border-neutral-50 last:border-0 flex justify-between items-center transition-colors ${idx === partActiveIndex ? 'bg-success-100' : ''}`}
                                                >
                                                    <div>
                                                        <p className="font-bold text-neutral-800">{p.nome}</p>
                                                        <p className="text-[10px] text-neutral-500 uppercase">{p.fabricante || 'ESTOQUE'} • Qtd: {p.estoque_atual}</p>
                                                    </div>
                                                    <p className="font-black text-success-600">R$ {Number(p.valor_venda).toFixed(2)}</p>
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div className="col-span-4 md:col-span-3">
                                    <label className="text-xs font-bold text-neutral-500 uppercase block mb-1">Qtd</label>
                                    <input 
                                        type="number" 
                                        value={newItem.quantidade} 
                                        onChange={e => setNewItem({...newItem, quantidade: e.target.value})} 
                                        className="w-full border p-4 rounded-xl text-center font-black text-lg" 
                                    />
                                </div>
                                <div className="col-span-5 md:col-span-5">
                                    <label className="text-xs font-bold text-neutral-500 uppercase block mb-1">Valor Unitário</label>
                                    <div className="relative">
                                        <span className="absolute left-4 top-1/2 -translate-y-1/2 font-bold text-neutral-400">R$</span>
                                        <input 
                                            type="number" step="0.01" 
                                            value={newItem.valor_venda} 
                                            onChange={e => setNewItem({...newItem, valor_venda: e.target.value})} 
                                            className="w-full border pl-12 pr-4 py-4 rounded-xl font-black text-lg" 
                                        />
                                    </div>
                                </div>
                                <button className="col-span-3 md:col-span-4 bg-neutral-900 text-white h-[60px] rounded-xl font-black hover:bg-black transition-all flex items-center justify-center gap-2 active:scale-95 shadow-lg shadow-black/10">
                                    <Plus size={24} strokeWidth={3} /> ADICIONAR
                                </button>
                            </form>
                        </div>

                        {/* Tabela de Itens Pró */}
                        <div className="border border-neutral-100 rounded-2xl overflow-hidden bg-white shadow-sm">
                             <table className="w-full text-sm text-left">
                                <thead className="bg-neutral-50 border-b border-neutral-100">
                                    <tr>
                                        <th className="p-5 font-black text-neutral-500 uppercase text-[10px] tracking-widest">Item / Serviço</th>
                                        <th className="p-5 font-black text-neutral-500 uppercase text-[10px] tracking-widest text-center">Qtde</th>
                                        <th className="p-5 font-black text-neutral-500 uppercase text-[10px] tracking-widest text-right">Preço Unit.</th>
                                        <th className="p-5 font-black text-neutral-500 uppercase text-[10px] tracking-widest text-right">Subtotal</th>
                                        <th className="p-5 font-black text-neutral-500 uppercase text-[10px] tracking-widest text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-neutral-50">
                                    {osItems.length === 0 ? (
                                        <tr><td colSpan={5} className="p-10 text-center text-neutral-400 italic font-medium">Nenhum item adicionado ainda. Adicione as peças acima.</td></tr>
                                    ) : osItems.map(item => (
                                        <tr key={item.id_iten} className="hover:bg-neutral-25 transition-colors">
                                            <td className="p-5 font-bold text-neutral-800 capitalize">{item.descricao}</td>
                                            <td className="p-5 text-center font-black text-neutral-600">x{item.quantidade}</td>
                                            <td className="p-5 text-right font-medium text-neutral-500">R$ {Number(item.valor_venda).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                                            <td className="p-5 text-right font-black text-neutral-900">R$ {Number(item.valor_total).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                                            <td className="p-5 text-center">
                                                <div className="flex items-center justify-center gap-2">
                                                    <button onClick={() => handleEditItem(item)} className="p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors">
                                                        <PenTool size={16} />
                                                    </button>
                                                    <button onClick={() => handleDeleteItem(item.id_iten, currentCreatedOsId!)} className="p-2 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                                                        <Plus size={16} className="rotate-45" />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                             </table>
                        </div>

                        {/* Rodapé de Fechamento */}
                        <div className="flex flex-col md:flex-row justify-between items-center bg-neutral-900 p-8 rounded-3xl text-white gap-6">
                            <div className="flex flex-col md:flex-row gap-8 items-center">
                                <div>
                                    <p className="text-[10px] font-bold text-neutral-400 uppercase tracking-widest mb-1">Mão de Obra</p>
                                    <div className="relative">
                                        <span className="absolute left-0 top-1/2 -translate-y-1/2 text-neutral-400 text-lg font-black">R$</span>
                                        <input 
                                            type="number" 
                                            step="0.01"
                                            value={formData.valor_mao_de_obra}
                                            onChange={(e) => setFormData({...formData, valor_mao_de_obra: e.target.value})}
                                            className="bg-transparent border-b border-neutral-700 pl-8 py-1 text-2xl font-black focus:border-success-500 outline-none w-32 transition-colors"
                                            placeholder="0.00"
                                        />
                                    </div>
                                </div>
                                <div>
                                    <p className="text-[10px] font-bold text-neutral-400 uppercase tracking-widest mb-1">Total Geral</p>
                                    <p className="text-3xl font-black text-success-400">
                                        R$ {(
                                            osItems.reduce((acc, item) => acc + Number(item.valor_total), 0) + 
                                            Number(formData.valor_mao_de_obra || 0)
                                        ).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                                    </p>
                                </div>
                            </div>
                            <div className="flex gap-4 w-full md:w-auto">
                                <button onClick={handleSaveFinishCreation} className="flex-1 bg-success-600 hover:bg-success-700 text-white px-12 py-5 rounded-2xl font-black text-xl shadow-xl shadow-success-500/20 transition-all uppercase tracking-widest active:scale-95">
                                    SALVAR E CONCLUIR
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            {/* SEÇÃO: SERVIÇOS RECENTES / EM ANDAMENTO */}
            <div className="bg-surface rounded-2xl shadow-sm border border-neutral-200 overflow-hidden">
                <div className="p-6 border-b border-neutral-100 flex items-center justify-between">
                    <div>
                        <h2 className="text-xl font-black text-neutral-900">Serviços em Aberto</h2>
                        <p className="text-sm text-neutral-500">Acompanhe e gerencie as ordens de serviço ativas.</p>
                    </div>
                </div>

                <div className="overflow-x-auto">
                    <table className="w-full text-left">
                        <thead className="bg-neutral-50 border-b border-neutral-100">
                            <tr>
                                <th className="p-4 font-black text-neutral-500 uppercase text-[10px] tracking-widest">OS</th>
                                <th className="p-4 font-black text-neutral-500 uppercase text-[10px] tracking-widest">Placa</th>
                                <th className="p-4 font-black text-neutral-500 uppercase text-[10px] tracking-widest">Veículo</th>
                                <th className="p-4 font-black text-neutral-500 uppercase text-[10px] tracking-widest">Cliente</th>
                                <th className="p-4 font-black text-neutral-500 uppercase text-[10px] tracking-widest text-center">Status</th>
                                <th className="p-4 font-black text-neutral-500 uppercase text-[10px] tracking-widest text-right">Ações</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-neutral-50">
                            {oss.filter(os => os.status === 'ABERTA' || os.status === 'PRONTO PARA FINANCEIRO')
                               .sort((a,b) => b.id_os - a.id_os)
                               .map((os, idx) => (
                                <tr 
                                    key={os.id_os} 
                                    className={`hover:bg-neutral-25 transition-colors group cursor-pointer ${idx === activeIndex && !manageModalOpen && creationStep === 1 ? 'bg-primary-50 ring-2 ring-primary-500 ring-inset' : ''}`}
                                >
                                    <td onClick={() => handleManageItems(os)} className="p-4 font-black text-neutral-900 border-l-4 border-transparent group-hover:border-primary-500 transition-all">
                                        <div className="flex flex-col">
                                            <span>#{String(os.id_os).padStart(4, '0')}</span>
                                            <span className="text-[10px] text-neutral-400 font-bold">{new Date(os.dt_abertura).toLocaleDateString()}</span>
                                        </div>
                                    </td>
                                    <td onClick={() => handleManageItems(os)} className="p-4">
                                        <p className="font-black text-neutral-800 tracking-widest uppercase">{os.veiculo?.placa}</p>
                                    </td>
                                    <td onClick={() => handleManageItems(os)} className="p-4">
                                        <div className="flex items-center gap-3">
                                            <div className="p-2 bg-neutral-100 rounded-lg text-neutral-500 group-hover:bg-primary-50 group-hover:text-primary-600 transition-colors">
                                                <Car size={16} />
                                            </div>
                                            <div>
                                                <p className="font-bold text-neutral-800 uppercase text-xs">{os.veiculo?.marca} {os.veiculo?.modelo}</p>
                                                <p className="text-[10px] text-neutral-500 font-bold uppercase">{os.veiculo?.cor}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td onClick={() => handleManageItems(os)} className="p-4">
                                        <div className="flex items-center gap-3">
                                            <div className="p-2 bg-neutral-100 rounded-lg text-neutral-500 group-hover:bg-primary-50 group-hover:text-primary-600 transition-colors">
                                                <User size={16} />
                                            </div>
                                            <div>
                                                <p className="font-bold text-neutral-900 truncate max-w-[150px]">
                                                    {os.cliente?.pessoa_fisica?.pessoa.nome || os.cliente?.pessoa_juridica?.razao_social}
                                                </p>
                                                <p className="text-[10px] text-neutral-500 font-medium">{os.cliente?.telefone_1}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td onClick={() => handleManageItems(os)} className="p-4 text-center">
                                        <span className={`px-3 py-1 rounded-full text-[10px] font-black uppercase ring-1 ${getStatusStyle(os.status)}`}>
                                            {os.status}
                                        </span>
                                    </td>
                                    <td className="p-5 text-right">
                                        <div className="flex items-center justify-end gap-3">
                                            <button 
                                                onClick={() => handleManageItems(os)}
                                                className="flex items-center gap-1 px-3 py-1.5 bg-neutral-50 text-neutral-600 hover:bg-primary-600 hover:text-white rounded-lg transition-all font-black text-[10px] uppercase tracking-tighter shadow-sm border border-neutral-200"
                                            >
                                                <PenTool size={14} /> GERENCIAR
                                            </button>
                                            <button 
                                                onClick={() => handleDeleteOs(os.id_os)}
                                                className="p-1.5 text-neutral-400 hover:text-error hover:bg-error-50 rounded-lg transition-all"
                                                title="Cancelar OS"
                                            >
                                                <Trash2 size={16} />
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>

            {/* MODAL: CADASTRO RÁPIDO */}
            {showRegisterModal === 'PESSOA' && (
                <Modal title="Cadastro Rápido: Novo Cliente" onClose={() => setShowRegisterModal('NONE')}>
                    <ClienteForm 
                        onSuccess={(client) => {
                            setCreatedClientId(client.id_cliente);
                            setShowRegisterModal('VEICULO');
                        }}
                        onCancel={() => setShowRegisterModal('NONE')}
                    />
                </Modal>
            )}

             {showRegisterModal === 'VEICULO' && (createdClientId || createdClientId === 0) && (
                <Modal title="Cadastro Rápido: Novo Veículo" onClose={() => setShowRegisterModal('NONE')}>
                    <VeiculoForm
                        clientId={createdClientId}
                        initialData={{ placa: placaSearch }}
                        onSuccess={(veiculo) => {
                             setFoundVeiculo(veiculo);
                             setFoundCliente(veiculo.cliente);
                             setFormData(prev => ({
                                ...prev,
                                id_cliente: String(veiculo.id_cliente),
                                id_veiculo: String(veiculo.id_veiculo),
                            }));
                            setShowRegisterModal('NONE');
                            setCreationStep(2); // Auto proceed to Step 2
                            setStatusMsg({ type: 'success', text: 'Veículo e Cliente vinculados! Preencha os dados de entrada.' });
                            setTimeout(() => setStatusMsg({ type: null, text: '' }), 4000);
                        }}
                        onCancel={() => setShowRegisterModal('NONE')}
                    />
                </Modal>
            )}

            {/* Status Feedback Info */}
            {/* Status Feedback Info (Footer) */}
            <div className="fixed bottom-8 right-8 z-100 min-w-[320px]">
                <StatusBanner msg={statusMsg} onClose={() => setStatusMsg({type: null, text: ''})} />
            </div>

            {/* MODAL: GERENCIAR ITENS (DESIGN PREMIUM) */}
            {manageModalOpen && selectedOsForItems && (
                 <Modal 
                    title={
                        <div className="flex items-baseline gap-2">
                            <span>OS #{String(selectedOsForItems.id_os).padStart(4, '0')}</span>
                            <span className={`text-[10px] px-2 py-0.5 rounded-full border ${getStatusStyle(selectedOsForItems.status)}`}>
                                {selectedOsForItems.status}
                            </span>
                        </div>
                    } 
                    onClose={() => setManageModalOpen(false)}
                >
                    <div className="space-y-6">
                        {/* Redundant Info Header */}
                        <div className="p-4 bg-neutral-900 rounded-2xl text-white shadow-xl flex flex-wrap items-center justify-between gap-6 border border-neutral-800">
                             <div className="flex items-center gap-4">
                                <div className="p-3 bg-neutral-800 rounded-xl text-primary-400">
                                    <Car size={24} />
                                </div>
                                <div>
                                    <p className="text-[10px] font-black text-neutral-500 uppercase tracking-widest">Veículo / Placa</p>
                                    <p className="text-lg font-black tracking-widest uppercase">{selectedOsForItems.veiculo?.placa}</p>
                                    <p className="text-[10px] font-bold text-neutral-400 uppercase">{selectedOsForItems.veiculo?.marca} {selectedOsForItems.veiculo?.modelo} • {selectedOsForItems.veiculo?.cor}</p>
                                </div>
                             </div>
                             <div className="flex items-center gap-4">
                                <div className="p-3 bg-neutral-800 rounded-xl text-accent-400">
                                    <User size={24} />
                                </div>
                                <div>
                                    <p className="text-[10px] font-black text-neutral-500 uppercase tracking-widest">Cliente / Proprietário</p>
                                    <p className="text-lg font-black">{selectedOsForItems.cliente?.pessoa_fisica?.pessoa.nome || selectedOsForItems.cliente?.pessoa_juridica?.razao_social}</p>
                                    <p className="text-[10px] font-bold text-neutral-400 uppercase">{selectedOsForItems.cliente?.telefone_1} {selectedOsForItems.cliente?.telefone_2 ? ` / ${selectedOsForItems.cliente?.telefone_2}` : ''}</p>
                                </div>
                             </div>
                             <div className="hidden lg:block">
                                  <p className="text-[10px] font-black text-neutral-500 uppercase tracking-widest">Abertura</p>
                                  <p className="text-sm font-bold">{new Date(selectedOsForItems.dt_abertura).toLocaleDateString()} às {new Date(selectedOsForItems.dt_abertura).toLocaleTimeString()}</p>
                             </div>
                        </div>

                        {/* Status & Quick Edit Header */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="space-y-1">
                                <label className="text-[10px] font-black text-neutral-400 uppercase">KM Entrada</label>
                                <input 
                                    type="number" 
                                    value={selectedOsForItems.km_entrada}
                                    onChange={e => setSelectedOsForItems({...selectedOsForItems, km_entrada: Number(e.target.value)})}
                                    className="w-full border-b border-neutral-200 py-1 font-bold outline-none focus:border-primary-500 transition-colors"
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="text-[10px] font-black text-neutral-400 uppercase">Mecânico</label>
                                <select 
                                    value={selectedOsForItems.id_funcionario}
                                    onChange={e => setSelectedOsForItems({...selectedOsForItems, id_funcionario: Number(e.target.value)})}
                                    className="w-full border-b border-neutral-200 py-1 font-bold outline-none focus:border-primary-500 transition-colors bg-transparent"
                                >
                                    {employees.map(emp => (
                                        <option key={emp.id_funcionario} value={emp.id_funcionario}>
                                            {emp.pessoa_fisica?.pessoa?.nome || `Mecânico #${emp.id_funcionario}`}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="flex items-end">
                                <button 
                                    onClick={handleUpdateOsInfo}
                                    disabled={loading}
                                    className="w-full py-2 bg-neutral-100 text-neutral-600 rounded-lg text-[10px] font-black uppercase hover:bg-neutral-200 transition-all border border-neutral-200"
                                >
                                    {loading ? 'SALVANDO...' : 'SALVAR DADOS BÁSICOS'}
                                </button>
                            </div>
                        </div>

                        {/* Summary Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="p-4 bg-neutral-50 rounded-2xl border border-neutral-100 flex items-center gap-3">
                                <div className="p-2 bg-white rounded-lg text-neutral-400">
                                    <Package size={20} />
                                </div>
                                <div>
                                    <p className="text-[10px] font-bold text-neutral-500 uppercase">Peças</p>
                                    <p className="text-lg font-bold text-neutral-900">R$ {osItems.reduce((acc, item) => acc + Number(item.valor_total), 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</p>
                                </div>
                            </div>
                            <div className="p-4 bg-neutral-50 rounded-2xl border border-neutral-100 flex items-center gap-3">
                                <div className="p-2 bg-white rounded-lg text-neutral-400">
                                    <ArrowRight size={20} />
                                </div>
                                <div className="flex-1">
                                    <p className="text-[10px] font-bold text-neutral-500 uppercase">Mão de Obra</p>
                                    <div className="relative">
                                        <span className="absolute left-0 top-1/2 -translate-y-1/2 font-black text-neutral-400">R$</span>
                                        <input 
                                            type="number" step="0.01" 
                                            value={selectedOsForItems.valor_mao_de_obra === 0 ? '' : (selectedOsForItems.valor_mao_de_obra ?? '')}
                                            onChange={e => setSelectedOsForItems({...selectedOsForItems, valor_mao_de_obra: e.target.value === '' ? 0 : Number(e.target.value)})}
                                            className="bg-transparent border-b border-neutral-200 pl-6 py-0 font-black text-lg w-full focus:border-primary-500 outline-none"
                                            placeholder="0.00"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div className="p-4 bg-primary-50 rounded-2xl border border-primary-100 flex items-center gap-3">
                                <div className="p-2 bg-white rounded-lg text-primary-600 shadow-sm">
                                    <TrendingUp size={20} />
                                </div>
                                <div>
                                    <p className="text-[10px] font-bold text-primary-600 uppercase">Total Geral</p>
                                    <p className="text-xl font-black text-primary-900">R$ {(osItems.reduce((acc, item) => acc + Number(item.valor_total), 0) + Number(selectedOsForItems.valor_mao_de_obra || 0)).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</p>
                                </div>
                            </div>
                        </div>

                        {/* Diagnóstico e Defeitos */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="space-y-1">
                                <label className="text-[10px] font-black text-neutral-400 uppercase">Defeito Relatado</label>
                                <textarea 
                                    value={selectedOsForItems.defeito_relatado || ''}
                                    onChange={e => setSelectedOsForItems({...selectedOsForItems, defeito_relatado: e.target.value})}
                                    className="w-full bg-neutral-50 p-3 rounded-xl border border-neutral-100 text-xs font-medium resize-none h-20 outline-none focus:border-primary-300"
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="text-[10px] font-black text-neutral-400 uppercase">Diagnóstico / Ações</label>
                                <textarea 
                                    value={selectedOsForItems.diagnostico || ''}
                                    onChange={e => setSelectedOsForItems({...selectedOsForItems, diagnostico: e.target.value})}
                                    className="w-full bg-neutral-50 p-3 rounded-xl border border-neutral-100 text-xs font-medium resize-none h-20 outline-none focus:border-primary-300"
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="text-[10px] font-black text-success uppercase">Observação Final (Para Financeiro)</label>
                                <textarea 
                                    value={(selectedOsForItems as any).obs_final || ''}
                                    onChange={e => setSelectedOsForItems({...selectedOsForItems, obs_final: e.target.value})}
                                    placeholder="Observações de custos extras, descontos ou detalhes para o faturamento..."
                                    className="w-full bg-success-50 p-3 rounded-xl border border-success-100 text-xs font-medium resize-none h-20 outline-none focus:border-success-300"
                                />
                            </div>
                        </div>

                        {/* Form Adicionar Peça */}
                        {selectedOsForItems.status !== 'FINALIZADA' && (
                            <div className="p-4 border border-dashed border-neutral-300 rounded-2xl bg-neutral-50/50">
                                <p className="text-[10px] font-black text-neutral-500 uppercase mb-4 flex items-center gap-2">
                                    <Plus size={14} className="text-primary-500" /> Adicionar Peça / Serviço
                                </p>
                                <form onSubmit={handleAddItem} className="grid grid-cols-12 gap-3 items-end">
                                    <div className="col-span-12 md:col-span-6 relative">
                                        <div className="relative group">
                                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 group-focus-within:text-primary-500 transition-colors" size={16} />
                                            <input 
                                                className="w-full pl-10 pr-4 py-3 rounded-xl border border-neutral-200 outline-none focus:ring-4 focus:ring-primary-500/10 focus:border-primary-500 text-sm font-bold" 
                                                placeholder="Buscar peça ou digitar serviço..."
                                                value={partSearch}
                                                onChange={(e) => handlePartSearch(e.target.value)}
                                                onKeyDown={(e) => handleKeyDown(e, 'part')}
                                            />
                                        </div>

                                        {/* Result Dropdown */}
                                        {partResults.length > 0 && (
                                            <div className="absolute z-50 w-full mt-1 bg-white border border-neutral-100 rounded-2xl shadow-2xl max-h-56 overflow-y-auto">
                                                {partResults.map((p, idx) => (
                                                    <button 
                                                        key={p.id_pecas_estoque}
                                                        type="button"
                                                        onClick={() => selectPart(p)}
                                                        className={`w-full text-left p-4 border-b border-neutral-50 last:border-0 flex justify-between items-center group transition-colors ${idx === partActiveIndex ? 'bg-primary-50' : 'hover:bg-primary-25'}`}
                                                    >
                                                        <div>
                                                            <p className="font-bold text-neutral-800 text-sm">{p.nome}</p>
                                                            <p className="text-[10px] text-neutral-400 font-bold uppercase">{p.fabricante || 'ESTOQUE'}</p>
                                                        </div>
                                                        <p className="font-black text-primary-600 group-hover:scale-110 transition-transform">R$ {Number(p.valor_venda).toFixed(2)}</p>
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    <div className="col-span-3 md:col-span-2">
                                        <input 
                                            type="number" placeholder="Qtde" className="w-full border p-3 rounded-xl border-neutral-200 outline-none focus:ring-4 focus:ring-primary-100 text-sm font-black text-center" 
                                            value={newItem.quantidade}
                                            onChange={e => setNewItem({...newItem, quantidade: e.target.value})}
                                            required 
                                        />
                                    </div>
                                    <div className="col-span-6 md:col-span-3">
                                        <div className="relative">
                                            <span className="absolute left-3 top-1/2 -translate-y-1/2 font-bold text-neutral-400 text-xs">R$</span>
                                            <input 
                                                type="number" step="0.01" placeholder="Unitário" className="w-full border pl-8 pr-3 py-3 rounded-xl border-neutral-200 outline-none focus:ring-4 focus:ring-primary-100 text-sm font-black" 
                                                value={newItem.valor_venda}
                                                onChange={e => setNewItem({...newItem, valor_venda: e.target.value})}
                                                required 
                                            />
                                        </div>
                                    </div>
                                    <button className="col-span-3 md:col-span-1 bg-neutral-900 text-white h-[48px] rounded-xl font-bold hover:bg-black transition-all flex items-center justify-center shadow-lg shadow-black/10 active:scale-95">
                                        <Plus size={24} strokeWidth={3} />
                                    </button>
                                </form>
                            </div>
                        )}

                        {/* Listagem Itens */}
                        <div className="border border-neutral-100 rounded-2xl overflow-hidden bg-white shadow-sm">
                             <table className="w-full text-xs text-left">
                                <thead className="bg-neutral-50 border-b border-neutral-100">
                                    <tr>
                                        <th className="p-4 font-black text-neutral-400 uppercase text-[9px] tracking-widest">Descrição</th>
                                        <th className="p-4 font-black text-neutral-400 uppercase text-[9px] tracking-widest text-center">Qtde</th>
                                        <th className="p-4 font-black text-neutral-400 uppercase text-[9px] tracking-widest text-right">Subtotal</th>
                                        <th className="p-4 font-black text-neutral-400 uppercase text-[9px] tracking-widest text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-neutral-50">
                                    {osItems.length === 0 ? (
                                        <tr>
                                            <td colSpan={4} className="p-10 text-center text-neutral-300 italic font-medium">Nenhum item adicionado à OS.</td>
                                        </tr>
                                    ) : osItems.map(item => (
                                        <tr key={item.id_iten} className="hover:bg-neutral-25 transition-colors">
                                            <td className="p-4 font-bold text-neutral-800">{item.descricao}</td>
                                            <td className="p-4 text-center font-black text-neutral-500">x{item.quantidade}</td>
                                            <td className="p-4 text-right font-black text-neutral-900 italic">R$ {Number(item.valor_total).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                                            <td className="p-4 text-center">
                                                <div className="flex items-center justify-center gap-2">
                                                    <button onClick={() => handleEditItem(item)} className="p-1.5 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors">
                                                        <PenTool size={14} />
                                                    </button>
                                                    <button onClick={() => handleDeleteItem(item.id_iten, selectedOsForItems.id_os)} className="p-1.5 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                                                        <Plus size={14} className="rotate-45" />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                             </table>
                        </div>

                        {/* Botão Finalizar */}
                        <div className="pt-8 border-t border-neutral-100">
                             {selectedOsForItems.status === 'ABERTA' ? (
                                <div className="bg-success-50/50 p-6 rounded-3xl border border-success-100 space-y-6">
                                    <div className="flex items-center gap-4 text-success-700">
                                        <BadgeCheck size={32} />
                                        <div>
                                            <h3 className="text-xl font-black uppercase tracking-tight">Finalizar Serviço</h3>
                                            <p className="text-xs font-medium opacity-70">Confirme os dados de encerramento para enviar ao financeiro.</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black text-neutral-400 uppercase">Data e Hora de Entrega</label>
                                            <input 
                                                type="datetime-local"
                                                className="w-full bg-white border border-success-200 p-4 rounded-xl font-bold outline-none focus:ring-4 focus:ring-success-500/10 focus:border-success-500"
                                                value={selectedOsForItems.dt_entrega ? selectedOsForItems.dt_entrega.slice(0, 16) : new Date().toISOString().slice(0, 16)}
                                                onChange={e => setSelectedOsForItems({...selectedOsForItems, dt_entrega: e.target.value})}
                                            />
                                        </div>
                                        <div className="flex items-end">
                                            <button 
                                                onClick={handleFinishService}
                                                disabled={loading}
                                                className="w-full bg-success text-white py-4 rounded-xl text-lg font-black hover:opacity-90 shadow-xl shadow-success/20 transition-all flex items-center justify-center gap-4 uppercase tracking-widest active:scale-95 group"
                                            >
                                                <CheckCircle size={28} strokeWidth={2.5} className="group-hover:rotate-12 transition-transform" /> {loading ? 'PROCESSANDO...' : 'FINALIZAR E ENVIAR'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                             ) : (
                                 <div className="flex items-center justify-center gap-3 p-8 bg-neutral-900 rounded-3xl text-white font-black border border-neutral-800 uppercase tracking-[0.2em] text-sm shadow-xl relative overflow-hidden">
                                     <div className="absolute inset-0 bg-success-500/5 pointer-events-none"></div>
                                     <BadgeCheck size={24} className="text-success animate-bounce" /> PRONTO PARA FINANCEIRO
                                 </div>
                             )}
                        </div>
                    </div>
                 </Modal>
            )}
            
            <div className="fixed bottom-8 right-8 z-100 min-w-[320px]">
                <StatusBanner msg={statusMsg} onClose={() => setStatusMsg({type: null, text: ''})} />
            </div>
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\PagamentoPecaPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import { PagamentoPecaForm } from '../components/forms/PagamentoPecaForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, DollarSign, CheckCircle, XCircle } from 'lucide-react';

interface IPagamentoPeca {
    id_pagamento_peca: number;
    id_item_os: number;
    id_fornecedor: number;
    custo_real: number;
    data_compra: string;
    data_pagamento_fornecedor: string | null;
    pago_ao_fornecedor: boolean;
}

export const PagamentoPecaPage = () => {
    const [pagamentos, setPagamentos] = useState<IPagamentoPeca[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IPagamentoPeca | null>(null);

    useEffect(() => {
        loadPagamentos();
    }, []);

    const loadPagamentos = async () => {
        try {
            const response = await api.get('/pagamento-peca');
            setPagamentos(response.data);
        } catch (error) {
            alert('Erro ao carregar pagamentos');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/pagamento-peca/${searchId}`);
            setEditData(response.data);
        } catch (error) {
            alert('Pagamento não encontrado');
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/pagamento-peca/${editData.id_pagamento_peca}`, editData);
            alert('Pagamento atualizado!');
            loadPagamentos();
        } catch (error) {
            alert('Erro ao atualizar pagamento');
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/pagamento-peca/${searchId}`);
            alert('Pagamento deletado!');
            loadPagamentos();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar pagamento');
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-slate-800">Pagamentos de Peças</h1>
                    <p className="text-slate-500">Rastreio de custos reais pagos aos fornecedores.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-orange-600 hover:bg-orange-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Novo Pagamento
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Item OS</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Fornecedor</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Custo Real</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Data Compra</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Status</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {pagamentos.map((pag) => (
                            <tr key={pag.id_pagamento_peca} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{pag.id_pagamento_peca}</td>
                                <td className="p-4 text-slate-600">Item #{pag.id_item_os}</td>
                                <td className="p-4 text-slate-600">Forn. #{pag.id_fornecedor}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-2">
                                        <DollarSign size={16} className="text-orange-600" />
                                        <span className="font-bold text-orange-700">R$ {Number(pag.custo_real).toFixed(2)}</span>
                                    </div>
                                </td>
                                <td className="p-4 text-xs text-slate-500">
                                    {new Date(pag.data_compra).toLocaleDateString('pt-BR')}
                                </td>
                                <td className="p-4">
                                    {pag.pago_ao_fornecedor ? (
                                        <span className="flex items-center gap-1 text-green-700 font-medium">
                                            <CheckCircle size={16} /> Pago
                                        </span>
                                    ) : (
                                        <span className="flex items-center gap-1 text-red-700 font-medium">
                                            <XCircle size={16} /> Pendente
                                        </span>
                                    )}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção de Pagamento (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID do Pagamento..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando Pagamento #{editData.id_pagamento_peca}</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="text-xs font-bold block mb-1">Custo Real (R$)</label>
                                <input 
                                    type="number"
                                    step="0.01"
                                    value={editData.custo_real} 
                                    onChange={(e) => setEditData({...editData, custo_real: Number(e.target.value)})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                            <div className="flex items-center">
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input 
                                        type="checkbox"
                                        checked={editData.pago_ao_fornecedor} 
                                        onChange={(e) => setEditData({...editData, pago_ao_fornecedor: e.target.checked})} 
                                        className="w-5 h-5 text-green-600"
                                    />
                                    <span className="text-sm font-bold text-gray-700">Pago ao Fornecedor</span>
                                </label>
                            </div>
                        </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Novo Pagamento de Peça" onClose={() => setShowModal(false)}>
                    <PagamentoPecaForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadPagamentos();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\PecasEstoquePage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { IPecasEstoque } from '../types/backend';
import { PecasEstoqueForm } from '../components/forms/PecasEstoqueForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, Package } from 'lucide-react';
import { StatusBanner } from '../components/ui/StatusBanner';

export const PecasEstoquePage = () => {
    const [pecas, setPecas] = useState<IPecasEstoque[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IPecasEstoque | null>(null);
    const [statusMsg, setStatusMsg] = useState<{ type: 'success' | 'error' | null, text: string }>({ type: null, text: '' });

    useEffect(() => {
        loadPecas();
    }, []);

    const loadPecas = async () => {
        try {
            const response = await api.get('/pecas-estoque');
            setPecas(response.data);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao carregar estoque.' });
        }
    };

    const handleSearch = async () => {
        if (!searchId) return;
        try {
            const response = await api.get(`/pecas-estoque/${searchId}`);
            setEditData(response.data);
            setStatusMsg({ type: 'success', text: 'Peça localizada!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 2000);
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Peça não encontrada.' });
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
             const payload = {
                ...editData,
                valor_custo: Number(editData.valor_custo),
                valor_venda: Number(editData.valor_venda),
                estoque_atual: Number(editData.estoque_atual)
             }
            await api.put(`/pecas-estoque/${editData.id_pecas_estoque}`, payload);
            setStatusMsg({ type: 'success', text: 'Peça atualizada com sucesso!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
            loadPecas();
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao atualizar peça.' });
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        if (!confirm('Deseja realmente excluir este item?')) return;
        try {
            await api.delete(`/pecas-estoque/${searchId}`);
            setStatusMsg({ type: 'success', text: 'Peça removida do sistema.' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
            loadPecas();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao deletar peça.' });
        }
    };

    return (
        <div className="space-y-6">
            <StatusBanner msg={statusMsg} onClose={() => setStatusMsg({type: null, text: ''})} />

            <div className="flex justify-between items-center">
                <div>
                     <h1 className="text-2xl font-bold text-neutral-900">Estoque de Peças</h1>
                     <p className="text-neutral-500">Gerencie o inventário de peças e serviços.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Nova Peça
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-neutral-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-neutral-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-neutral-500 uppercase">ID</th>
                            <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Produto/Peça</th>
                            <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Fabricante</th>
                            <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Estoque</th>
                            <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Valor</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-neutral-100">
                        {pecas.map((p) => (
                            <tr key={p.id_pecas_estoque} className="hover:bg-neutral-50">
                                <td className="p-4 text-neutral-500 font-mono">#{p.id_pecas_estoque}</td>
                                <td className="p-4 font-medium">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-info-50 p-2 rounded-lg text-info-600">
                                            <Package size={18} />
                                        </div>
                                        <div>
                                            <div className="text-neutral-900">{p.nome}</div>
                                            <div className="text-xs text-neutral-500">{p.descricao}</div>
                                        </div>
                                    </div>
                                </td>
                                <td className="p-4 border-gray-100 text-right font-medium text-slate-700">{p.estoque_atual} {p.unidade_medida}</td>
                                <td className="p-4 border-gray-100 text-right font-bold text-green-600">
                                    R$ {Number(p.valor_venda).toFixed(2)}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE (Search/Update/Delete) */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção de Item (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID da Peça..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando: {editData.nome}</h3>
                         <div className="grid grid-cols-2 gap-4 mb-4">
                             <div>
                                 <label className="text-xs font-bold block mb-1">Nome</label>
                                 <input 
                                     value={editData.nome} 
                                     onChange={(e) => setEditData({...editData, nome: e.target.value})} 
                                     className="border p-2 w-full rounded" 
                                 />
                             </div>
                             <div>
                                 <label className="text-xs font-bold block mb-1">Estoque</label>
                                 <input 
                                     type="number"
                                     value={editData.estoque_atual} 
                                     onChange={(e) => setEditData({...editData, estoque_atual: Number(e.target.value)})} 
                                     className="border p-2 w-full rounded" 
                                 />
                             </div>
                         </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Nova Peça no Estoque" onClose={() => setShowModal(false)}>
                    <PecasEstoqueForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadPecas();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\PessoaFisicaPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { IPessoaFisica } from '../types/backend';
import { PessoaFisicaForm } from '../components/forms/PessoaFisicaForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, UserCheck } from 'lucide-react';

export const PessoaFisicaPage = () => {
    const [pessoasFisicas, setPessoasFisicas] = useState<IPessoaFisica[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IPessoaFisica | null>(null);

    useEffect(() => {
        loadPessoasFisicas();
    }, []);

    const loadPessoasFisicas = async () => {
        try {
            const response = await api.get('/pessoa-fisica');
            setPessoasFisicas(response.data);
        } catch (error) {
            alert('Erro ao carregar pessoas físicas');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/pessoa-fisica/${searchId}`);
            setEditData(response.data);
        } catch (error) {
            alert('Pessoa Física não encontrada');
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/pessoa-fisica/${editData.id_pessoa_fisica}`, editData);
            alert('Pessoa Física atualizada!');
            loadPessoasFisicas();
        } catch (error) {
            alert('Erro ao atualizar pessoa física');
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/pessoa-fisica/${searchId}`);
            alert('Pessoa Física deletada!');
            loadPessoasFisicas();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar pessoa física');
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-slate-800">Pessoas Físicas</h1>
                    <p className="text-slate-500">Especialização de Pessoa com CPF.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Nova Pessoa Física
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID PF</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID Pessoa</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">CPF</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Cadastro</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {pessoasFisicas.map((pf) => (
                            <tr key={pf.id_pessoa_fisica} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{pf.id_pessoa_fisica}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-blue-50 p-2 rounded-lg text-blue-600">
                                            <UserCheck size={18} />
                                        </div>
                                        <span className="font-medium text-slate-900">ID: {pf.id_pessoa}</span>
                                    </div>
                                </td>
                                <td className="p-4 font-mono text-slate-700">{pf.cpf || '-'}</td>
                                <td className="p-4 text-xs text-slate-500">
                                    {new Date(pf.dt_cadastro).toLocaleDateString('pt-BR')}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID da Pessoa Física..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando PF #{editData.id_pessoa_fisica}</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="text-xs font-bold block mb-1">CPF</label>
                                <input 
                                    value={editData.cpf || ''} 
                                    onChange={(e) => setEditData({...editData, cpf: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                    maxLength={11}
                                />
                            </div>
                        </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Nova Pessoa Física" onClose={() => setShowModal(false)}>
                    <PessoaFisicaForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadPessoasFisicas();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\PessoaJuridicaPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { IPessoaJuridica } from '../types/backend';
import { PessoaJuridicaForm } from '../components/forms/PessoaJuridicaForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, Building2 } from 'lucide-react';

export const PessoaJuridicaPage = () => {
    const [pessoasJuridicas, setPessoasJuridicas] = useState<IPessoaJuridica[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IPessoaJuridica | null>(null);

    useEffect(() => {
        loadPessoasJuridicas();
    }, []);

    const loadPessoasJuridicas = async () => {
        try {
            const response = await api.get('/pessoa-juridica');
            setPessoasJuridicas(response.data);
        } catch (error) {
            alert('Erro ao carregar pessoas jurídicas');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/pessoa-juridica/${searchId}`);
            setEditData(response.data);
        } catch (error) {
            alert('Pessoa Jurídica não encontrada');
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/pessoa-juridica/${editData.id_pessoa_juridica}`, editData);
            alert('Pessoa Jurídica atualizada!');
            loadPessoasJuridicas();
        } catch (error) {
            alert('Erro ao atualizar pessoa jurídica');
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/pessoa-juridica/${searchId}`);
            alert('Pessoa Jurídica deletada!');
            loadPessoasJuridicas();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar pessoa jurídica');
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-slate-800">Pessoas Jurídicas</h1>
                    <p className="text-slate-500">Especialização de Pessoa com CNPJ.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Nova Pessoa Jurídica
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID PJ</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Empresa</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">CNPJ</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID Pessoa</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Cadastro</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {pessoasJuridicas.map((pj) => (
                            <tr key={pj.id_pessoa_juridica} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{pj.id_pessoa_juridica}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-purple-50 p-2 rounded-lg text-purple-600">
                                            <Building2 size={18} />
                                        </div>
                                        <div>
                                            <div className="font-medium text-slate-900">{pj.razao_social}</div>
                                            {pj.nome_fantasia && <div className="text-xs text-slate-500">{pj.nome_fantasia}</div>}
                                        </div>
                                    </div>
                                </td>
                                <td className="p-4 font-mono text-slate-700">{pj.cnpj || '-'}</td>
                                <td className="p-4 text-slate-600">ID: {pj.id_pessoa}</td>
                                <td className="p-4 text-xs text-slate-500">
                                    {new Date(pj.dt_cadastro).toLocaleDateString('pt-BR')}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID da Pessoa Jurídica..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando: {editData.razao_social}</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="col-span-2">
                                <label className="text-xs font-bold block mb-1">Razão Social</label>
                                <input 
                                    value={editData.razao_social} 
                                    onChange={(e) => setEditData({...editData, razao_social: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold block mb-1">CNPJ</label>
                                <input 
                                    value={editData.cnpj || ''} 
                                    onChange={(e) => setEditData({...editData, cnpj: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                    maxLength={14}
                                />
                            </div>
                        </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Nova Pessoa Jurídica" onClose={() => setShowModal(false)}>
                    <PessoaJuridicaForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadPessoasJuridicas();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\PessoaPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { IPessoa } from '../types/backend';
import { PessoaForm } from '../components/forms/PessoaForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, User } from 'lucide-react';

export const PessoaPage = () => {
    const [pessoas, setPessoas] = useState<IPessoa[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<IPessoa | null>(null);

    useEffect(() => {
        loadPessoas();
    }, []);

    const loadPessoas = async () => {
        try {
            const response = await api.get('/pessoa');
            setPessoas(response.data);
        } catch (error) {
            alert('Erro ao carregar pessoas');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/pessoa/${searchId}`);
            setEditData(response.data);
        } catch (error) {
            alert('Pessoa não encontrada');
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/pessoa/${editData.id_pessoa}`, editData);
            alert('Pessoa atualizada!');
            loadPessoas();
        } catch (error) {
            alert('Erro ao atualizar pessoa');
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/pessoa/${searchId}`);
            alert('Pessoa deletada!');
            loadPessoas();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar pessoa');
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-slate-800">Gerenciar Pessoas</h1>
                    <p className="text-slate-500">Cadastro base de pessoas (antes de PF/PJ).</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Nova Pessoa
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Nome</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Gênero</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Data Nascimento</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Cadastro</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {pessoas.map((p) => (
                            <tr key={p.id_pessoa} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{p.id_pessoa}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-blue-50 p-2 rounded-lg text-blue-600">
                                            <User size={18} />
                                        </div>
                                        <div className="font-medium text-slate-900">{p.nome}</div>
                                    </div>
                                </td>
                                <td className="p-4 text-slate-600">{p.genero || '-'}</td>
                                <td className="p-4 text-slate-600">
                                    {p.dt_nascimento ? new Date(p.dt_nascimento).toLocaleDateString('pt-BR') : '-'}
                                </td>
                                <td className="p-4 text-xs text-slate-500">
                                    {new Date(p.dt_cadastro).toLocaleDateString('pt-BR')}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção de Pessoa (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID da Pessoa..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando: {editData.nome}</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="col-span-2">
                                <label className="text-xs font-bold block mb-1">Nome</label>
                                <input 
                                    value={editData.nome} 
                                    onChange={(e) => setEditData({...editData, nome: e.target.value})} 
                                    className="border p-2 w-full rounded" 
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold block mb-1">Gênero</label>
                                <select 
                                    value={editData.genero || ''} 
                                    onChange={(e) => setEditData({...editData, genero: e.target.value})} 
                                    className="border p-2 w-full rounded"
                                >
                                    <option value="">Selecione...</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Feminino">Feminino</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                        </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Nova Pessoa" onClose={() => setShowModal(false)}>
                    <PessoaForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadPessoas();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\SearchClientePage.tsx
================================================================================
import { useState } from 'react';
import { api } from '../services/api';
import { Search, User, Car, Edit, Trash2, MapPin, Phone, Mail } from 'lucide-react';

interface ICliente {
    id_cliente: number;
    telefone_1: string;
    telefone_2?: string;
    email?: string;
    logradouro: string;
    nr_logradouro: string;
    compl_logradouro?: string;
    bairro: string;
    cidade: string;
    estado: string;
    pessoa_fisica?: {
        id_pessoa_fisica: number;
        cpf?: string;
        pessoa: {
            nome: string;
            genero?: string;
            dt_nascimento?: string;
        };
    };
    pessoa_juridica?: {
        id_pessoa_juridica: number;
        razao_social: string;
        nome_fantasia?: string;
        cnpj?: string;
    };
    veiculos?: IVeiculo[];
}

interface IVeiculo {
    id_veiculo: number;
    placa: string;
    marca: string;
    modelo: string;
    cor: string;
    ano_modelo?: string;
}

export const SearchClientePage = () => {
    const [searchTerm, setSearchTerm] = useState('');
    const [clientes, setClientes] = useState<ICliente[]>([]);
    const [selectedCliente, setSelectedCliente] = useState<ICliente | null>(null);
    const [loading, setLoading] = useState(false);

    const handleSearch = async () => {
        if (!searchTerm.trim()) {
            alert('Digite um nome para buscar');
            return;
        }

        setLoading(true);
        try {
            const response = await api.get(`/cliente/search?name=${searchTerm}`);
            setClientes(response.data);
            if (response.data.length === 0) {
                alert('Nenhum cliente encontrado');
            }
        } catch (error) {
            console.error(error);
            alert('Erro ao buscar clientes');
        } finally {
            setLoading(false);
        }
    };

    const loadClienteDetails = async (id: number) => {
        try {
            const response = await api.get(`/cliente/${id}`);
            setSelectedCliente(response.data);
        } catch (error) {
            alert('Erro ao carregar detalhes do cliente');
        }
    };

    const getNome = (cliente: ICliente) => {
        if (cliente.pessoa_fisica) {
            return cliente.pessoa_fisica.pessoa.nome;
        }
        if (cliente.pessoa_juridica) {
            return cliente.pessoa_juridica.razao_social;
        }
        return 'Nome não disponível';
    };

    return (
        <div className="space-y-6">
            <div>
                <h1 className="text-2xl font-bold text-slate-800">Pesquisar Cliente</h1>
                <p className="text-slate-500">Busque por nome (PF ou PJ)</p>
            </div>

            {/* SEARCH BAR */}
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                <div className="flex gap-4">
                    <input
                        type="text"
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                        placeholder="Digite o nome do cliente... (ex: João Silva, Tania, ACME Ltda)"
                        className="flex-1 border p-3 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary-500 outline-none"
                    />
                    <button
                        onClick={handleSearch}
                        disabled={loading}
                        className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-medium shadow-sm transition-all disabled:opacity-50"
                    >
                        <Search size={20} />
                        {loading ? 'Buscando...' : 'Buscar'}
                    </button>
                </div>
            </div>

            {/* RESULTS LIST */}
            {clientes.length > 0 && (
                <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                    <div className="p-4 bg-slate-50 border-b">
                        <h2 className="font-bold text-slate-700">Resultados ({clientes.length})</h2>
                    </div>
                    <div className="divide-y">
                        {clientes.map((cliente) => (
                            <div
                                key={cliente.id_cliente}
                                onClick={() => loadClienteDetails(cliente.id_cliente)}
                                className="p-4 hover:bg-slate-50 cursor-pointer transition-colors"
                            >
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-primary-50 p-3 rounded-lg text-primary-600">
                                            <User size={20} />
                                        </div>
                                        <div>
                                            <h3 className="font-bold text-slate-800">{getNome(cliente)}</h3>
                                            <p className="text-sm text-slate-500">
                                                {cliente.pessoa_fisica && `CPF: ${cliente.pessoa_fisica.cpf || 'N/A'}`}
                                                {cliente.pessoa_juridica && `CNPJ: ${cliente.pessoa_juridica.cnpj || 'N/A'}`}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-sm text-slate-600">{cliente.telefone_1}</p>
                                        <p className="text-xs text-slate-400">{cliente.cidade} - {cliente.estado}</p>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* SELECTED CLIENTE DETAILS */}
            {selectedCliente && (
                <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    <div className="bg-gradient-to-r from-primary-600 to-primary-700 p-6 text-white">
                        <div className="flex justify-between items-start">
                            <div>
                                <h2 className="text-2xl font-bold mb-1">{getNome(selectedCliente)}</h2>
                                <p className="text-primary-100">
                                    {selectedCliente.pessoa_fisica && `CPF: ${selectedCliente.pessoa_fisica.cpf || 'Não informado'}`}
                                    {selectedCliente.pessoa_juridica && `CNPJ: ${selectedCliente.pessoa_juridica.cnpj || 'Não informado'}`}
                                </p>
                            </div>
                            <div className="flex gap-2">
                                <button className="bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-colors">
                                    <Edit size={20} />
                                </button>
                                <button className="bg-red-500/80 hover:bg-red-600 p-2 rounded-lg transition-colors">
                                    <Trash2 size={20} />
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="p-6 space-y-6">
                        {/* CONTACT INFO */}
                        <div>
                            <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                                <Phone size={18} className="text-primary-600" />
                                Contato
                            </h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs text-slate-500">Telefone Principal</label>
                                    <p className="font-medium">{selectedCliente.telefone_1}</p>
                                </div>
                                {selectedCliente.telefone_2 && (
                                    <div>
                                        <label className="text-xs text-slate-500">Telefone 2</label>
                                        <p className="font-medium">{selectedCliente.telefone_2}</p>
                                    </div>
                                )}
                                {selectedCliente.email && (
                                    <div className="col-span-2">
                                        <label className="text-xs text-slate-500 flex items-center gap-1">
                                            <Mail size={14} /> Email
                                        </label>
                                        <p className="font-medium">{selectedCliente.email}</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* ADDRESS */}
                        <div>
                            <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                                <MapPin size={18} className="text-primary-600" />
                                Endereço
                            </h3>
                            <div className="bg-slate-50 p-4 rounded-lg">
                                <p className="font-medium">
                                    {selectedCliente.logradouro}, {selectedCliente.nr_logradouro}
                                    {selectedCliente.compl_logradouro && ` - ${selectedCliente.compl_logradouro}`}
                                </p>
                                <p className="text-slate-600">
                                    {selectedCliente.bairro} - {selectedCliente.cidade}/{selectedCliente.estado}
                                </p>
                            </div>
                        </div>

                        {/* VEHICLES */}
                        {selectedCliente.veiculos && selectedCliente.veiculos.length > 0 && (
                            <div>
                                <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                                    <Car size={18} className="text-primary-600" />
                                    Veículos ({selectedCliente.veiculos.length})
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    {selectedCliente.veiculos.map((veiculo) => (
                                        <div key={veiculo.id_veiculo} className="border border-slate-200 p-4 rounded-lg hover:border-primary-300 transition-colors">
                                            <div className="flex items-center gap-3">
                                                <div className="bg-slate-100 p-2 rounded">
                                                    <Car size={20} className="text-slate-600" />
                                                </div>
                                                <div>
                                                    <p className="font-bold text-slate-800">{veiculo.placa}</p>
                                                    <p className="text-sm text-slate-600">{veiculo.marca} {veiculo.modelo}</p>
                                                    <p className="text-xs text-slate-500">{veiculo.cor} • {veiculo.ano_modelo || 'Ano N/A'}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\SearchVeiculoPage.tsx
================================================================================
import { useState } from 'react';
import { api } from '../services/api';
import { Search, Car, User, Edit, Trash2, MapPin, Phone } from 'lucide-react';
import { normalizePlate } from '../utils/normalize';

interface IVeiculo {
    id_veiculo: number;
    placa: string;
    marca: string;
    modelo: string;
    cor: string;
    ano_modelo?: string;
    combustivel?: string;
    chassi?: string;
    cliente: {
        id_cliente: number;
        telefone_1: string;
        email?: string;
        logradouro: string;
        nr_logradouro: string;
        bairro: string;
        cidade: string;
        estado: string;
        pessoa_fisica?: {
            pessoa: {
                nome: string;
            };
            cpf?: string;
        };
        pessoa_juridica?: {
            pessoa: {
                nome: string;
            };
            cnpj?: string;
        };
    };
}

export const SearchVeiculoPage = () => {
    const [searchPlaca, setSearchPlaca] = useState('');
    const [veiculo, setVeiculo] = useState<IVeiculo | null>(null);
    const [loading, setLoading] = useState(false);

    const handleSearch = async () => {
        if (!searchPlaca.trim()) {
            alert('Digite uma placa para buscar');
            return;
        }

        setLoading(true);
        try {
            // Normalize plate before searching
            const normalized = normalizePlate(searchPlaca);
            const response = await api.get(`/veiculo/placa/${normalized}`);
            setVeiculo(response.data);
        } catch (error) {
            console.error(error);
            alert('Veículo não encontrado');
            setVeiculo(null);
        } finally {
            setLoading(false);
        }
    };

    const getClienteNome = (cliente: IVeiculo['cliente']) => {
        if (cliente.pessoa_fisica) {
            return cliente.pessoa_fisica.pessoa.nome;
        }
        if (cliente.pessoa_juridica) {
            return cliente.pessoa_juridica.pessoa.nome;
        }
        return 'Nome não disponível';
    };

    return (
        <div className="space-y-6">
            <div>
                <h1 className="text-2xl font-bold text-slate-800">Pesquisar Veículo</h1>
                <p className="text-slate-500">Busque pela placa (com ou sem hífen)</p>
            </div>

            {/* SEARCH BAR */}
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                <div className="flex gap-4">
                    <input
                        type="text"
                        value={searchPlaca}
                        onChange={(e) => setSearchPlaca(e.target.value.toUpperCase())}
                        onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                        placeholder="Digite a placa... (ex: GIN1175 ou GIN-1175)"
                        className="flex-1 border p-3 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary-500 outline-none font-mono text-lg tracking-wider"
                        maxLength={8}
                    />
                    <button
                        onClick={handleSearch}
                        disabled={loading}
                        className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-medium shadow-sm transition-all disabled:opacity-50"
                    >
                        <Search size={20} />
                        {loading ? 'Buscando...' : 'Buscar'}
                    </button>
                </div>
                <p className="text-xs text-slate-400 mt-2">
                    💡 Dica: Você pode digitar com ou sem hífen (GIN1175 = GIN-1175)
                </p>
            </div>

            {/* VEHICLE DETAILS */}
            {veiculo && (
                <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    <div className="bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-white">
                        <div className="flex justify-between items-start">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <Car size={32} />
                                    <h2 className="text-3xl font-bold font-mono tracking-wider">{veiculo.placa}</h2>
                                </div>
                                <p className="text-blue-100 text-lg">{veiculo.marca} {veiculo.modelo}</p>
                                <p className="text-blue-200 text-sm">{veiculo.cor} • {veiculo.ano_modelo || 'Ano N/A'}</p>
                            </div>
                            <div className="flex gap-2">
                                <button className="bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-colors">
                                    <Edit size={20} />
                                </button>
                                <button className="bg-red-500/80 hover:bg-red-600 p-2 rounded-lg transition-colors">
                                    <Trash2 size={20} />
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="p-6 space-y-6">
                        {/* VEHICLE INFO */}
                        <div>
                            <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                                <Car size={18} className="text-blue-600" />
                                Informações do Veículo
                            </h3>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div>
                                    <label className="text-xs text-slate-500">Marca</label>
                                    <p className="font-medium">{veiculo.marca}</p>
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500">Modelo</label>
                                    <p className="font-medium">{veiculo.modelo}</p>
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500">Cor</label>
                                    <p className="font-medium">{veiculo.cor}</p>
                                </div>
                                {veiculo.ano_modelo && (
                                    <div>
                                        <label className="text-xs text-slate-500">Ano/Modelo</label>
                                        <p className="font-medium">{veiculo.ano_modelo}</p>
                                    </div>
                                )}
                                {veiculo.combustivel && (
                                    <div>
                                        <label className="text-xs text-slate-500">Combustível</label>
                                        <p className="font-medium">{veiculo.combustivel}</p>
                                    </div>
                                )}
                                {veiculo.chassi && (
                                    <div className="col-span-2">
                                        <label className="text-xs text-slate-500">Chassi</label>
                                        <p className="font-medium font-mono text-sm">{veiculo.chassi}</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* OWNER INFO */}
                        <div className="border-t pt-6">
                            <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                                <User size={18} className="text-primary-600" />
                                Proprietário
                            </h3>
                            
                            <div className="bg-primary-50 p-5 rounded-lg border border-primary-100">
                                <div className="flex items-start justify-between mb-4">
                                    <div>
                                        <h4 className="text-xl font-bold text-slate-800 mb-1">
                                            {getClienteNome(veiculo.cliente)}
                                        </h4>
                                        <p className="text-sm text-slate-600">
                                            {veiculo.cliente.pessoa_fisica && `CPF: ${veiculo.cliente.pessoa_fisica.cpf || 'Não informado'}`}
                                            {veiculo.cliente.pessoa_juridica && `CNPJ: ${veiculo.cliente.pessoa_juridica.cnpj || 'Não informado'}`}
                                        </p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="text-xs text-slate-500 flex items-center gap-1 mb-1">
                                            <Phone size={12} /> Telefone
                                        </label>
                                        <p className="font-medium text-slate-800">{veiculo.cliente.telefone_1}</p>
                                    </div>
                                    {veiculo.cliente.email && (
                                        <div>
                                            <label className="text-xs text-slate-500 mb-1 block">Email</label>
                                            <p className="font-medium text-slate-800">{veiculo.cliente.email}</p>
                                        </div>
                                    )}
                                    <div className="col-span-2">
                                        <label className="text-xs text-slate-500 flex items-center gap-1 mb-1">
                                            <MapPin size={12} /> Endereço
                                        </label>
                                        <p className="font-medium text-slate-800">
                                            {veiculo.cliente.logradouro}, {veiculo.cliente.nr_logradouro}
                                        </p>
                                        <p className="text-sm text-slate-600">
                                            {veiculo.cliente.bairro} - {veiculo.cliente.cidade}/{veiculo.cliente.estado}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\TipoPage.tsx
================================================================================
import { useState, useEffect } from 'react';
import { api } from '../services/api';
import type { ITipo } from '../types/backend';
import { TipoForm } from '../components/forms/TipoForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, Tag } from 'lucide-react';

export const TipoPage = () => {
    const [tipos, setTipos] = useState<ITipo[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [searchId, setSearchId] = useState('');
    const [editData, setEditData] = useState<ITipo | null>(null);

    useEffect(() => {
        loadTipos();
    }, []);

    const loadTipos = async () => {
        try {
            const response = await api.get('/tipo');
            setTipos(response.data);
        } catch (error) {
            alert('Erro ao carregar tipos');
        }
    };

    const handleSearch = async () => {
        try {
            const response = await api.get(`/tipo/${searchId}`);
            setEditData(response.data);
        } catch (error) {
            alert('Tipo não encontrado');
            setEditData(null);
        }
    };

    const handleUpdate = async () => {
        if (!editData) return;
        try {
            await api.put(`/tipo/${editData.id_tipo}`, editData);
            alert('Tipo atualizado!');
            loadTipos();
        } catch (error) {
            alert('Erro ao atualizar tipo');
        }
    };

    const handleDelete = async () => {
        if (!searchId) return;
        try {
            await api.delete(`/tipo/${searchId}`);
            alert('Tipo deletado!');
            loadTipos();
            setEditData(null);
            setSearchId('');
        } catch (error) {
            alert('Erro ao deletar tipo');
        }
    };

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <div>
                    <h1 className="text-2xl font-bold text-slate-800">Tipos / Funções</h1>
                    <p className="text-slate-500">Categorias e funções de pessoas/empresas.</p>
                </div>
                <button 
                    onClick={() => setShowModal(true)}
                    className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Novo Tipo
                </button>
            </div>

            {/* LIST */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead className="bg-slate-50">
                        <tr>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">ID</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Função</th>
                            <th className="p-4 text-xs font-bold text-gray-500 uppercase">Cadastro</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {tipos.map((t) => (
                            <tr key={t.id_tipo} className="hover:bg-slate-50">
                                <td className="p-4 text-gray-500 font-mono">#{t.id_tipo}</td>
                                <td className="p-4">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-green-50 p-2 rounded-lg text-green-600">
                                            <Tag size={18} />
                                        </div>
                                        <span className="font-medium text-slate-900">{t.funcao || 'Sem função definida'}</span>
                                    </div>
                                </td>
                                <td className="p-4 text-xs text-slate-500">
                                    {new Date(t.dt_cadastro).toLocaleDateString('pt-BR')}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* MANAGE */}
            <div className="bg-white p-4 rounded-xl border border-gray-200">
                <h2 className="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Manutenção de Tipo (Por ID)</h2>
                <div className="flex gap-4 mb-4">
                    <input 
                        type="number" 
                        value={searchId} 
                        onChange={(e) => setSearchId(e.target.value)} 
                        placeholder="Digite o ID do Tipo..." 
                        className="border p-2 rounded w-64"
                    />
                    <button onClick={handleSearch} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded hover:bg-slate-700">
                        <Search size={18} /> Localizar
                    </button>
                    {searchId && <button onClick={handleDelete} className="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        <Trash2 size={18} /> Excluir
                    </button>}
                </div>

                {editData && (
                    <div className="bg-slate-50 p-4 rounded border animate-in fade-in">
                        <h3 className="font-bold mb-2">Editando Tipo #{editData.id_tipo}</h3>
                        <div className="mb-4">
                            <label className="text-xs font-bold block mb-1">Função</label>
                            <input 
                                value={editData.funcao || ''} 
                                onChange={(e) => setEditData({...editData, funcao: e.target.value})} 
                                className="border p-2 w-full rounded" 
                            />
                        </div>
                        <button onClick={handleUpdate} className="flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-bold">
                            <Edit size={18} /> Salvar Alterações
                        </button>
                    </div>
                )}
            </div>

            {showModal && (
                <Modal title="Novo Tipo" onClose={() => setShowModal(false)}>
                    <TipoForm 
                        onSuccess={() => {
                            setShowModal(false);
                            loadTipos();
                        }}
                        onCancel={() => setShowModal(false)}
                    />
                </Modal>
            )}
        </div>
    );
};



================================================================================
FILE PATH: client\src\pages\VeiculoPage.tsx
================================================================================
import { useState, useEffect, useRef } from 'react';
import { api } from '../services/api';
import type { IVeiculo } from '../types/backend';
import { ClienteForm } from '../components/forms/ClienteForm';
import { VeiculoForm } from '../components/forms/VeiculoForm';
import { Modal } from '../components/ui/Modal';
import { Plus, Search, Trash2, Edit, Car } from 'lucide-react';
import { StatusBanner } from '../components/ui/StatusBanner';

export const VeiculoPage = () => {
    const [veiculos, setVeiculos] = useState<IVeiculo[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [modalMode, setModalMode] = useState<'vehicle' | 'client'>('vehicle');
    const [searchTerm, setSearchTerm] = useState('');
    const [editingVehicle, setEditingVehicle] = useState<IVeiculo | undefined>(undefined);
    const [selectedClientId, setSelectedClientId] = useState<number | null>(null);
    const [statusMsg, setStatusMsg] = useState<{ type: 'success' | 'error' | null, text: string }>({ type: null, text: '' });
    const [activeIndex, setActiveIndex] = useState(-1);
    const searchInputRef = useRef<HTMLInputElement>(null);

    useEffect(() => {
        if (searchInputRef.current) searchInputRef.current.focus();
    }, []);

    const handleKeyDown = (e: React.KeyboardEvent) => {
        if (filteredVeiculos.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            setActiveIndex(prev => (prev + 1 >= filteredVeiculos.length ? 0 : prev + 1));
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            setActiveIndex(prev => (prev - 1 < 0 ? filteredVeiculos.length - 1 : prev - 1));
        } else if (e.key === 'Enter') {
            if (activeIndex !== -1) {
                e.preventDefault();
                openEditModal(filteredVeiculos[activeIndex]);
            }
        } else if (e.key === 'Escape') {
            setSearchTerm('');
            setActiveIndex(-1);
        }
    };

    useEffect(() => {
        setActiveIndex(-1);
    }, [searchTerm]);

    useEffect(() => {
        loadVeiculos();
    }, []);

    const loadVeiculos = async () => {
        try {
            const response = await api.get('/veiculo');
            setVeiculos(response.data);
        } catch (error) {
            console.error(error);
            // alert('Erro ao carregar veículos'); // Suppress initial load error alert to avoid noise if empty
        }
    };

    const handleDelete = async (id: number) => {
        if (!confirm('Tem certeza que deseja excluir este veículo?')) return;
        try {
            await api.delete(`/veiculo/${id}`);
            setStatusMsg({ type: 'success', text: 'Veículo removido com sucesso!' });
            setTimeout(() => setStatusMsg({ type: null, text: '' }), 3000);
            loadVeiculos();
        } catch (error) {
            setStatusMsg({ type: 'error', text: 'Erro ao deletar veículo. Verifique se há O.S. vinculadas.' });
        }
    };

    const openCreateModal = () => {
        setModalMode('vehicle');
        setSelectedClientId(null);
        setEditingVehicle(undefined);
        setShowModal(true);
    };

    const openEditModal = (vehicle: IVeiculo) => {
        setModalMode('vehicle');
        setEditingVehicle(vehicle);
        setSelectedClientId(null); // Not needed for edit usually, or implicitly part of vehicle
        setShowModal(true);
    };

    const filteredVeiculos = veiculos.filter(v => 
        v.placa.toLowerCase().includes(searchTerm.toLowerCase()) ||
        v.modelo.toLowerCase().includes(searchTerm.toLowerCase()) ||
        v.marca.toLowerCase().includes(searchTerm.toLowerCase())
    );

    return (
        <div className="space-y-6">

            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h1 className="text-2xl font-bold text-neutral-900">Gerenciar Veículos</h1>
                    <p className="text-neutral-500">Cadastro e manutenção da frota de veículos.</p>
                </div>
                <button 
                    onClick={openCreateModal}
                    className="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2.5 rounded-lg font-medium shadow-sm transition-all"
                >
                    <Plus size={20} />
                    Novo Veículo
                </button>
            </div>

            {/* BARRA DE BUSCA */}
            <div className="bg-surface p-4 rounded-xl shadow-sm border border-neutral-200 flex gap-4">
                <div className="relative flex-1">
                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400" size={20} />
                    <input 
                        ref={searchInputRef}
                        type="text"
                        placeholder="Buscar por placa, modelo ou marca..."
                        className="w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all font-mono text-neutral-900"
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        onKeyDown={handleKeyDown}
                    />
                </div>
            </div>

            {/* LIST */}
            <div className="bg-surface rounded-xl shadow-sm border border-neutral-200 overflow-hidden">
                <div className="overflow-x-auto">
                    <table className="w-full text-left border-collapse">
                        <thead className="bg-neutral-50">
                            <tr>
                                <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Veículo</th>
                                <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Placa</th>
                                <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Cliente (ID)</th>
                                <th className="p-4 text-xs font-bold text-neutral-500 uppercase">Ações</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-neutral-100">
                            {filteredVeiculos.map((v, idx) => (
                                <tr key={v.id_veiculo} className={`transition-colors hover:bg-neutral-25 ${idx === activeIndex ? 'bg-primary-50 ring-2 ring-primary-500 ring-inset' : ''}`}>
                                    <td className="p-4">
                                        <div className="flex items-center gap-3">
                                            <div className="bg-primary-50 p-2 rounded-lg text-primary-600">
                                                <Car size={18} />
                                            </div>
                                            <div>
                                                <div className="font-medium text-neutral-900">{v.marca} {v.modelo}</div>
                                                <div className="text-xs text-neutral-500">{v.ano_modelo} • {v.combustivel}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td className="p-4 font-mono font-bold text-neutral-700">{v.placa} <span className="text-xs font-normal text-neutral-400 ml-2">({v.cor})</span></td>
                                    <td className="p-4 text-neutral-600">{v.id_cliente}</td>
                                    <td className="p-4">
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={() => openEditModal(v)}
                                                className="p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors"
                                                title="Editar"
                                            >
                                                <Edit size={18} />
                                            </button>
                                            <button 
                                                onClick={() => handleDelete(v.id_veiculo)}
                                                className="p-2 text-neutral-400 hover:text-error hover:bg-error-50 rounded-lg transition-colors"
                                                title="Excluir"
                                            >
                                                <Trash2 size={18} />
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                            {filteredVeiculos.length === 0 && (
                                <tr>
                                    <td colSpan={5} className="p-8 text-center text-neutral-400">
                                        Nenhum veículo encontrado.
                                    </td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                </div>
            </div>

            {showModal && (
                <Modal 
                    title={
                        modalMode === 'client' 
                            ? "Novo Cliente" 
                            : (editingVehicle ? "Editar Veículo" : "Novo Veículo")
                    } 
                    onClose={() => setShowModal(false)}
                >
                    {modalMode === 'vehicle' ? (
                        <VeiculoForm 
                            clientId={selectedClientId}
                            vehicleId={editingVehicle?.id_veiculo}
                            initialData={editingVehicle}
                            onSuccess={() => {
                                setShowModal(false);
                                loadVeiculos();
                            }}
                            onCancel={() => setShowModal(false)}
                            onCreateClient={() => setModalMode('client')}
                        />
                    ) : (
                        <ClienteForm 
                            onSuccess={(newClient) => {
                                setSelectedClientId(newClient.id_cliente);
                                setModalMode('vehicle');
                            }}
                            onCancel={() => setModalMode('vehicle')}
                        />
                    )}
                </Modal>
            )}
            <div className="fixed bottom-8 right-8 z-100 min-w-[320px]">
                <StatusBanner msg={statusMsg} onClose={() => setStatusMsg({type: null, text: ''})} />
            </div>
        </div>
    );
};



================================================================================
FILE PATH: client\src\services\api.ts
================================================================================
import axios from 'axios';

export const api = axios.create({
  baseURL: 'http://localhost:3000/api',
});



================================================================================
FILE PATH: client\src\types\backend.d.ts
================================================================================
export interface IPessoa {
    id_pessoa: number;
    nome: string;
    genero?: string | null;
    dt_nascimento?: string | null; // Date sent as string
    obs?: string | null;
    dt_cadastro: string;
}

export interface IPessoaFisica {
    id_pessoa_fisica: number;
    id_pessoa: number;
    cpf?: string | null;
    dt_cadastro: string;
}

export interface IPessoaJuridica {
    id_pessoa_juridica: number;
    id_pessoa: number;
    razao_social: string;
    nome_fantasia?: string | null;
    cnpj?: string | null;
    inscricao_estadual?: string | null;
    dt_cadastro: string;
}

export interface ITipo {
    id_tipo: number;
    funcao?: string | null;
    dt_cadastro: string;
}

export interface ICliente {
    id_cliente: number;
    id_pessoa_fisica?: number | null;
    id_pessoa_juridica?: number | null;
    tipo_pessoa: number;
    telefone_1: string;
    telefone_2?: string | null;
    telefone_3?: string | null;
    email?: string | null;
    logradouro: string;
    nr_logradouro: string;
    compl_logradouro?: string | null;
    bairro: string;
    cidade: string;
    estado: string;
    dt_cadastro: string;

    // Optional Joins
    pessoa_fisica?: IPessoaFisica & { pessoa: IPessoa };
    pessoa_juridica?: IPessoaJuridica & { pessoa: IPessoa };
    veiculos?: IVeiculo[];
}

export interface IFuncionario {
    id_funcionario: number;
    id_pessoa_fisica: number;
    ativo: string;
    cargo: string;
    salario?: number | null;
    comissao?: number | null;
    dt_admissao: string;
    dt_recisao?: string | null;
    motivo_saida?: string | null;
    obs?: string | null;
    dt_cadastro: string;

    // Optional Joins
    pessoa_fisica?: IPessoaFisica & { pessoa: IPessoa };
}

export interface IPecasEstoque {
    id_pecas_estoque: number;
    fabricante?: string | null;
    nome: string;
    descricao: string;
    valor_custo: number; // Decimal
    valor_venda: number; // Decimal
    estoque_atual: number;
    unidade_medida?: string | null;
    custo_unitario_padrao: number; // Decimal
    dt_ultima_compra?: string | null;
    dt_cadastro: string;
}

export interface IVeiculo {
    id_veiculo: number;
    id_cliente: number;
    placa: string;
    chassi?: string | null;
    marca: string;
    modelo: string;
    versao?: string | null;
    ano_modelo: string;
    cor: string;
    combustivel: string;
    obs?: string | null;
    dt_cadastro: string;

    // Optional Joins
    cliente?: ICliente;
}

export interface IOrdemDeServico {
    id_os: number;
    id_cliente: number;
    id_veiculo: number;
    id_funcionario: number;
    dt_abertura: string;
    dt_entrega?: string | null;
    km_entrada: number;
    status: string;
    defeito_relatado?: string | null;
    diagnostico?: string | null;
    valor_servico?: number | null;
    valor_pecas?: number | null;
    valor_final?: number | null;
    
    valor_total_cliente?: number | null;
    valor_mao_de_obra?: number | null;

    modo_pagamento?: string | null;
    cod_pagamento?: string | null;
    parcelas: number;
    obs?: string | null;
    obs_final?: string | null;
    dt_cadastro: string;
    
    // Optional Joins
    cliente?: ICliente;
    veiculo?: IVeiculo;
    itens_os?: IItensOs[];
}

export interface IItensOs {
    id_iten: number;
    id_os: number;
    id_pecas_estoque?: number | null;
    descricao: string;
    quantidade: number;
    valor_venda: number;
    valor_total: number;
    dt_cadastro: string;
}

export interface IFechamentoFinanceiro {
    id_fechamento_financeiro: number;
    id_os: number;
    custo_total_pecas_real: number;
    data_fechamento_financeiro: string;
}

export interface IFornecedor {
    id_fornecedor: number;
    nome: string;
    documento?: string | null;
    contato?: string | null;
    dt_cadastro: string;
}

export interface IPagamentoPeca {
    id_pagamento_peca: number;
    id_item_os: number;
    id_fornecedor: number;
    custo_real: number;
    data_compra: string;
    data_pagamento_fornecedor?: string | null;
    pago_ao_fornecedor: boolean;
}




================================================================================
FILE PATH: client\src\utils\normalize.ts
================================================================================
// Utility functions for data normalization and search

/**
 * Normaliza uma placa de veículo removendo hífens e convertendo para maiúsculas
 * Exemplos: "GIN-1175" -> "GIN1175", "gin1175" -> "GIN1175"
 */
export const normalizePlate = (plate: string): string => {
  return plate.replace(/-/g, '').toUpperCase().trim();
};

/**
 * Normaliza um nome para busca case-insensitive
 * Remove espaços extras e converte para maiúsculas
 * Exemplos: "Tania" -> "TANIA", "  joão silva  " -> "JOÃO SILVA"
 */
export const normalizeName = (name: string): string => {
  return name.trim().toUpperCase();
};

/**
 * Formata um nome seguindo o padrão Title Case (primeira letra maiúscula)
 * Exemplo: "JOÃO SILVA" -> "João Silva", "tania" -> "Tania"
 */
export const formatNameTitleCase = (name: string): string => {
  return name
    .toLowerCase()
    .split(' ')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
};

/**
 * Formata uma placa no padrão brasileiro (XXX-0000 ou XXX0X00)
 * Exemplo: "GIN1175" -> "GIN-1175"
 */
export const formatPlate = (plate: string): string => {
  const normalized = normalizePlate(plate);
  if (normalized.length === 7) {
    return `${normalized.slice(0, 3)}-${normalized.slice(3)}`;
  }
  return normalized;
};

/**
 * Compara duas strings de forma case-insensitive
 */
export const caseInsensitiveMatch = (str1: string, str2: string): boolean => {
  return str1.toUpperCase() === str2.toUpperCase();
};

/**
 * Verifica se uma string contém outra (case-insensitive)
 */
export const caseInsensitiveIncludes = (haystack: string, needle: string): boolean => {
  return haystack.toUpperCase().includes(needle.toUpperCase());
};



================================================================================
FILE PATH: server\.dockerignore
================================================================================
node_modules
npm-debug.log
dist
build
.git
.gitignore
README.md


================================================================================
FILE PATH: server\Dockerfile
================================================================================
# Usa uma imagem base Node.js (Debian-based para melhor compatibilidade c/ Prisma)
FROM node:20

# Define o diretório de trabalho dentro do contêiner
WORKDIR /app/server

# Copia os arquivos de configuração de dependências
COPY package*.json ./

# Instala as dependências (incluindo o Prisma, express, etc.)
RUN npm install

# Copia o restante do código para o diretório de trabalho
COPY . .

# Comando de inicialização não é o principal, pois o Docker Compose o sobrescreve
CMD [ "npm", "run", "dev" ]


================================================================================
FILE PATH: server\package.json
================================================================================
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "type": "module",
  "main": "index.js",
  "scripts": {
    "dev": "tsx watch src/server.ts",
    "migrate:host": "set DATABASE_URL=postgresql://user:password@localhost:5434/automotivo_db&& npx prisma migrate dev",
    "db:seed": "tsx prisma/seed.ts",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@prisma/client": "5.22.0",
    "@types/cors": "^2.8.19",
    "@types/express": "^5.0.6",
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "express": "^5.2.1",
    "ts-node": "^10.9.2",
    "typescript": "^5.9.3"
  },
  "devDependencies": {
    "prisma": "5.22.0",
    "tsx": "^4.21.0"
  }
}



================================================================================
FILE PATH: server\tsconfig.json
================================================================================
{
  // Visit https://aka.ms/tsconfig to read more about this file
  "compilerOptions": {
    // File Layout
    // "rootDir": "./src",
    // "outDir": "./dist",

    // Environment Settings
    // See also https://aka.ms/tsconfig/module
    "module": "nodenext",
    "target": "esnext",
    "types": [],
    // For nodejs:
    // "lib": ["esnext"],
    // "types": ["node"],
    // and npm install -D @types/node

    // Other Outputs
    "sourceMap": true,
    "declaration": true,
    "declarationMap": true,

    // Stricter Typechecking Options
    "noUncheckedIndexedAccess": true,
    "exactOptionalPropertyTypes": true,

    // Style Options
    // "noImplicitReturns": true,
    // "noImplicitOverride": true,
    // "noUnusedLocals": true,
    // "noUnusedParameters": true,
    // "noFallthroughCasesInSwitch": true,
    // "noPropertyAccessFromIndexSignature": true,

    // Recommended Options
    "strict": true,
    "jsx": "react-jsx",
    //"verbatimModuleSyntax": true,
    "isolatedModules": true,
    "noUncheckedSideEffectImports": true,
    "moduleDetection": "force",
    "skipLibCheck": true,
  }
}



================================================================================
FILE PATH: server\prisma\schema.prisma
================================================================================
// server/prisma/schema.prisma

// 1. Configuração do Client: Deve ser 'prisma-client-js'
generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

// 2. Configuração do Banco de Dados
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- TABELAS DE GENERALIZAÇÃO ---

// Tabela 1: Pessoa (Base)
model Pessoa {
  id_pessoa       Int      @id @default(autoincrement())
  nome            String   @db.VarChar(100)
  genero          String?  @db.VarChar(20)
  dt_nascimento   DateTime? @db.Date // DATE
  obs             String?  @db.VarChar(500)
  dt_cadastro     DateTime @default(now()) @db.Timestamp()

  // Relacionamentos 1:1 (Para Especialização)
  pessoa_fisica   PessoaFisica?
  pessoa_juridica PessoaJuridica?

  @@map("pessoa")
}

// Tabela 2: Pessoa Física (Especialização)
model PessoaFisica {
  id_pessoa_fisica Int      @id @default(autoincrement())
  id_pessoa        Int      @unique
  cpf              String?  @db.VarChar(11)
  dt_cadastro      DateTime @default(now()) @db.Timestamp()

  // Relacionamento com Pessoa
  pessoa           Pessoa   @relation(fields: [id_pessoa], references: [id_pessoa])

  // Relacionamentos para outras tabelas
  funcionario      Funcionario?
  clientes         Cliente[] // Mapeamento 1:N
  
  @@map("pessoa_fisica")
}

// Tabela 3: Pessoa Jurídica (Especialização)
model PessoaJuridica {
  id_pessoa_juridica Int      @id @default(autoincrement())
  id_pessoa          Int      @unique
  razao_social       String   @db.VarChar(100)
  nome_fantasia      String?  @db.VarChar(100)
  cnpj               String?  @unique @db.VarChar(14)
  inscricao_estadual String?  @db.VarChar(50)
  dt_cadastro        DateTime @default(now()) @db.Timestamp()

  // Relacionamento com Pessoa
  pessoa             Pessoa   @relation(fields: [id_pessoa], references: [id_pessoa])

  // Relacionamentos para outras tabelas
  clientes           Cliente[]

  @@map("pessoa_juridica")
}

// Tabela 4: Tipo (Função da Pessoa/Empresa)
model Tipo {
  id_tipo     Int      @id @default(autoincrement())
  funcao      String?  @db.VarChar(50)
  dt_cadastro DateTime @default(now()) @db.Timestamp()
  
  // Relacionamento com Cliente
  clientes    Cliente[]
  
  @@map("tipo")
}

// --- TABELAS PRINCIPAIS ---

// Tabela 5: Cliente (Endereço e Contato)
model Cliente {
  id_cliente          Int       @id @default(autoincrement())
  
  // FKs OPCIONAIS (NULLABLE)
  id_pessoa_fisica    Int?      
  id_pessoa_juridica  Int?      
  tipo_pessoa         Int       // FK
  
  telefone_1          String    @db.VarChar(15)
  telefone_2          String?   @db.VarChar(15)
  telefone_3          String?   @db.VarChar(15)
  email               String?   @db.VarChar(100)
  logradouro          String?   @db.VarChar(150)
  nr_logradouro       String?   @db.VarChar(10)
  compl_logradouro    String?   @db.VarChar(50)
  bairro              String?   @db.VarChar(100)
  cidade              String?   @db.VarChar(100)
  estado              String?   @db.Char(2)
  dt_cadastro         DateTime  @default(now()) @db.Timestamp()
  
  // Relacionamentos (Chaves Estrangeiras)
  pessoa_fisica       PessoaFisica?  @relation(fields: [id_pessoa_fisica], references: [id_pessoa_fisica])
  pessoa_juridica     PessoaJuridica? @relation(fields: [id_pessoa_juridica], references: [id_pessoa_juridica])
  tipo                Tipo          @relation(fields: [tipo_pessoa], references: [id_tipo])
  
  // Relacionamentos de Volta
  veiculos            Veiculo[]
  ordens_de_servico   OrdemDeServico[]

  // Índices para as FKs para otimização
  @@index([id_pessoa_fisica])
  @@index([id_pessoa_juridica])
  @@index([tipo_pessoa])
  
  @@map("cliente")
}

// Tabela 6: Funcionário
model Funcionario {
  id_funcionario      Int      @id @default(autoincrement())
  id_pessoa_fisica    Int      @unique 
  ativo               String   @db.Char(1) // Seu SQL usa CHAR(1) para boolean/status
  cargo               String   @db.VarChar(50)
  salario             Decimal?   @db.Decimal(10, 2)
  comissao            Int?     
  dt_admissao         DateTime @db.Timestamp()
  dt_recisao          DateTime? @db.Timestamp()
  motivo_saida        String?  @db.VarChar(200)
  obs                 String?  @db.VarChar(500)
  dt_cadastro         DateTime @default(now()) @db.Timestamp()
  
  // Relacionamento 1:1 com PessoaFisica
  pessoa_fisica       PessoaFisica @relation(fields: [id_pessoa_fisica], references: [id_pessoa_fisica])
  
  // Relacionamento de Volta
  ordens_de_servico   OrdemDeServico[]

  @@map("funcionario")
}

// Tabela 7: Peças Estoque
model PecasEstoque {
    id_pecas_estoque    Int      @id @default(autoincrement())
    fabricante          String?  @db.VarChar(50)
    nome                String   @db.VarChar(255)
    descricao           String   @db.VarChar(255)
    valor_custo         Decimal    @db.Decimal(10, 2)
    valor_venda         Decimal    @db.Decimal(10, 2)
    estoque_atual       Int      
    unidade_medida      String?  @db.VarChar(20)
    dt_ultima_compra    DateTime? @db.Timestamp()
    
    // Novo Campo
    custo_unitario_padrao Decimal @default(0) @db.Decimal(10, 2)
    
    dt_cadastro         DateTime @default(now()) @db.Timestamp()
    
    // Relacionamento de Volta (M:N com OS)
    itens_os            ItensOs[]

    @@map("pecas_estoque")
}

// Tabela 8: Veículo
model Veiculo {
    id_veiculo          Int      @id @default(autoincrement())
    id_cliente          Int      
    placa               String   @unique @db.VarChar(8)
    chassi              String?  @db.VarChar(20)
    marca               String   @db.VarChar(50)
    modelo              String   @db.VarChar(50)
    versao              String?  @db.VarChar(50)
    ano_modelo          String   @db.VarChar(10)
    cor                 String   @db.VarChar(30)
    combustivel         String   @db.VarChar(20)
    obs                 String?  @db.VarChar(500)
    dt_cadastro         DateTime @default(now()) @db.Timestamp()
    
    // Relacionamento 1:N com Cliente
    cliente             Cliente  @relation(fields: [id_cliente], references: [id_cliente])
    
    // Relacionamento de Volta
    ordens_de_servico   OrdemDeServico[]

    @@map("veiculo")
}

// Tabela 9: Ordem de Serviço (OS)
model OrdemDeServico {
    id_os               Int      @id @default(autoincrement())
    id_cliente          Int
    id_veiculo          Int
    id_funcionario      Int
    dt_abertura         DateTime @default(now()) @db.Timestamp()
    dt_entrega          DateTime? @db.Timestamp()
    km_entrada          Int      
    status              String   @db.VarChar(50)
    defeito_relatado    String?  @db.VarChar(500)
    diagnostico         String?  @db.VarChar(500)
    
    // Campos Existentes de Valores
    valor_servico       Decimal?   @db.Decimal(10, 2)
    valor_pecas         Decimal?   @db.Decimal(10, 2)
    valor_final         Decimal?   @db.Decimal(12, 2)
    
    // Novos Campos Solicitados
    valor_total_cliente Decimal?   @db.Decimal(10, 2) // Receita do Cliente
    valor_mao_de_obra   Decimal?   @db.Decimal(10, 2) // Valor M.O. padrão
    
    modo_pagamento      String?  @db.VarChar(50)
    cod_pagamento       String?  @db.VarChar(80)
    parcelas            Int      
    obs                 String?  @db.VarChar(500)
    obs_final           String?  @db.VarChar(500)
    dt_cadastro         DateTime @default(now()) @db.Timestamp()
    
    // Relacionamentos (Chaves Estrangeiras)
    cliente             Cliente    @relation(fields: [id_cliente], references: [id_cliente])
    veiculo             Veiculo    @relation(fields: [id_veiculo], references: [id_veiculo])
    funcionario         Funcionario @relation(fields: [id_funcionario], references: [id_funcionario])
    
    // Relacionamentos de Volta
    itens_os            ItensOs[]
    fechamento_financeiro FechamentoFinanceiro?

    @@map("ordem_de_servico")
}

// Tabela 10: Tabela Associativa M:N (ITENS_OS)
model ItensOs {
    id_iten             Int      @id @default(autoincrement())
    id_os               Int      
    id_pecas_estoque    Int?      
    descricao           String   @db.VarChar(500) 
    
    // Campos Renomeados/Garantidos
    quantidade          Int      
    valor_venda         Decimal    @db.Decimal(10, 2)
    valor_total         Decimal    @db.Decimal(12, 2)
    
    dt_cadastro         DateTime @default(now()) @db.Timestamp()
    
    // Relacionamentos (Chaves Estrangeiras)
    ordem_de_servico    OrdemDeServico @relation(fields: [id_os], references: [id_os])
    pecas_estoque       PecasEstoque?   @relation(fields: [id_pecas_estoque], references: [id_pecas_estoque])
    
    // Relacionamento com PagamentoPeca
    pagamentos_peca     PagamentoPeca[]

    @@map("itens_os")
}

// Nova Entidade: Fornecedor
model Fornecedor {
    id_fornecedor Int      @id @default(autoincrement())
    nome          String   @db.VarChar(100)
    documento     String?  @db.VarChar(20)
    contato       String?  @db.VarChar(100)
    dt_cadastro   DateTime @default(now()) @db.Timestamp()
    
    pagamentos_peca PagamentoPeca[]

    @@map("fornecedor")
}

// Nova Entidade: PagamentoPeca (Rastreio de Custo Real)
model PagamentoPeca {
    id_pagamento_peca     Int      @id @default(autoincrement())
    id_item_os            Int
    id_fornecedor         Int
    
    custo_real            Decimal  @db.Decimal(10, 2)
    data_compra           DateTime @db.Timestamp()
    data_pagamento_fornecedor DateTime? @db.Timestamp()
    pago_ao_fornecedor    Boolean  @default(false)
    
    item_os               ItensOs  @relation(fields: [id_item_os], references: [id_iten])
    fornecedor            Fornecedor @relation(fields: [id_fornecedor], references: [id_fornecedor])

    @@map("pagamento_peca")
}

// Nova Entidade: FechamentoFinanceiro (Substitui Finalizacao)
model FechamentoFinanceiro {
    id_fechamento_financeiro Int      @id @default(autoincrement())
    id_os                    Int      @unique
    custo_total_pecas_real   Decimal  @db.Decimal(10, 2)
    data_fechamento_financeiro DateTime @default(now()) @db.Timestamp()
    
    ordem_de_servico         OrdemDeServico @relation(fields: [id_os], references: [id_os])

    @@map("fechamento_financeiro")
}


================================================================================
FILE PATH: server\prisma\seed.ts
================================================================================
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('🌱 Starting seed...');

  // 1. Seed Tipos
  const tipos = [
    { id_tipo: 1, funcao: 'Cliente' },
    { id_tipo: 2, funcao: 'Funcionário' },
    { id_tipo: 3, funcao: 'Fornecedor' },
  ];

  for (const t of tipos) {
    const tipo = await prisma.tipo.upsert({
      where: { id_tipo: t.id_tipo },
      update: {},
      create: t,
    });
    console.log(`Created Tipo: ${tipo.funcao} (ID: ${tipo.id_tipo})`);
  }

  // 2. Seed a default Employee (Funcionario)
  const existingFunc = await prisma.funcionario.findFirst();
  if (!existingFunc) {
      console.log('👷 Creating default employee...');
      const pessoa = await prisma.pessoa.create({
          data: {
              nome: 'Mecânico Padrão',
              genero: 'Masculino'
          }
      });

      const pessoaFisica = await prisma.pessoaFisica.create({
          data: {
              id_pessoa: pessoa.id_pessoa,
              cpf: '00000000000'
          }
      });

      await prisma.funcionario.create({
          data: {
              id_pessoa_fisica: pessoaFisica.id_pessoa_fisica,
              ativo: 'S',
              cargo: 'Mecânico',
              dt_admissao: new Date()
          }
      });
      console.log('✅ Default employee created.');
  }

  console.log('✅ Seed finished.');
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });



================================================================================
FILE PATH: server\prisma\migrations\migration_lock.toml
================================================================================
# Please do not edit this file manually
# It should be added in your version-control system (i.e. Git)
provider = "postgresql"


================================================================================
FILE PATH: server\prisma\migrations\20251208001043_init_full_schema\migration.sql
================================================================================
-- CreateTable
CREATE TABLE "pessoa" (
    "id_pessoa" SERIAL NOT NULL,
    "nome" VARCHAR(100) NOT NULL,
    "genero" VARCHAR(20),
    "dt_nascimento" DATE,
    "obs" VARCHAR(500),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "pessoa_pkey" PRIMARY KEY ("id_pessoa")
);

-- CreateTable
CREATE TABLE "pessoa_fisica" (
    "id_pessoa_fisica" SERIAL NOT NULL,
    "id_pessoa" INTEGER NOT NULL,
    "cpf" VARCHAR(11),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "pessoa_fisica_pkey" PRIMARY KEY ("id_pessoa_fisica")
);

-- CreateTable
CREATE TABLE "pessoa_juridica" (
    "id_pessoa_juridica" SERIAL NOT NULL,
    "id_pessoa" INTEGER NOT NULL,
    "razao_social" VARCHAR(100) NOT NULL,
    "nome_fantasia" VARCHAR(100),
    "cnpj" VARCHAR(14),
    "inscricao_estadual" VARCHAR(50),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "pessoa_juridica_pkey" PRIMARY KEY ("id_pessoa_juridica")
);

-- CreateTable
CREATE TABLE "tipo" (
    "id_tipo" SERIAL NOT NULL,
    "funcao" VARCHAR(50),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "tipo_pkey" PRIMARY KEY ("id_tipo")
);

-- CreateTable
CREATE TABLE "cliente" (
    "id_cliente" SERIAL NOT NULL,
    "id_pessoa_fisica" INTEGER,
    "id_pessoa_juridica" INTEGER,
    "tipo_pessoa" INTEGER NOT NULL,
    "telefone_1" VARCHAR(15) NOT NULL,
    "telefone_2" VARCHAR(15),
    "telefone_3" VARCHAR(15),
    "email" VARCHAR(100),
    "logradouro" VARCHAR(150) NOT NULL,
    "nr_logradouro" VARCHAR(10) NOT NULL,
    "compl_logradouro" VARCHAR(50),
    "bairro" VARCHAR(100) NOT NULL,
    "cidade" VARCHAR(100) NOT NULL,
    "estado" CHAR(2) NOT NULL,
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "cliente_pkey" PRIMARY KEY ("id_cliente")
);

-- CreateTable
CREATE TABLE "funcionario" (
    "id_funcionario" SERIAL NOT NULL,
    "id_pessoa_fisica" INTEGER NOT NULL,
    "ativo" CHAR(1) NOT NULL,
    "cargo" VARCHAR(50) NOT NULL,
    "salario" DECIMAL(10,2),
    "comissao" INTEGER,
    "dt_admissao" TIMESTAMP NOT NULL,
    "dt_recisao" TIMESTAMP,
    "motivo_saida" VARCHAR(200),
    "obs" VARCHAR(500),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "funcionario_pkey" PRIMARY KEY ("id_funcionario")
);

-- CreateTable
CREATE TABLE "pecas_estoque" (
    "id_pecas_estoque" SERIAL NOT NULL,
    "fabricante" VARCHAR(50),
    "nome" VARCHAR(255) NOT NULL,
    "descricao" VARCHAR(255) NOT NULL,
    "valor_custo" DECIMAL(10,2) NOT NULL,
    "valor_venda" DECIMAL(10,2) NOT NULL,
    "estoque_atual" INTEGER NOT NULL,
    "unidade_medida" VARCHAR(20),
    "dt_ultima_compra" TIMESTAMP,
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "pecas_estoque_pkey" PRIMARY KEY ("id_pecas_estoque")
);

-- CreateTable
CREATE TABLE "veiculo" (
    "id_veiculo" SERIAL NOT NULL,
    "id_cliente" INTEGER NOT NULL,
    "placa" VARCHAR(8) NOT NULL,
    "chassi" VARCHAR(20),
    "marca" VARCHAR(50) NOT NULL,
    "modelo" VARCHAR(50) NOT NULL,
    "versao" VARCHAR(50),
    "ano_modelo" VARCHAR(10) NOT NULL,
    "cor" VARCHAR(30) NOT NULL,
    "combustivel" VARCHAR(20) NOT NULL,
    "obs" VARCHAR(500),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "veiculo_pkey" PRIMARY KEY ("id_veiculo")
);

-- CreateTable
CREATE TABLE "ordem_de_servico" (
    "id_os" SERIAL NOT NULL,
    "id_cliente" INTEGER NOT NULL,
    "id_veiculo" INTEGER NOT NULL,
    "id_funcionario" INTEGER NOT NULL,
    "dt_abertura" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "dt_entrega" TIMESTAMP,
    "km_entrada" INTEGER NOT NULL,
    "status" VARCHAR(20) NOT NULL,
    "defeito_relatado" VARCHAR(500),
    "diagnostico" VARCHAR(500),
    "valor_servico" DECIMAL(10,2),
    "valor_pecas" DECIMAL(10,2),
    "valor_final" DECIMAL(12,2),
    "modo_pagamento" VARCHAR(50),
    "cod_pagamento" VARCHAR(80),
    "parcelas" INTEGER NOT NULL,
    "obs" VARCHAR(500),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "ordem_de_servico_pkey" PRIMARY KEY ("id_os")
);

-- CreateTable
CREATE TABLE "itens_os" (
    "id_iten" SERIAL NOT NULL,
    "id_os" INTEGER NOT NULL,
    "id_pecas_estoque" INTEGER,
    "descricao" VARCHAR(500) NOT NULL,
    "qtd" INTEGER NOT NULL,
    "valor_unt" DECIMAL(10,2) NOT NULL,
    "valor_total" DECIMAL(12,2) NOT NULL,
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "itens_os_pkey" PRIMARY KEY ("id_iten")
);

-- CreateTable
CREATE TABLE "finalizacao" (
    "id_finalizacao" SERIAL NOT NULL,
    "id_os" INTEGER NOT NULL,
    "valor_peca_entrada" DECIMAL(10,2),
    "valor_peca_saida" DECIMAL(10,2),
    "valor_pago_funcionario" DECIMAL(10,2),
    "obs" VARCHAR(500),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "finalizacao_pkey" PRIMARY KEY ("id_finalizacao")
);

-- CreateIndex
CREATE UNIQUE INDEX "pessoa_fisica_id_pessoa_key" ON "pessoa_fisica"("id_pessoa");

-- CreateIndex
CREATE UNIQUE INDEX "pessoa_fisica_cpf_key" ON "pessoa_fisica"("cpf");

-- CreateIndex
CREATE UNIQUE INDEX "pessoa_juridica_id_pessoa_key" ON "pessoa_juridica"("id_pessoa");

-- CreateIndex
CREATE UNIQUE INDEX "pessoa_juridica_cnpj_key" ON "pessoa_juridica"("cnpj");

-- CreateIndex
CREATE INDEX "cliente_id_pessoa_fisica_idx" ON "cliente"("id_pessoa_fisica");

-- CreateIndex
CREATE INDEX "cliente_id_pessoa_juridica_idx" ON "cliente"("id_pessoa_juridica");

-- CreateIndex
CREATE INDEX "cliente_tipo_pessoa_idx" ON "cliente"("tipo_pessoa");

-- CreateIndex
CREATE UNIQUE INDEX "funcionario_id_pessoa_fisica_key" ON "funcionario"("id_pessoa_fisica");

-- CreateIndex
CREATE UNIQUE INDEX "veiculo_placa_key" ON "veiculo"("placa");

-- CreateIndex
CREATE UNIQUE INDEX "finalizacao_id_os_key" ON "finalizacao"("id_os");

-- AddForeignKey
ALTER TABLE "pessoa_fisica" ADD CONSTRAINT "pessoa_fisica_id_pessoa_fkey" FOREIGN KEY ("id_pessoa") REFERENCES "pessoa"("id_pessoa") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "pessoa_juridica" ADD CONSTRAINT "pessoa_juridica_id_pessoa_fkey" FOREIGN KEY ("id_pessoa") REFERENCES "pessoa"("id_pessoa") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "cliente" ADD CONSTRAINT "cliente_id_pessoa_fisica_fkey" FOREIGN KEY ("id_pessoa_fisica") REFERENCES "pessoa_fisica"("id_pessoa_fisica") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "cliente" ADD CONSTRAINT "cliente_id_pessoa_juridica_fkey" FOREIGN KEY ("id_pessoa_juridica") REFERENCES "pessoa_juridica"("id_pessoa_juridica") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "cliente" ADD CONSTRAINT "cliente_tipo_pessoa_fkey" FOREIGN KEY ("tipo_pessoa") REFERENCES "tipo"("id_tipo") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "funcionario" ADD CONSTRAINT "funcionario_id_pessoa_fisica_fkey" FOREIGN KEY ("id_pessoa_fisica") REFERENCES "pessoa_fisica"("id_pessoa_fisica") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "veiculo" ADD CONSTRAINT "veiculo_id_cliente_fkey" FOREIGN KEY ("id_cliente") REFERENCES "cliente"("id_cliente") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "ordem_de_servico" ADD CONSTRAINT "ordem_de_servico_id_cliente_fkey" FOREIGN KEY ("id_cliente") REFERENCES "cliente"("id_cliente") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "ordem_de_servico" ADD CONSTRAINT "ordem_de_servico_id_veiculo_fkey" FOREIGN KEY ("id_veiculo") REFERENCES "veiculo"("id_veiculo") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "ordem_de_servico" ADD CONSTRAINT "ordem_de_servico_id_funcionario_fkey" FOREIGN KEY ("id_funcionario") REFERENCES "funcionario"("id_funcionario") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "itens_os" ADD CONSTRAINT "itens_os_id_os_fkey" FOREIGN KEY ("id_os") REFERENCES "ordem_de_servico"("id_os") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "itens_os" ADD CONSTRAINT "itens_os_id_pecas_estoque_fkey" FOREIGN KEY ("id_pecas_estoque") REFERENCES "pecas_estoque"("id_pecas_estoque") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "finalizacao" ADD CONSTRAINT "finalizacao_id_os_fkey" FOREIGN KEY ("id_os") REFERENCES "ordem_de_servico"("id_os") ON DELETE RESTRICT ON UPDATE CASCADE;



================================================================================
FILE PATH: server\prisma\migrations\20251216160147_init_v3\migration.sql
================================================================================
/*
  Warnings:

  - You are about to drop the column `qtd` on the `itens_os` table. All the data in the column will be lost.
  - You are about to drop the column `valor_unt` on the `itens_os` table. All the data in the column will be lost.
  - You are about to drop the `finalizacao` table. If the table is not empty, all the data it contains will be lost.
  - Added the required column `quantidade` to the `itens_os` table without a default value. This is not possible if the table is not empty.
  - Added the required column `valor_venda` to the `itens_os` table without a default value. This is not possible if the table is not empty.

*/
-- DropForeignKey
ALTER TABLE "finalizacao" DROP CONSTRAINT "finalizacao_id_os_fkey";

-- AlterTable
ALTER TABLE "itens_os" DROP COLUMN "qtd",
DROP COLUMN "valor_unt",
ADD COLUMN     "quantidade" INTEGER NOT NULL,
ADD COLUMN     "valor_venda" DECIMAL(10,2) NOT NULL;

-- AlterTable
ALTER TABLE "ordem_de_servico" ADD COLUMN     "valor_mao_de_obra" DECIMAL(10,2),
ADD COLUMN     "valor_total_cliente" DECIMAL(10,2);

-- AlterTable
ALTER TABLE "pecas_estoque" ADD COLUMN     "custo_unitario_padrao" DECIMAL(10,2) NOT NULL DEFAULT 0;

-- DropTable
DROP TABLE "finalizacao";

-- CreateTable
CREATE TABLE "fornecedor" (
    "id_fornecedor" SERIAL NOT NULL,
    "nome" VARCHAR(100) NOT NULL,
    "documento" VARCHAR(20),
    "contato" VARCHAR(100),
    "dt_cadastro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "fornecedor_pkey" PRIMARY KEY ("id_fornecedor")
);

-- CreateTable
CREATE TABLE "pagamento_peca" (
    "id_pagamento_peca" SERIAL NOT NULL,
    "id_item_os" INTEGER NOT NULL,
    "id_fornecedor" INTEGER NOT NULL,
    "custo_real" DECIMAL(10,2) NOT NULL,
    "data_compra" TIMESTAMP NOT NULL,
    "data_pagamento_fornecedor" TIMESTAMP,
    "pago_ao_fornecedor" BOOLEAN NOT NULL DEFAULT false,

    CONSTRAINT "pagamento_peca_pkey" PRIMARY KEY ("id_pagamento_peca")
);

-- CreateTable
CREATE TABLE "fechamento_financeiro" (
    "id_fechamento_financeiro" SERIAL NOT NULL,
    "id_os" INTEGER NOT NULL,
    "custo_total_pecas_real" DECIMAL(10,2) NOT NULL,
    "data_fechamento_financeiro" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "fechamento_financeiro_pkey" PRIMARY KEY ("id_fechamento_financeiro")
);

-- CreateIndex
CREATE UNIQUE INDEX "fechamento_financeiro_id_os_key" ON "fechamento_financeiro"("id_os");

-- AddForeignKey
ALTER TABLE "pagamento_peca" ADD CONSTRAINT "pagamento_peca_id_item_os_fkey" FOREIGN KEY ("id_item_os") REFERENCES "itens_os"("id_iten") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "pagamento_peca" ADD CONSTRAINT "pagamento_peca_id_fornecedor_fkey" FOREIGN KEY ("id_fornecedor") REFERENCES "fornecedor"("id_fornecedor") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "fechamento_financeiro" ADD CONSTRAINT "fechamento_financeiro_id_os_fkey" FOREIGN KEY ("id_os") REFERENCES "ordem_de_servico"("id_os") ON DELETE RESTRICT ON UPDATE CASCADE;



================================================================================
FILE PATH: server\prisma\migrations\20251216195722_migrate161220251657\migration.sql
================================================================================
-- DropIndex
DROP INDEX "pessoa_fisica_cpf_key";



================================================================================
FILE PATH: server\prisma\migrations\20251218194757_make_address_optional\migration.sql
================================================================================
-- AlterTable
ALTER TABLE "cliente" ALTER COLUMN "logradouro" DROP NOT NULL,
ALTER COLUMN "nr_logradouro" DROP NOT NULL,
ALTER COLUMN "bairro" DROP NOT NULL,
ALTER COLUMN "cidade" DROP NOT NULL,
ALTER COLUMN "estado" DROP NOT NULL;



================================================================================
FILE PATH: server\prisma\migrations\20251218212849_migration_181220251828\migration.sql
================================================================================
-- AlterTable
ALTER TABLE "ordem_de_servico" ADD COLUMN     "obs_final" VARCHAR(500);



================================================================================
FILE PATH: server\prisma\migrations\20251218225607_181220251956\migration.sql
================================================================================
-- AlterTable
ALTER TABLE "ordem_de_servico" ALTER COLUMN "status" SET DATA TYPE VARCHAR(50);



================================================================================
FILE PATH: server\src\prisma.ts
================================================================================
import { PrismaClient } from '@prisma/client';
import dotenv from 'dotenv';

dotenv.config();

export const prisma = new PrismaClient();




================================================================================
FILE PATH: server\src\server.ts
================================================================================
import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';

dotenv.config();

const app = express();

app.use(cors());
app.use(express.json());

const PORT = process.env.PORT || 3000;

app.get('/', (req, res) => {
  res.send('Centro Automotivo API is running');
});

import { pessoaRoutes } from './routes/pessoa.routes.js';
import { tipoRoutes } from './routes/tipo.routes.js';
import { pessoaFisicaRoutes } from './routes/pessoaFisica.routes.js';
import { pessoaJuridicaRoutes } from './routes/pessoaJuridica.routes.js';
import { clienteRoutes } from './routes/cliente.routes.js';
import { funcionarioRoutes } from './routes/funcionario.routes.js';
import { pecasEstoqueRoutes } from './routes/pecasEstoque.routes.js';
import { veiculoRoutes } from './routes/veiculo.routes.js';
import { ordemDeServicoRoutes } from './routes/ordemDeServico.routes.js';
import { itensOsRoutes } from './routes/itensOs.routes.js';
// Novas Rotas
import { fechamentoFinanceiroRoutes } from './routes/fechamentoFinanceiro.routes.js';
import { fornecedorRoutes } from './routes/fornecedor.routes.js';
import { pagamentoPecaRoutes } from './routes/pagamentoPeca.routes.js';

app.use('/api/pessoa', pessoaRoutes);
app.use('/api/tipo', tipoRoutes);
app.use('/api/pessoa-fisica', pessoaFisicaRoutes);
app.use('/api/pessoa-juridica', pessoaJuridicaRoutes);
app.use('/api/cliente', clienteRoutes);
app.use('/api/funcionario', funcionarioRoutes);
app.use('/api/pecas-estoque', pecasEstoqueRoutes);
app.use('/api/veiculo', veiculoRoutes);
app.use('/api/ordem-de-servico', ordemDeServicoRoutes);
app.use('/api/itens-os', itensOsRoutes);

// Uso das Novas Rotas
app.use('/api/fechamento-financeiro', fechamentoFinanceiroRoutes);
app.use('/api/fornecedor', fornecedorRoutes);
app.use('/api/pagamento-peca', pagamentoPecaRoutes);

app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});



================================================================================
FILE PATH: server\src\controllers\cliente.controller.ts
================================================================================
import { Request, Response } from 'express';
import { ClienteRepository } from '../repositories/cliente.repository.js';

const repository = new ClienteRepository();

export class ClienteController {
  async create(req: Request, res: Response) {
    console.log('🔵 ClienteController.create - Received request');
    console.log('📦 Request body:', JSON.stringify(req.body, null, 2));
    
    try {
      const cliente = await repository.create(req.body);
      console.log('✅ ClienteController.create - Success:', cliente.id_cliente);
      res.status(201).json(cliente);
    } catch (error: any) {
      console.error('❌ ClienteController.create - Error:', error);
      console.error('❌ Error message:', error.message);
      console.error('❌ Error stack:', error.stack);
      res.status(400).json({ error: 'Failed to create Cliente', details: error.message });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const clientes = await repository.findAll();
      res.json(clientes);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Clientes' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const cliente = await repository.findById(id);
      if (!cliente) {
        return res.status(404).json({ error: 'Cliente not found' });
      }
      res.json(cliente);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Cliente' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const cliente = await repository.update(id, req.body);
      res.json(cliente);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Cliente' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Cliente' });
    }
  }

  async searchByName(req: Request, res: Response) {
    try {
      const { name } = req.query;
      if (!name || typeof name !== 'string') {
        return res.status(400).json({ error: 'Name query parameter is required' });
      }
      const clientes = await repository.searchByName(name);
      res.json(clientes);
    } catch (error) {
      res.status(500).json({ error: 'Failed to search Clientes' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\fechamentoFinanceiro.controller.ts
================================================================================
import { Request, Response } from 'express';
import { FechamentoFinanceiroRepository } from '../repositories/fechamentoFinanceiro.repository.js';

const repository = new FechamentoFinanceiroRepository();

export class FechamentoFinanceiroController {
  async create(req: Request, res: Response) {
    try {
      const fechamento = await repository.create(req.body);
      res.status(201).json(fechamento);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Fechamento Financeiro', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const fechamentos = await repository.findAll();
      res.json(fechamentos);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Fechamentos Financeiros' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const fechamento = await repository.findById(id);
      if (!fechamento) {
        return res.status(404).json({ error: 'Fechamento Financeiro not found' });
      }
      res.json(fechamento);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Fechamento Financeiro' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const fechamento = await repository.update(id, req.body);
      res.json(fechamento);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Fechamento Financeiro' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Fechamento Financeiro' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\fornecedor.controller.ts
================================================================================
import { Request, Response } from 'express';
import { FornecedorRepository } from '../repositories/fornecedor.repository.js';

const repository = new FornecedorRepository();

export class FornecedorController {
  async create(req: Request, res: Response) {
    try {
      const fornecedor = await repository.create(req.body);
      res.status(201).json(fornecedor);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Fornecedor', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const fornecedores = await repository.findAll();
      res.json(fornecedores);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Fornecedores' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const fornecedor = await repository.findById(id);
      if (!fornecedor) {
        return res.status(404).json({ error: 'Fornecedor not found' });
      }
      res.json(fornecedor);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Fornecedor' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const fornecedor = await repository.update(id, req.body);
      res.json(fornecedor);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Fornecedor' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Fornecedor' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\funcionario.controller.ts
================================================================================
import { Request, Response } from 'express';
import { FuncionarioRepository } from '../repositories/funcionario.repository.js';

const repository = new FuncionarioRepository();

export class FuncionarioController {
  async create(req: Request, res: Response) {
    try {
      const funcionario = await repository.create(req.body);
      res.status(201).json(funcionario);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Funcionario', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const funcionarios = await repository.findAll();
      res.json(funcionarios);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Funcionarios' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const funcionario = await repository.findById(id);
      if (!funcionario) {
        return res.status(404).json({ error: 'Funcionario not found' });
      }
      res.json(funcionario);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Funcionario' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const funcionario = await repository.update(id, req.body);
      res.json(funcionario);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Funcionario' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Funcionario' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\itensOs.controller.ts
================================================================================
import { Request, Response } from 'express';
import { ItensOsRepository } from '../repositories/itensOs.repository.js';

const repository = new ItensOsRepository();

export class ItensOsController {
  async create(req: Request, res: Response) {
    try {
      const item = await repository.create(req.body);
      res.status(201).json(item);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Item OS', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const itens = await repository.findAll();
      res.json(itens);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Itens OS' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const item = await repository.findById(id);
      if (!item) {
        return res.status(404).json({ error: 'Item OS not found' });
      }
      res.json(item);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Item OS' });
    }
  }

  async findByOsId(req: Request, res: Response) {
    try {
      const idOs = Number(req.params.idOs);
      const itens = await repository.findByOsId(idOs);
      res.json(itens);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Itens for OS' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const item = await repository.update(id, req.body);
      res.json(item);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Item OS' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Item OS' });
    }
  }

  async search(req: Request, res: Response) {
    try {
      const query = req.query.q as string;
      if (!query) return res.json([]);
      const itens = await repository.search(query);
      res.json(itens);
    } catch (error) {
      res.status(500).json({ error: 'Failed to search Item OS descriptions' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\ordemDeServico.controller.ts
================================================================================
import { Request, Response } from 'express';
import { OrdemDeServicoRepository } from '../repositories/ordemDeServico.repository.js';

const repository = new OrdemDeServicoRepository();

export class OrdemDeServicoController {
  async create(req: Request, res: Response) {
    try {
      const os = await repository.create(req.body);
      res.status(201).json(os);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create OS', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const oss = await repository.findAll();
      res.json(oss);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch OSs' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const os = await repository.findById(id);
      if (!os) {
        return res.status(404).json({ error: 'OS not found' });
      }
      res.json(os);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch OS' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const os = await repository.update(id, req.body);
      res.json(os);
    } catch (error) {
      console.error('Update OS Error:', error);
      res.status(400).json({ error: 'Failed to update OS', details: error instanceof Error ? error.message : error });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete OS' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\pagamentoPeca.controller.ts
================================================================================
import { Request, Response } from 'express';
import { PagamentoPecaRepository } from '../repositories/pagamentoPeca.repository.js';

const repository = new PagamentoPecaRepository();

export class PagamentoPecaController {
  async create(req: Request, res: Response) {
    try {
      const pagamento = await repository.create(req.body);
      res.status(201).json(pagamento);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Pagamento Peca', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const pagamentos = await repository.findAll();
      res.json(pagamentos);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Pagamentos Peca' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pagamento = await repository.findById(id);
      if (!pagamento) {
        return res.status(404).json({ error: 'Pagamento Peca not found' });
      }
      res.json(pagamento);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Pagamento Peca' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pagamento = await repository.update(id, req.body);
      res.json(pagamento);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Pagamento Peca' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Pagamento Peca' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\pecasEstoque.controller.ts
================================================================================
import { Request, Response } from 'express';
import { PecasEstoqueRepository } from '../repositories/pecasEstoque.repository.js';

const repository = new PecasEstoqueRepository();

export class PecasEstoqueController {
  async create(req: Request, res: Response) {
    try {
      const peca = await repository.create(req.body);
      res.status(201).json(peca);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Peca', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const pecas = await repository.findAll();
      res.json(pecas);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Pecas' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const peca = await repository.findById(id);
      if (!peca) {
        return res.status(404).json({ error: 'Peca not found' });
      }
      res.json(peca);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Peca' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const peca = await repository.update(id, req.body);
      res.json(peca);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Peca' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Peca' });
    }
  }

  async search(req: Request, res: Response) {
    try {
      const query = req.query.q as string;
      if (!query) return res.json([]);
      const pecas = await repository.search(query);
      res.json(pecas);
    } catch (error) {
      res.status(500).json({ error: 'Failed to search Pecas' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\pessoa.controller.ts
================================================================================
import { Request, Response } from 'express';
import { PessoaRepository } from '../repositories/pessoa.repository.js';

const repository = new PessoaRepository();

export class PessoaController {
  async create(req: Request, res: Response) {
    try {
      const pessoa = await repository.create(req.body);
      res.status(201).json(pessoa);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Pessoa', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const pessoas = await repository.findAll();
      res.json(pessoas);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Pessoas' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pessoa = await repository.findById(id);
      if (!pessoa) {
        return res.status(404).json({ error: 'Pessoa not found' });
      }
      res.json(pessoa);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Pessoa' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pessoa = await repository.update(id, req.body);
      res.json(pessoa);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Pessoa' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Pessoa' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\pessoaFisica.controller.ts
================================================================================
import { Request, Response } from 'express';
import { PessoaFisicaRepository } from '../repositories/pessoaFisica.repository.js';

const repository = new PessoaFisicaRepository();

export class PessoaFisicaController {
  async create(req: Request, res: Response) {
    try {
      const pessoaFisica = await repository.create(req.body);
      res.status(201).json(pessoaFisica);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create PessoaFisica', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const pessoasFisicas = await repository.findAll();
      res.json(pessoasFisicas);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch PessoasFisicas' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pessoaFisica = await repository.findById(id);
      if (!pessoaFisica) {
        return res.status(404).json({ error: 'PessoaFisica not found' });
      }
      res.json(pessoaFisica);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch PessoaFisica' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pessoaFisica = await repository.update(id, req.body);
      res.json(pessoaFisica);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update PessoaFisica' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete PessoaFisica' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\pessoaJuridica.controller.ts
================================================================================
import { Request, Response } from 'express';
import { PessoaJuridicaRepository } from '../repositories/pessoaJuridica.repository.js';

const repository = new PessoaJuridicaRepository();

export class PessoaJuridicaController {
  async create(req: Request, res: Response) {
    try {
      const pessoaJuridica = await repository.create(req.body);
      res.status(201).json(pessoaJuridica);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create PessoaJuridica', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const pessoasJuridicas = await repository.findAll();
      res.json(pessoasJuridicas);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch PessoasJuridicas' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pessoaJuridica = await repository.findById(id);
      if (!pessoaJuridica) {
        return res.status(404).json({ error: 'PessoaJuridica not found' });
      }
      res.json(pessoaJuridica);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch PessoaJuridica' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const pessoaJuridica = await repository.update(id, req.body);
      res.json(pessoaJuridica);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update PessoaJuridica' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete PessoaJuridica' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\tipo.controller.ts
================================================================================
import { Request, Response } from 'express';
import { TipoRepository } from '../repositories/tipo.repository.js';

const repository = new TipoRepository();

export class TipoController {
  async create(req: Request, res: Response) {
    try {
      const tipo = await repository.create(req.body);
      res.status(201).json(tipo);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Tipo', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const tipos = await repository.findAll();
      res.json(tipos);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Tipos' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const tipo = await repository.findById(id);
      if (!tipo) {
        return res.status(404).json({ error: 'Tipo not found' });
      }
      res.json(tipo);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Tipo' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const tipo = await repository.update(id, req.body);
      res.json(tipo);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Tipo' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Tipo' });
    }
  }
}



================================================================================
FILE PATH: server\src\controllers\veiculo.controller.ts
================================================================================
import { Request, Response } from 'express';
import { VeiculoRepository } from '../repositories/veiculo.repository.js';

const repository = new VeiculoRepository();

export class VeiculoController {
  async create(req: Request, res: Response) {
    try {
      const veiculo = await repository.create(req.body);
      res.status(201).json(veiculo);
    } catch (error) {
      res.status(400).json({ error: 'Failed to create Veiculo', details: error });
    }
  }

  async findAll(req: Request, res: Response) {
    try {
      const veiculos = await repository.findAll();
      res.json(veiculos);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Veiculos' });
    }
  }

  async findById(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const veiculo = await repository.findById(id);
      if (!veiculo) {
        return res.status(404).json({ error: 'Veiculo not found' });
      }
      res.json(veiculo);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Veiculo' });
    }
  }

  async findByPlaca(req: Request, res: Response) {
    try {
      const placa = req.params.placa as string;
      if (!placa) {
          return res.status(400).json({ error: 'Placa required' });
      }
      const veiculo = await repository.findByPlaca(placa);
      // NOTE: We return 404 explicitly if not found to trigger the frontend "Not Found" logic
      if (!veiculo) {
        return res.status(404).json({ error: 'Veiculo not found' });
      }
      res.json(veiculo);
    } catch (error) {
      res.status(500).json({ error: 'Failed to fetch Veiculo by placa' });
    }
  }

  async search(req: Request, res: Response) {
    try {
      const query = req.query.q as string;
      if (!query) {
        return res.json([]);
      }
      const veiculos = await repository.search(query);
      res.json(veiculos);
    } catch (error) {
      res.status(500).json({ error: 'Failed to search Veiculos' });
    }
  }

  async update(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      const veiculo = await repository.update(id, req.body);
      res.json(veiculo);
    } catch (error) {
      res.status(400).json({ error: 'Failed to update Veiculo' });
    }
  }

  async delete(req: Request, res: Response) {
    try {
      const id = Number(req.params.id);
      await repository.delete(id);
      res.status(204).send();
    } catch (error) {
      res.status(400).json({ error: 'Failed to delete Veiculo' });
    }
  }
}



================================================================================
FILE PATH: server\src\repositories\cliente.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class ClienteRepository {
  async create(data: any) {
    console.log('📥 ClienteRepository.create - Received data:', JSON.stringify(data, null, 2));
    
    // Extract the FK field and value
    const { id_pessoa_fisica, id_pessoa_juridica, ...clienteData } = data;
    
    const payload = {
      ...clienteData,
      id_pessoa_fisica: id_pessoa_fisica || null,
      id_pessoa_juridica: id_pessoa_juridica || null,
    };
    
    console.log('📤 ClienteRepository.create - Sending to Prisma:', JSON.stringify(payload, null, 2));
    
    try {
      const result = await prisma.cliente.create({
        data: payload,
      });
      console.log('✅ ClienteRepository.create - Success:', result.id_cliente);
      return result;
    } catch (error) {
      console.error('❌ ClienteRepository.create - Error:', error);
      throw error;
    }
  }

  async findAll() {
    return await prisma.cliente.findMany({
        include: {
            pessoa_fisica: { include: { pessoa: true } },
            pessoa_juridica: { include: { pessoa: true } },
            tipo: true,
            veiculos: true
        }
    });
  }

  async findById(id: number) {
    return await prisma.cliente.findUnique({
      where: { id_cliente: id },
      include: {
        pessoa_fisica: { include: { pessoa: true } },
        pessoa_juridica: { include: { pessoa: true } },
        tipo: true,
        veiculos: true
      }
    });
  }

  async update(id: number, data: Prisma.ClienteUpdateInput) {
    return await prisma.cliente.update({
      where: { id_cliente: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.cliente.delete({
      where: { id_cliente: id },
    });
  }

  // Case-insensitive search by name (searches in Pessoa.nome)
  async searchByName(searchTerm: string) {
    return await prisma.cliente.findMany({
      where: {
        OR: [
          {
            pessoa_fisica: {
              pessoa: {
                nome: {
                  contains: searchTerm,
                  mode: 'insensitive' // Case-insensitive search
                }
              }
            }
          },
          {
            pessoa_juridica: {
              pessoa: {
                nome: {
                  contains: searchTerm,
                  mode: 'insensitive'
                }
              }
            }
          }
        ]
      },
      include: {
        pessoa_fisica: { include: { pessoa: true } },
        pessoa_juridica: { include: { pessoa: true } },
        tipo: true,
        veiculos: true
      }
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\fechamentoFinanceiro.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class FechamentoFinanceiroRepository {
  async create(data: Prisma.FechamentoFinanceiroCreateInput) {
    return await prisma.fechamentoFinanceiro.create({
      data,
    });
  }

  async findAll() {
    return await prisma.fechamentoFinanceiro.findMany({
        include: { ordem_de_servico: true }
    });
  }

  async findById(id: number) {
    return await prisma.fechamentoFinanceiro.findUnique({
      where: { id_fechamento_financeiro: id },
        include: { ordem_de_servico: true }
    });
  }

  async update(id: number, data: Prisma.FechamentoFinanceiroUpdateInput) {
    return await prisma.fechamentoFinanceiro.update({
      where: { id_fechamento_financeiro: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.fechamentoFinanceiro.delete({
      where: { id_fechamento_financeiro: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\fornecedor.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class FornecedorRepository {
  async create(data: Prisma.FornecedorCreateInput) {
    return await prisma.fornecedor.create({
      data,
    });
  }

  async findAll() {
    return await prisma.fornecedor.findMany();
  }

  async findById(id: number) {
    return await prisma.fornecedor.findUnique({
      where: { id_fornecedor: id },
    });
  }

  async update(id: number, data: Prisma.FornecedorUpdateInput) {
    return await prisma.fornecedor.update({
      where: { id_fornecedor: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.fornecedor.delete({
      where: { id_fornecedor: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\funcionario.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class FuncionarioRepository {
  async create(data: Prisma.FuncionarioCreateInput) {
    return await prisma.funcionario.create({
      data,
    });
  }

  async findAll() {
    return await prisma.funcionario.findMany({
        include: { pessoa_fisica: { include: { pessoa: true } } }
    });
  }

  async findById(id: number) {
    return await prisma.funcionario.findUnique({
      where: { id_funcionario: id },
      include: { pessoa_fisica: { include: { pessoa: true } } }
    });
  }

  async update(id: number, data: Prisma.FuncionarioUpdateInput) {
    return await prisma.funcionario.update({
      where: { id_funcionario: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.funcionario.delete({
      where: { id_funcionario: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\itensOs.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class ItensOsRepository {
  async create(data: Prisma.ItensOsCreateInput) {
    return await prisma.itensOs.create({
      data,
    });
  }

  async findAll() {
    return await prisma.itensOs.findMany({
        include: { ordem_de_servico: true, pecas_estoque: true, pagamentos_peca: true }
    });
  }

  async findById(id: number) {
    return await prisma.itensOs.findUnique({
      where: { id_iten: id },
        include: { ordem_de_servico: true, pecas_estoque: true, pagamentos_peca: true }
    });
  }

  async findByOsId(idOs: number) {
    return await prisma.itensOs.findMany({
      where: { id_os: idOs },
      include: { pecas_estoque: true, pagamentos_peca: true }
    });
  }

  async update(id: number, data: Prisma.ItensOsUpdateInput) {
    return await prisma.itensOs.update({
      where: { id_iten: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.itensOs.delete({
      where: { id_iten: id },
    });
  }

  async search(query: string) {
    // Busca descrições únicas na tabela de itens já usados
    return await prisma.itensOs.findMany({
      where: {
        descricao: { contains: query, mode: 'insensitive' }
      },
      distinct: ['descricao'],
      take: 10
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\ordemDeServico.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class OrdemDeServicoRepository {
  async create(data: Prisma.OrdemDeServicoCreateInput) {
    return await prisma.ordemDeServico.create({
      data,
    });
  }

  async findAll() {
    return await prisma.ordemDeServico.findMany({
      include: {
        cliente: {
          include: {
            pessoa_fisica: { include: { pessoa: true } },
            pessoa_juridica: { include: { pessoa: true } }
          }
        },
        veiculo: true,
        funcionario: true,
        itens_os: true,
        fechamento_financeiro: true
      }
    });
  }

  async findById(id: number) {
    return await prisma.ordemDeServico.findUnique({
      where: { id_os: id },
      include: {
        cliente: {
          include: {
            pessoa_fisica: { include: { pessoa: true } },
            pessoa_juridica: { include: { pessoa: true } }
          }
        },
        veiculo: true,
        funcionario: true,
        itens_os: true,
        fechamento_financeiro: true
      }
    });
  }

  async update(id: number, data: Prisma.OrdemDeServicoUpdateInput) {
    return await prisma.ordemDeServico.update({
      where: { id_os: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.ordemDeServico.delete({
      where: { id_os: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\pagamentoPeca.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class PagamentoPecaRepository {
  async create(data: Prisma.PagamentoPecaCreateInput) {
    return await prisma.pagamentoPeca.create({
      data,
    });
  }

  async findAll() {
    return await prisma.pagamentoPeca.findMany({
        include: { item_os: true, fornecedor: true }
    });
  }

  async findById(id: number) {
    return await prisma.pagamentoPeca.findUnique({
      where: { id_pagamento_peca: id },
        include: { item_os: true, fornecedor: true }
    });
  }

  async update(id: number, data: Prisma.PagamentoPecaUpdateInput) {
    return await prisma.pagamentoPeca.update({
      where: { id_pagamento_peca: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.pagamentoPeca.delete({
      where: { id_pagamento_peca: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\pecasEstoque.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class PecasEstoqueRepository {
  async create(data: Prisma.PecasEstoqueCreateInput) {
    return await prisma.pecasEstoque.create({
      data,
    });
  }

  async findAll() {
    return await prisma.pecasEstoque.findMany();
  }

  async findById(id: number) {
    return await prisma.pecasEstoque.findUnique({
      where: { id_pecas_estoque: id },
    });
  }

  async update(id: number, data: Prisma.PecasEstoqueUpdateInput) {
    return await prisma.pecasEstoque.update({
      where: { id_pecas_estoque: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.pecasEstoque.delete({
      where: { id_pecas_estoque: id },
    });
  }

  async search(query: string) {
    return await prisma.pecasEstoque.findMany({
      where: {
        OR: [
          { nome: { contains: query, mode: 'insensitive' } },
          { fabricante: { contains: query, mode: 'insensitive' } },
          { descricao: { contains: query, mode: 'insensitive' } },
        ]
      },
      take: 10
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\pessoa.repository.ts
================================================================================
import { Prisma, PrismaClient } from '@prisma/client';
import { prisma } from '../prisma.js';

export class PessoaRepository {
  async create(data: Prisma.PessoaCreateInput) {
    return await prisma.pessoa.create({
      data,
    });
  }

  async findAll() {
    return await prisma.pessoa.findMany();
  }

  async findById(id: number) {
    return await prisma.pessoa.findUnique({
      where: { id_pessoa: id },
    });
  }

  async update(id: number, data: Prisma.PessoaUpdateInput) {
    return await prisma.pessoa.update({
      where: { id_pessoa: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.pessoa.delete({
      where: { id_pessoa: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\pessoaFisica.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class PessoaFisicaRepository {
  async create(data: Prisma.PessoaFisicaCreateInput) {
    return await prisma.pessoaFisica.create({
      data,
    });
  }

  async findAll() {
    return await prisma.pessoaFisica.findMany({
        include: { pessoa: true }
    });
  }

  async findById(id: number) {
    return await prisma.pessoaFisica.findUnique({
      where: { id_pessoa_fisica: id },
      include: { pessoa: true }
    });
  }

  async update(id: number, data: Prisma.PessoaFisicaUpdateInput) {
    return await prisma.pessoaFisica.update({
      where: { id_pessoa_fisica: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.pessoaFisica.delete({
      where: { id_pessoa_fisica: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\pessoaJuridica.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class PessoaJuridicaRepository {
  async create(data: Prisma.PessoaJuridicaCreateInput) {
    return await prisma.pessoaJuridica.create({
      data,
    });
  }

  async findAll() {
    return await prisma.pessoaJuridica.findMany({
        include: { pessoa: true }
    });
  }

  async findById(id: number) {
    return await prisma.pessoaJuridica.findUnique({
      where: { id_pessoa_juridica: id },
      include: { pessoa: true }
    });
  }

  async update(id: number, data: Prisma.PessoaJuridicaUpdateInput) {
    return await prisma.pessoaJuridica.update({
      where: { id_pessoa_juridica: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.pessoaJuridica.delete({
      where: { id_pessoa_juridica: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\tipo.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class TipoRepository {
  async create(data: Prisma.TipoCreateInput) {
    return await prisma.tipo.create({
      data,
    });
  }

  async findAll() {
    return await prisma.tipo.findMany();
  }

  async findById(id: number) {
    return await prisma.tipo.findUnique({
      where: { id_tipo: id },
    });
  }

  async update(id: number, data: Prisma.TipoUpdateInput) {
    return await prisma.tipo.update({
      where: { id_tipo: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.tipo.delete({
      where: { id_tipo: id },
    });
  }
}



================================================================================
FILE PATH: server\src\repositories\veiculo.repository.ts
================================================================================
import { Prisma } from '@prisma/client';
import { prisma } from '../prisma.js';

export class VeiculoRepository {
  async create(data: Prisma.VeiculoCreateInput) {
    return await prisma.veiculo.create({
      data,
    });
  }

  async findAll() {
    return await prisma.veiculo.findMany({
        include: { cliente: true }
    });
  }

  async findById(id: number) {
    return await prisma.veiculo.findUnique({
      where: { id_veiculo: id },
      include: { cliente: true }
    });
  }

  // Search by plate (case-insensitive, normalized without hyphens)
  async findByPlaca(placa: string) {
    // Normalize: remove hyphens and convert to uppercase
    const normalizedPlaca = placa.replace(/-/g, '').toUpperCase();
    
    return await prisma.veiculo.findUnique({
      where: { placa: normalizedPlaca },
      include: { 
        cliente: {
            include: {
                pessoa_fisica: { include: { pessoa: true } },
                pessoa_juridica: { include: { pessoa: true } }
            }
        } 
      }
    });
  }

  // search by partial plate or model
  async search(query: string) {
    return await prisma.veiculo.findMany({
      where: {
        OR: [
          { placa: { contains: query, mode: 'insensitive' } },
          { modelo: { contains: query, mode: 'insensitive' } },
          { marca: { contains: query, mode: 'insensitive' } }
        ]
      },
      include: { 
        cliente: {
            include: {
                pessoa_fisica: { include: { pessoa: true } },
                pessoa_juridica: { include: { pessoa: true } }
            }
        } 
      },
      take: 10
    });
  }

  async update(id: number, data: Prisma.VeiculoUpdateInput) {
    return await prisma.veiculo.update({
      where: { id_veiculo: id },
      data,
    });
  }

  async delete(id: number) {
    return await prisma.veiculo.delete({
      where: { id_veiculo: id },
    });
  }
}



================================================================================
FILE PATH: server\src\routes\cliente.routes.ts
================================================================================
import { Router } from 'express';
import { ClienteController } from '../controllers/cliente.controller.js';

const clienteRoutes = Router();
const controller = new ClienteController();

clienteRoutes.post('/', controller.create);
clienteRoutes.get('/', controller.findAll);
clienteRoutes.get('/search', controller.searchByName); // Must be before /:id
clienteRoutes.get('/:id', controller.findById);
clienteRoutes.put('/:id', controller.update);
clienteRoutes.delete('/:id', controller.delete);

export { clienteRoutes };



================================================================================
FILE PATH: server\src\routes\fechamentoFinanceiro.routes.ts
================================================================================
import { Router } from 'express';
import { FechamentoFinanceiroController } from '../controllers/fechamentoFinanceiro.controller.js';

const fechamentoFinanceiroRoutes = Router();
const controller = new FechamentoFinanceiroController();

fechamentoFinanceiroRoutes.post('/', controller.create);
fechamentoFinanceiroRoutes.get('/', controller.findAll);
fechamentoFinanceiroRoutes.get('/:id', controller.findById);
fechamentoFinanceiroRoutes.put('/:id', controller.update);
fechamentoFinanceiroRoutes.delete('/:id', controller.delete);

export { fechamentoFinanceiroRoutes };



================================================================================
FILE PATH: server\src\routes\fornecedor.routes.ts
================================================================================
import { Router } from 'express';
import { FornecedorController } from '../controllers/fornecedor.controller.js';

const fornecedorRoutes = Router();
const controller = new FornecedorController();

fornecedorRoutes.post('/', controller.create);
fornecedorRoutes.get('/', controller.findAll);
fornecedorRoutes.get('/:id', controller.findById);
fornecedorRoutes.put('/:id', controller.update);
fornecedorRoutes.delete('/:id', controller.delete);

export { fornecedorRoutes };



================================================================================
FILE PATH: server\src\routes\funcionario.routes.ts
================================================================================
import { Router } from 'express';
import { FuncionarioController } from '../controllers/funcionario.controller.js';

const funcionarioRoutes = Router();
const controller = new FuncionarioController();

funcionarioRoutes.post('/', controller.create);
funcionarioRoutes.get('/', controller.findAll);
funcionarioRoutes.get('/:id', controller.findById);
funcionarioRoutes.put('/:id', controller.update);
funcionarioRoutes.delete('/:id', controller.delete);

export { funcionarioRoutes };



================================================================================
FILE PATH: server\src\routes\itensOs.routes.ts
================================================================================
import { Router } from 'express';
import { ItensOsController } from '../controllers/itensOs.controller.js';

const itensOsRoutes = Router();
const controller = new ItensOsController();

itensOsRoutes.post('/', controller.create);
itensOsRoutes.get('/', controller.findAll);
itensOsRoutes.get('/os/:idOs', controller.findByOsId);
itensOsRoutes.get('/:id', controller.findById);
itensOsRoutes.put('/:id', controller.update);
itensOsRoutes.delete('/:id', controller.delete);
itensOsRoutes.get('/search/desc', controller.search);

export { itensOsRoutes };



================================================================================
FILE PATH: server\src\routes\ordemDeServico.routes.ts
================================================================================
import { Router } from 'express';
import { OrdemDeServicoController } from '../controllers/ordemDeServico.controller.js';

const ordemDeServicoRoutes = Router();
const controller = new OrdemDeServicoController();

ordemDeServicoRoutes.post('/', controller.create);
ordemDeServicoRoutes.get('/', controller.findAll);
ordemDeServicoRoutes.get('/:id', controller.findById);
ordemDeServicoRoutes.put('/:id', controller.update);
ordemDeServicoRoutes.delete('/:id', controller.delete);

export { ordemDeServicoRoutes };



================================================================================
FILE PATH: server\src\routes\pagamentoPeca.routes.ts
================================================================================
import { Router } from 'express';
import { PagamentoPecaController } from '../controllers/pagamentoPeca.controller.js';

const pagamentoPecaRoutes = Router();
const controller = new PagamentoPecaController();

pagamentoPecaRoutes.post('/', controller.create);
pagamentoPecaRoutes.get('/', controller.findAll);
pagamentoPecaRoutes.get('/:id', controller.findById);
pagamentoPecaRoutes.put('/:id', controller.update);
pagamentoPecaRoutes.delete('/:id', controller.delete);

export { pagamentoPecaRoutes };



================================================================================
FILE PATH: server\src\routes\pecasEstoque.routes.ts
================================================================================
import { Router } from 'express';
import { PecasEstoqueController } from '../controllers/pecasEstoque.controller.js';

const pecasEstoqueRoutes = Router();
const controller = new PecasEstoqueController();

pecasEstoqueRoutes.post('/', controller.create);
pecasEstoqueRoutes.get('/', controller.findAll);
pecasEstoqueRoutes.get('/search', controller.search);
pecasEstoqueRoutes.get('/:id', controller.findById);
pecasEstoqueRoutes.put('/:id', controller.update);
pecasEstoqueRoutes.delete('/:id', controller.delete);

export { pecasEstoqueRoutes };



================================================================================
FILE PATH: server\src\routes\pessoa.routes.ts
================================================================================
import { Router } from 'express';
import { PessoaController } from '../controllers/pessoa.controller.js';

const pessoaRoutes = Router();
const controller = new PessoaController();

pessoaRoutes.post('/', controller.create);
pessoaRoutes.get('/', controller.findAll);
pessoaRoutes.get('/:id', controller.findById);
pessoaRoutes.put('/:id', controller.update);
pessoaRoutes.delete('/:id', controller.delete);

export { pessoaRoutes };



================================================================================
FILE PATH: server\src\routes\pessoaFisica.routes.ts
================================================================================
import { Router } from 'express';
import { PessoaFisicaController } from '../controllers/pessoaFisica.controller.js';

const pessoaFisicaRoutes = Router();
const controller = new PessoaFisicaController();

pessoaFisicaRoutes.post('/', controller.create);
pessoaFisicaRoutes.get('/', controller.findAll);
pessoaFisicaRoutes.get('/:id', controller.findById);
pessoaFisicaRoutes.put('/:id', controller.update);
pessoaFisicaRoutes.delete('/:id', controller.delete);

export { pessoaFisicaRoutes };



================================================================================
FILE PATH: server\src\routes\pessoaJuridica.routes.ts
================================================================================
import { Router } from 'express';
import { PessoaJuridicaController } from '../controllers/pessoaJuridica.controller.js';

const pessoaJuridicaRoutes = Router();
const controller = new PessoaJuridicaController();

pessoaJuridicaRoutes.post('/', controller.create);
pessoaJuridicaRoutes.get('/', controller.findAll);
pessoaJuridicaRoutes.get('/:id', controller.findById);
pessoaJuridicaRoutes.put('/:id', controller.update);
pessoaJuridicaRoutes.delete('/:id', controller.delete);

export { pessoaJuridicaRoutes };



================================================================================
FILE PATH: server\src\routes\tipo.routes.ts
================================================================================
import { Router } from 'express';
import { TipoController } from '../controllers/tipo.controller.js';

const tipoRoutes = Router();
const controller = new TipoController();

tipoRoutes.post('/', controller.create);
tipoRoutes.get('/', controller.findAll);
tipoRoutes.get('/:id', controller.findById);
tipoRoutes.put('/:id', controller.update);
tipoRoutes.delete('/:id', controller.delete);

export { tipoRoutes };



================================================================================
FILE PATH: server\src\routes\veiculo.routes.ts
================================================================================
import { Router } from 'express';
import { VeiculoController } from '../controllers/veiculo.controller.js';

const veiculoRoutes = Router();
const controller = new VeiculoController();

veiculoRoutes.post('/', controller.create);
veiculoRoutes.get('/', controller.findAll);
veiculoRoutes.get('/search', controller.search);
veiculoRoutes.get('/placa/:placa', controller.findByPlaca);
veiculoRoutes.get('/:id', controller.findById);
veiculoRoutes.put('/:id', controller.update);
veiculoRoutes.delete('/:id', controller.delete);

export { veiculoRoutes };



